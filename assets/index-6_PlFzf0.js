var gt=Object.defineProperty;var xt=(s,t,e)=>t in s?gt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var d=(s,t,e)=>(xt(s,typeof t!="symbol"?t+"":t,e),e),rt=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var r=(s,t,e)=>(rt(s,t,"read from private field"),e?e.call(s):t.get(s)),l=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},c=(s,t,e,i)=>(rt(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e);var J=(s,t,e)=>(rt(s,t,"access private method"),e);import{r as S,j as nt,_ as yt}from"./index-DXWUy1KW.js";import"./react-spring_web.modern-CMtpY8LM.js";function pt(s){const[t,e]=S.useState(s),i=S.useRef(t);return[i,u=>{u instanceof Function?(i.current=u(i.current),e(u)):(i.current=u,e(u))}]}class ut{constructor(t){d(this,"grid");d(this,"index");d(this,"position");d(this,"dir",{NW:()=>this.getNeighbourInDirection(m.NW),N:()=>this.getNeighbourInDirection(m.N),NE:()=>this.getNeighbourInDirection(m.NE),E:()=>this.getNeighbourInDirection(m.E),SE:()=>this.getNeighbourInDirection(m.SE),S:()=>this.getNeighbourInDirection(m.S),SW:()=>this.getNeighbourInDirection(m.SW),W:()=>this.getNeighbourInDirection(m.W)});this.grid=t,this.index=-1,this.position=new a(0,0)}getNeighbourInDirection(t){if(this.position)return this.grid.getAtPosition(a.add(this.position,t))}getNeighbourhood(){const t=[];return St.forEach(e=>{const i=this.getNeighbourInDirection(e);t.push(i)}),t}getLineTo(t,e){return this.grid.getPositionsInLine(this.position,t,e)}swapWith(t){this.grid.swap(this,t)}getRGBA(){return[0,0,0,0]}}var D,Z,$,ht;class at{constructor(t){l(this,$);d(this,"size");d(this,"alternateRows");d(this,"createEmpty");d(this,"grid");l(this,D,void 0);l(this,Z,0);const{size:e,alternateRows:i,createEmpty:n}={alternateRows:!1,...t};if(!a.frac(e).isEqual(a.zero))throw new Error(`Grid size must be integers (${e.toArray().join(", ")})`);this.grid=[],c(this,D,new Set([])),this.size=e,this.alternateRows=i,this.createEmpty=n?()=>n(this):()=>new ut(this),J(this,$,ht).call(this)}clear(){J(this,$,ht).call(this),this.resetChanges()}indexOf(t){return t?t.index:-1}positionOf(t){if(t)return t.position}forEach(t,e){const{alternateRowDirections:i,evenRows:n,oddRows:u,evenCols:f,oddCols:g,startRow:C,endRow:w,startCol:I,endCol:z}={evenRows:!0,oddRows:!0,evenCols:!0,oddCols:!0,...e},A=new Set,k=(p,x)=>{const E=this.position2index(new a(p,x)),o=this.grid[E];if(!o||A.has(o))return;if(t(o,E)===!1)return!1;A.add(o)};for(let p=C||0;p<(w||this.size.y);p++){const x=p%2;if(x===0&&!n)continue;if(x===1&&!u)continue;let E;if(i&&p%2===0){for(let o=(z||this.size.x)-1;o>=(I||0);o--){const R=o%2;if(!(R===0&&!f)&&!(R===1&&!g)&&(E=k(o,p),E===!1))break}if(E===!1)break;continue}for(let o=I||0;o<(z||this.size.x);o++){const R=o%2;if(!(R===0&&!f)&&!(R===1&&!g)&&(E=k(o,p),E===!1))break}if(E===!1)break}}map(t){return this.grid.map(t)}mapChanged(t){return this.getAllChanges().map(t)}getAllChanges(){return[...r(this,D).values()]}countChanges(){return r(this,D).size}forEachChanged(t,e=!1){r(this,D).forEach(t),e&&this.resetChanges()}registerChanged(t){t.index<0||t.index>=this.grid.length||r(this,D).has(t)||r(this,D).add(t)}resetChanges(){r(this,D).clear()}position2index(t){const{x:e,y:i}=t;return e<0||e>=this.size.x||i<0||i>=this.size.y?-1:e+i*this.size.x}index2position(t){const e=Math.floor(t/this.size.x),i=t-e*this.size.x;return new a(i,e)}get(t){return this.getAtPosition(t)}set(t,e){this.setAtPosition(t,e)}getPositionsInLine(t,e,i){const{excludeStart:n,excludeEnd:u,maxSteps:f}={maxSteps:r(this,Z),...i},g=e.x-t.x,C=e.y-t.y;if(g===0&&C===0)return[t];const w=g<0?-1:1,I=C<0?-1:1,z=Math.abs(g),A=Math.abs(C),k=z>=A,p=Math.min(z,A),x=Math.max(z,A),E=p/x,o=[],R=n?1:0,P=u?x:x+1,F=P-R,y=f!==void 0&&F>f?Math.floor(F/f):1;for(let v=R;v<P;v+=y){const T=Math.round(v*E);k?o.push(new a(t.x+v*w,t.y+T*I)):o.push(new a(t.x+T*w,t.y+v*I))}return o}getAtPosition(t){const e=this.position2index(t);if(e!==-1)return this.getAtIndex(e)}setAtPosition(t,e){if(t.x<0||t.x>=this.size.x||t.y<0||t.y>=this.size.y)return;const i=this.position2index(t);this.setAtIndex(i,e)}getAtIndex(t){return this.grid[t]}swap(t,e){const i=this.indexOf(t),n=this.indexOf(e);if(i===-1||n===-1)throw new Error("Can't swap unless both cells exists in the grid");const u=this.grid[i];this.setAtIndex(i,this.grid[n]),this.setAtIndex(n,u)}setAtIndex(t,e){if(t<0)throw new Error(`invalid index: ${t}`);e.index=t,e.position=this.index2position(t),this.grid[t]=e,this.registerChanged(e)}}D=new WeakMap,Z=new WeakMap,$=new WeakSet,ht=function(){const t=this.size.x*this.size.y;this.grid.length=t;for(let e=0;e<t;e++)this.setAtIndex(e,this.createEmpty());c(this,Z,this.size.length())};var mt=function(){function s(t){this._value=NaN,typeof t=="string"?this._seed=this.hashCode(t):typeof t=="number"?this._seed=this.getSafeSeed(t):this._seed=this.getSafeSeed(s.MIN+Math.floor((s.MAX-s.MIN)*Math.random())),this.reset()}return s.prototype.next=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=1),this.recalculate(),this.map(this._value,s.MIN,s.MAX,t,e)},s.prototype.nextInt=function(t,e){return t===void 0&&(t=10),e===void 0&&(e=100),this.recalculate(),Math.floor(this.map(this._value,s.MIN,s.MAX,t,e+1))},s.prototype.nextString=function(t,e){t===void 0&&(t=16),e===void 0&&(e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");for(var i="";i.length<t;)i+=this.nextChar(e);return i},s.prototype.nextChar=function(t){return t===void 0&&(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"),t.substr(this.nextInt(0,t.length-1),1)},s.prototype.nextArrayItem=function(t){return t[this.nextInt(0,t.length-1)]},s.prototype.nextBoolean=function(){return this.recalculate(),this._value>.5},s.prototype.skip=function(t){for(t===void 0&&(t=1);t-- >0;)this.recalculate()},s.prototype.reset=function(){this._value=this._seed},s.prototype.recalculate=function(){this._value=this.xorshift(this._value)},s.prototype.xorshift=function(t){return t^=t<<13,t^=t>>17,t^=t<<5,t},s.prototype.map=function(t,e,i,n,u){return(t-e)/(i-e)*(u-n)+n},s.prototype.hashCode=function(t){var e=0;if(t)for(var i=t.length,n=0;n<i;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0,e=this.xorshift(e);return this.getSafeSeed(e)},s.prototype.getSafeSeed=function(t){return t===0?1:t},s.MIN=-2147483648,s.MAX=2147483647,s}();const Ct=new mt,ot=()=>Ct.next();var q,O;class wt{constructor(t,e){l(this,q,void 0);l(this,O,void 0);c(this,q,t),c(this,O,e)}set(t,e){t&&c(this,q,t),e&&c(this,O,e)}get position(){return r(this,q)}get size(){return r(this,O)}get area(){return r(this,O).x*r(this,O).y}toArray(){return[...r(this,q).toArray(),...r(this,O).toArray()]}}q=new WeakMap,O=new WeakMap;const h=class h{constructor(t=0,e=0){d(this,"x");d(this,"y");this.x=t,this.y=e}clone(){return new h(this.x,this.y)}set(t){this.x=t.x,this.y=t.y}add(t){return this.x=this.x+t.x,this.y=this.y+t.y,this}addScalar(t){return this.x=this.x+t,this.y=this.y+t,this}subtract(t=h.zero){return this.x=this.x-t.x,this.y=this.y-t.y,this}subtractScalar(t){return this.x=this.x-t,this.y=this.y-t,this}multiply(t){return this.x=this.x*t.x,this.y=this.y*t.y,this}multiplyScalar(t){return this.x=this.x*t,this.y=this.y*t,this}divide(t){return this.x=this.x/t.x,this.y=this.y/t.y,this}divideScalar(t){return this.x=this.x/t,this.y=this.y/t,this}mod(t){return this.x=this.x%t.x,this.y=this.y%t.y,this}modScalar(t){return this.x=this.x%t,this.y=this.y%t,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}frac(){return this.subtract(this.clone().floor())}normalize(){const t=this.length();return t===0?this:this.multiplyScalar(1/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}dot(t){const e=h.multiply(this,t);return e.x+e.y}isEqual(t){return this.x===t.x&&this.y===t.y}isNear(t,e=.001){const i=h.subtract(this,t).abs();return i.x<=e&&i.y<=e}isLessThan(t){return h.isLessThan(this,t)}isGreaterThan(t){return h.isGreaterThan(this,t)}toArray(){return[this.x,this.y]}join(t){return this.toArray().join(t)}static add(t,e){return new h(t.x+e.x,t.y+e.y)}static addScalar(t,e){return new h(t.x+e,t.y+e)}static subtract(t,e=h.zero){return new h(t.x-e.x,t.y-e.y)}static subtractScalar(t,e){return new h(t.x-e,t.y-e)}static multiply(t,e){return new h(t.x*e.x,t.y*e.y)}static multiplyScalar(t,e){return new h(t.x*e,t.y*e)}static divide(t,e){return new h(t.x/e.x,t.y/e.y)}static divideScalar(t,e){return new h(t.x/e,t.y/e)}static mod(t,e){return new h(t.x%e.x,t.y%e.y)}static modScalar(t,e){return new h(t.x%e,t.y%e)}static abs(t){return new h(Math.abs(t.x),Math.abs(t.y))}static round(t){return new h(Math.round(t.x),Math.round(t.y))}static floor(t){return new h(Math.floor(t.x),Math.floor(t.y))}static ceil(t){return new h(Math.ceil(t.x),Math.ceil(t.y))}static frac(t){return h.subtract(t,h.floor(t))}static isLessThan(t,e){return t.x<e.x||t.y<e.y}static isGreaterThan(t,e){return t.x>e.x||t.y>e.y}static length(t){return Math.sqrt(t.x*t.x+t.y*t.y)}static normalize(t){const e=t.length();return e===0?t:h.multiplyScalar(t,1/e)}static dot(t,e){const i=h.multiply(t,e);return i.x+i.y}static isEqual(t,e){return t.x===e.x&&t.y===e.y}static isNear(t,e,i=.001){const n=h.subtract(t,e).abs();return n.x<=i&&n.y<=i}static min(...t){return new h(Math.min(...t.map(e=>e.x)),Math.min(...t.map(e=>e.y)))}static max(...t){return new h(Math.max(...t.map(e=>e.x)),Math.max(...t.map(e=>e.y)))}static from(t){return new h(t.x,t.y)}static fromArray([t,e]){return new h(t,e)}static random(){return new h(ot(),ot())}};d(h,"zero",Object.freeze(new h)),d(h,"one",Object.freeze(new h(1,1))),d(h,"up",Object.freeze(new h(0,-1))),d(h,"down",Object.freeze(new h(0,1))),d(h,"left",Object.freeze(new h(-1,0))),d(h,"right",Object.freeze(new h(1,0))),d(h,"negativeInfinity",Object.freeze(new h(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY))),d(h,"positiveInfinity",Object.freeze(new h(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)));let a=h;const m={NW:new a(-1,-1),N:a.up,NE:new a(1,-1),E:a.right,SE:a.one,S:a.down,SW:new a(-1,1),W:a.left},St=[m.NW,m.N,m.NE,m.W,m.E,m.SW,m.S,m.SE];var L,X;class It extends wt{constructor(){super(a.positiveInfinity.clone(),a.negativeInfinity.clone());l(this,L,!1);l(this,X,void 0);c(this,X,a.negativeInfinity.clone())}get area(){return r(this,L)?super.area:0}haveChanges(){return r(this,L)}reset(){this.position.set(a.positiveInfinity),this.size.set(a.negativeInfinity),r(this,X).set(a.negativeInfinity),c(this,L,!1)}registerPoint(e){this.position.min(e),r(this,X).max(e),this.size.set(a.subtract(r(this,X),this.position).addScalar(1)),c(this,L,!0)}}L=new WeakMap,X=new WeakMap;var b;class Et extends ut{constructor(e,i){super(e);d(this,"parent");l(this,b,void 0);this.parent=i,c(this,b,new It)}get dirtyRect(){return r(this,b)}forEachDirty(e,i){if(!r(this,b).haveChanges())return;const{resetChanges:n,...u}={resetChanges:!1,...i},f=r(this,b).position.clone(),g=r(this,b).position.clone().add(this.dirtyRect.size);n&&this.resetChanges(),this.parent.forEach(e,{startRow:f.y,endRow:g.y,startCol:f.x,endCol:g.x,...u})}forEach(e,i){const n=this.parent.chunkSize,u=a.multiply(this.position,n),f=a.multiply(this.position,n).add(n);this.parent.forEach(e,{startRow:u.y,endRow:f.y,startCol:u.x,endCol:f.x,...i})}haveChanges(){return r(this,b).haveChanges()}countChanges(){return r(this,b).haveChanges()?r(this,b).area:0}registerChange(e){r(this,b).registerPoint(e.position)}resetChanges(){r(this,b).reset()}}b=new WeakMap;function Rt(s){return new Worker("/assets/worker-G1OrwRg-.js",{name:s==null?void 0:s.name})}var M,K,Y,V,et,ct,it,ft,st,lt;class bt extends at{constructor(e){const{chunkSize:i,workerize:n,...u}=e;super(u);l(this,et);l(this,it);l(this,st);d(this,"chunkSize",new a(64,64));l(this,M,void 0);l(this,K,void 0);l(this,Y,void 0);l(this,V,[]);this.chunkSize=i||new a(64,64),c(this,M,new at({size:a.divide(this.size,this.chunkSize),createEmpty:f=>new Et(f,this)})),c(this,K,n||!1),r(this,K)&&(c(this,Y,new Rt),r(this,Y).onmessage=this.handleWorkerResponse),J(this,et,ct).call(this)}registerChanged(e){if(e.index<0||e.index>=this.grid.length)return;const i=this.chunkOf(e);i&&i.registerChange(e)}resetChanges(){super.resetChanges(),this.forEachChunk(e=>e.resetChanges())}countChanges(){return this.mapChunks(e=>e.countChanges()).reduce((e,i)=>e+i)}getAllChanges(){const e=[];return this.forEachChanged(i=>e.push(i)),e}forEachChanged(e,i){this.forEachChunk(n=>{n.haveChanges()&&n.forEachDirty(e,{resetChanges:i})})}chunkOf(e){if(!e||!this.chunkSize)return;const i=a.divide(e.position,this.chunkSize).floor();return r(this,M).get(i)}getChunk(e){return r(this,M).get(e)}forEachChunk(e,i){r(this,M).forEach(e,i)}mapChunks(e){return r(this,M).map(e)}forEachChangedChunkPass(e,i=!1){this.forEachChunkPass(n=>{const u=n.filter(f=>f.haveChanges());u.length!==0&&(e(u),i&&u.forEach(f=>f.resetChanges()))})}forEachChunkPass(e){r(this,V).forEach((i,n)=>{r(this,K)?J(this,st,lt).call(this,()=>e(i,n)):e(i,n)})}handleWorkerResponse(e){console.log("worker says:",this,e.data)}}M=new WeakMap,K=new WeakMap,Y=new WeakMap,V=new WeakMap,et=new WeakSet,ct=function(){for(let e=0;e<r(this,M).size.x*r(this,M).size.y;e++)r(this,M).setAtIndex(e,r(this,M).createEmpty());J(this,it,ft).call(this)},it=new WeakSet,ft=function(){const e=[[!1,!1],[!1,!0],[!0,!1],[!0,!0]],i=[];e.forEach(([n,u])=>{const f=[];this.forEachChunk(g=>{f.push(g)},{evenRows:!n,oddRows:n,evenCols:!u,oddCols:u}),i.push(f)}),c(this,V,i)},st=new WeakSet,lt=function(e){r(this,Y)&&r(this,Y).postMessage({f:e})};class Pt{constructor(t){d(this,"grid");const{gridOptions:e}=t;this.grid=this.createGrid(e)}clear(){this.grid.clear()}}function zt(s,t){const{children:e,grid:i,debugDraw:n,pickColor:u,...f}={debugDraw:!1,...s},g=S.useRef(null),C=S.useRef(null),w=S.useRef(),[I,z]=pt(!0);S.useImperativeHandle(t,()=>({clear:p,render:x})),S.useEffect(()=>{i&&(p(),x(i))},[i]);function A(){return C.current||(C.current=g.current?g.current.getContext("2d"):null,C.current&&(C.current.imageSmoothingEnabled=!1,C.current.translate(.5,.5))),C.current}function k(){if(w.current)return w.current;if(!i)return;const o=A();if(o)return w.current=o.createImageData(...i.size.toArray()),w.current}function p(){const o=k();o&&(o.data.fill(0),z(!0))}function x(o,R={debugDraw:n}){const{debugDraw:P,resetChanges:F}={debugDraw:!1,resetChanges:!1,...R};if(!o)return;const y=A();if(!y)return;const v=k();v&&(I.current===!0?o.forEach(T=>E({imageData:v,cell:T})):o.forEachChanged(T=>E({imageData:v,cell:T}),F),y.putImageData(v,0,0),P&&o instanceof bt&&o.forEachChunkPass((T,dt)=>{T.forEach(H=>{y.strokeStyle=H.haveChanges()?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.2)",y.fillStyle=y.strokeStyle,y.lineWidth=1;const tt=a.multiply(H.position,o.chunkSize);y.strokeRect(...tt.toArray(),...o.chunkSize.toArray()),y.textAlign="right",y.fillText(H.position.toArray().toString(),...a.add(tt,o.chunkSize).subtractScalar(2).toArray()),y.textAlign="left",y.fillText(dt.toString(),...a.add(tt,a.multiply(o.chunkSize,a.down).add(a.fromArray([2,-2]))).toArray(),o.chunkSize.x),H.dirtyRect.haveChanges()&&(y.strokeStyle="red",y.fillStyle="red",y.textAlign="left",y.fillText(H.countChanges().toString(),...a.add(tt,new a(2,10)).toArray()),y.strokeRect(...H.dirtyRect.toArray()))})}),z(!1))}function E(o){const{imageData:R,cell:P}=o;if(P.index===-1)return;const F=u?u({cell:P}):P.getRGBA();F&&R.data.set(F,P.index*4)}if(i)return nt.jsxs("div",{className:"grid canvas",children:[nt.jsx("canvas",{ref:g,width:i.size.x||1,height:i.size.y||1,...f}),e]})}const Mt=S.forwardRef(zt);var W,Q,N,_,U,j,B,G;class At{constructor(t){l(this,W,void 0);l(this,Q,void 0);l(this,N,void 0);d(this,"limitFps");l(this,_,void 0);l(this,U,void 0);l(this,j,!0);l(this,B,void 0);l(this,G,void 0);const{gridRenderer:e,renderOptions:i,simulation:n,limitFps:u,resetChanges:f,onStep:g}={resetChanges:!0,...t};c(this,W,e),c(this,Q,i),c(this,N,n),this.limitFps=u,c(this,_,f),c(this,U,g),this._stepInternal=this._stepInternal.bind(this),c(this,B,requestAnimationFrame(this._stepInternal))}_stepInternal(t){this.step(t),c(this,B,requestAnimationFrame(this._stepInternal))}get simulation(){return r(this,N)}destroy(){this.stop(),this.clear(),r(this,B)!==void 0&&cancelAnimationFrame(r(this,B))}start(){r(this,j)||(c(this,j,!0),this._stepInternal(Date.now()))}stop(){c(this,j,!1),c(this,G,void 0)}clear(){var t,e;(t=r(this,N))==null||t.clear(),(e=r(this,W))==null||e.clear()}isRunning(){return r(this,j)}registerSimulation(t){r(this,N)&&(console.error("already have one"),this.destroy()),c(this,N,t)}registerGridRenderer(t,e){c(this,W,t),e&&c(this,Q,e)}step(t){if(r(this,G)===void 0)c(this,G,t);else{const e=(t-r(this,G))/1e3;if(this.limitFps===void 0||e>1/this.limitFps){if(r(this,N)){const i=r(this,N).grid;if(!i)throw new Error("simulation or grid must be provided");r(this,j)&&r(this,N).step(e),r(this,U)&&r(this,U).call(this,{grid:i,deltaTime:e}),r(this,W)&&r(this,W).render(i,{resetChanges:!1,...r(this,Q)}),r(this,_)&&i.resetChanges()}c(this,G,t)}}}}W=new WeakMap,Q=new WeakMap,N=new WeakMap,_=new WeakMap,U=new WeakMap,j=new WeakMap,B=new WeakMap,G=new WeakMap;function Nt(s,t){var k,p;const{limitFps:e,resetChanges:i,renderOptions:n,children:u,initSimulation:f,onStep:g,...C}={resetChanges:!0,...s},w=S.useRef(null),I=S.useRef(null),z=S.useRef();S.useImperativeHandle(t,()=>I.current),S.useEffect(()=>{if(w.current&&!I.current)return I.current=new At({gridRenderer:w.current,simulation:f(),limitFps:e,resetChanges:i,renderOptions:n,onStep:g}),()=>{var x;(x=I.current)==null||x.destroy()}}),S.useEffect(()=>{var x;w.current&&(yt.isEqual(n,z.current)||(z.current=n,(x=I.current)==null||x.registerGridRenderer(w.current,n)))},[n]);function A(x){x.preventDefault()}return nt.jsx(Mt,{ref:w,grid:(p=(k=I.current)==null?void 0:k.simulation)==null?void 0:p.grid,children:u,onContextMenu:A,...C})}const Ot=S.forwardRef(Nt);export{bt as C,ut as G,Pt as S,a as V,Ot as a,at as b,St as n,ot as r,pt as u};

var N=Object.defineProperty;var _=(s,t,e)=>t in s?N(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var m=(s,t,e)=>(_(s,typeof t!="symbol"?t+"":t,e),e),M=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var n=(s,t,e)=>(M(s,t,"read from private field"),e?e.call(s):t.get(s)),u=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},d=(s,t,e,i)=>(M(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e);var S=(s,t,e)=>(M(s,t,"access private method"),e);import{r as l,j as v,_ as j}from"./index-Dvz7AGqx.js";var x;class B{constructor(t,e){u(this,x,void 0);m(this,"isEmpty",!1);m(this,"dir",{TL:()=>this.neighbourInDirection(-1,-1),T:()=>this.neighbourInDirection(0,-1),TR:()=>this.neighbourInDirection(1,-1),R:()=>this.neighbourInDirection(1,0),DR:()=>this.neighbourInDirection(1,1),D:()=>this.neighbourInDirection(0,1),DL:()=>this.neighbourInDirection(-1,1),L:()=>this.neighbourInDirection(-1,0)});d(this,x,t),this.isEmpty=e||!1}neighbourInDirection(t,e){const i=n(this,x),[r,h]=i.XYOf(this);return i.getAtXY(r+t,h+e)}swap(t){n(this,x).swapAB(this,t)}}x=new WeakMap;class P extends B{constructor(t){super(t,!0)}getRGB(){return[50,50,50]}update(){}}class J extends B{getRGB(){return[255,0,255]}update(){const t=this.dir.D();if(t!=null&&t.isEmpty)return this.swap(t);const e=this.dir.DL();if(e!=null&&e.isEmpty)return this.swap(e);const i=this.dir.DR();if(i!=null&&i.isEmpty)return this.swap(i)}}var a,A,T;class K{constructor(t,e){u(this,A);m(this,"width");m(this,"height");u(this,a,void 0);this.width=t,this.height=e,d(this,a,[]),S(this,A,T).call(this)}indexOf(t,e){return t?n(this,a).indexOf(t,e):-1}XYOf(t,e){const i=this.indexOf(t,e);return this.index2XY(i)}forEach(t){for(let e=n(this,a).length-1;e>=0&&t(n(this,a)[e],e)!==!1;e--);}XY2index(t,e){return t+e*this.width}index2XY(t){let e=Math.floor(t/this.width);return[t-e*this.width,e]}get(t,e){return this.getAtXY(t,e)}set(t,e,i){this.setAtXY(t,e,i)}getAtXY(t,e){const i=this.XY2index(t,e);return this.getAtIndex(i)}setAtXY(t,e,i){const r=this.XY2index(t,e);this.setAtIndex(r,i)}getAtIndex(t){return n(this,a)[t]}setAtIndex(t,e){n(this,a)[t]=e}swapAB(t,e){const i=this.indexOf(t),r=this.indexOf(e),h=n(this,a)[i];this.setAtIndex(i,n(this,a)[r]),this.setAtIndex(r,h)}}a=new WeakMap,A=new WeakSet,T=function(){for(let t=0;t<this.width*this.height;t++)n(this,a)[t]=new P(this)};var p,w,R,f,X,F;class Q{constructor(t){u(this,X);u(this,p,-1);u(this,w,-1);u(this,R,void 0);u(this,f,void 0);m(this,"materialPalette");const{width:e,height:i,onUpdate:r}=t;d(this,f,new K(e,i)),this.materialPalette={empty:()=>new P(n(this,f)),sand:()=>new J(n(this,f))},d(this,R,r),this.animate=this.animate.bind(this),d(this,p,requestAnimationFrame(this.animate))}dispose(){cancelAnimationFrame(n(this,p))}getGrid(){return n(this,f)}animate(t){if(n(this,w)>-1){const e=t-n(this,w);S(this,X,F).call(this,e),n(this,R).call(this,e)}d(this,w,t),d(this,p,requestAnimationFrame(this.animate))}}p=new WeakMap,w=new WeakMap,R=new WeakMap,f=new WeakMap,X=new WeakSet,F=function(t){n(this,f).forEach(i=>i.update(t))};function et(){const i=l.useRef(null),r=l.useRef(null),h=l.useRef(),[H,L]=l.useState(),[U,Y]=l.useState(!1),[O,W]=l.useState(),[b,C]=l.useState();l.useEffect(()=>{if(!i.current)return;const o=new ResizeObserver(()=>{if(!i.current)return;const{width:c,height:g}=i.current.getBoundingClientRect();L([c/2,g/2])});return o.observe(i.current),h.current=new Q({width:50,height:50,onUpdate:q}),W(h.current.materialPalette),C("sand"),()=>{var c;o.disconnect(),(c=h.current)==null||c.dispose()}},[i]);function q(){const o=r.current?r.current.getContext("2d"):null;if(!o)return;const c=h.current;if(!c)return;const g=c.getGrid();g.forEach((I,D)=>{const[y,E]=g.index2XY(D);o.fillStyle=`rgb(${I.getRGB().join(",")}`,o.fillRect(y*5,E*5,5,5)})}function z(o){if(!U||!r.current||!b)return;const{x:c,y:g,width:I,height:D}=r.current.getBoundingClientRect(),y=(o.clientX-c)/I,E=(o.clientY-g)/D,$=Math.floor(y*50),k=Math.floor(E*50),G=h.current;if(!G)return;G.getGrid().setAtXY($,k,j.invoke(O,b))}return v.jsxs("div",{className:"route sand",ref:i,children:[v.jsx("div",{className:"materials",children:j.chain(O).keys().map(o=>v.jsx("div",{children:o,onClick:()=>C(o),style:b===o?{border:"1px solid white"}:void 0},o)).value()}),H?v.jsx("canvas",{ref:r,width:`${50*5}px`,height:`${50*5}px`,onMouseDown:()=>Y(!0),onMouseUp:()=>Y(!1),onMouseLeave:()=>Y(!1),onMouseMove:z}):null]})}export{et as default};

import{r as F,R as lt,a as Fe,c as Jt,g as ea,j as ct,_ as Xt}from"./index-78101ce2.js";import{u as na,a as ra}from"./react-spring_web.modern-467223c1.js";const ar=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Ke(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function Qr(e){return"nodeType"in e}function Rt(e){var t,n;return e?Ke(e)?e:Qr(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function ti(e){const{Document:t}=Rt(e);return e instanceof t}function _n(e){return Ke(e)?!1:e instanceof Rt(e).HTMLElement}function ia(e){return e instanceof Rt(e).SVGElement}function Je(e){return e?Ke(e)?e.document:Qr(e)?ti(e)?e:_n(e)?e.ownerDocument:document:document:document}const te=ar?F.useLayoutEffect:F.useEffect;function cr(e){const t=F.useRef(e);return te(()=>{t.current=e}),F.useCallback(function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return t.current==null?void 0:t.current(...r)},[])}function sa(){const e=F.useRef(null),t=F.useCallback((r,s)=>{e.current=setInterval(r,s)},[]),n=F.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function un(e,t){t===void 0&&(t=[e]);const n=F.useRef(e);return te(()=>{n.current!==e&&(n.current=e)},t),n}function Cn(e,t){const n=F.useRef();return F.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function Wn(e){const t=cr(e),n=F.useRef(null),r=F.useCallback(s=>{s!==n.current&&(t==null||t(s,n.current)),n.current=s},[]);return[n,r]}function qn(e){const t=F.useRef();return F.useEffect(()=>{t.current=e},[e]),t.current}let Cr={};function lr(e,t){return F.useMemo(()=>{if(t)return t;const n=Cr[e]==null?0:Cr[e]+1;return Cr[e]=n,e+"-"+n},[e,t])}function bs(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.reduce((o,a)=>{const c=Object.entries(a);for(const[l,g]of c){const p=o[l];p!=null&&(o[l]=p+e*g)}return o},{...t})}}const je=bs(1),zn=bs(-1);function oa(e){return"clientX"in e&&"clientY"in e}function ei(e){if(!e)return!1;const{KeyboardEvent:t}=Rt(e.target);return t&&e instanceof t}function aa(e){if(!e)return!1;const{TouchEvent:t}=Rt(e.target);return t&&e instanceof t}function Hn(e){if(aa(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return oa(e)?{x:e.clientX,y:e.clientY}:null}const hn=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[hn.Translate.toString(e),hn.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Mi="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function ca(e){return e.matches(Mi)?e:e.querySelector(Mi)}const la={display:"none"};function ua(e){let{id:t,value:n}=e;return lt.createElement("div",{id:t,style:la},n)}const ha={position:"fixed",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};function da(e){let{id:t,announcement:n}=e;return lt.createElement("div",{id:t,style:ha,role:"status","aria-live":"assertive","aria-atomic":!0},n)}function fa(){const[e,t]=F.useState("");return{announce:F.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const ms=F.createContext(null);function ga(e){const t=F.useContext(ms);F.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function pa(){const[e]=F.useState(()=>new Set),t=F.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[F.useCallback(r=>{let{type:s,event:o}=r;e.forEach(a=>{var c;return(c=a[s])==null?void 0:c.call(a,o)})},[e]),t]}const ya={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},ba={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function ma(e){let{announcements:t=ba,container:n,hiddenTextDescribedById:r,screenReaderInstructions:s=ya}=e;const{announce:o,announcement:a}=fa(),c=lr("DndLiveRegion"),[l,g]=F.useState(!1);if(F.useEffect(()=>{g(!0)},[]),ga(F.useMemo(()=>({onDragStart(h){let{active:f}=h;o(t.onDragStart({active:f}))},onDragMove(h){let{active:f,over:y}=h;t.onDragMove&&o(t.onDragMove({active:f,over:y}))},onDragOver(h){let{active:f,over:y}=h;o(t.onDragOver({active:f,over:y}))},onDragEnd(h){let{active:f,over:y}=h;o(t.onDragEnd({active:f,over:y}))},onDragCancel(h){let{active:f,over:y}=h;o(t.onDragCancel({active:f,over:y}))}}),[o,t])),!l)return null;const p=lt.createElement(lt.Fragment,null,lt.createElement(ua,{id:r,value:s.draggable}),lt.createElement(da,{id:c,announcement:a}));return n?Fe.createPortal(p,n):p}var ft;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(ft||(ft={}));function Yn(){}const zt=Object.freeze({x:0,y:0});function wa(e,t){const n=Hn(e);if(!n)return"0 0";const r={x:(n.x-t.left)/t.width*100,y:(n.y-t.top)/t.height*100};return r.x+"% "+r.y+"%"}function va(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function _a(e,t){if(!e||e.length===0)return null;const[n]=e;return t?n[t]:n}function Ca(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),s=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),a=s-r,c=o-n;if(r<s&&n<o){const l=t.width*t.height,g=e.width*e.height,p=a*c,h=p/(l+g-p);return Number(h.toFixed(4))}return 0}const Sa=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=[];for(const o of r){const{id:a}=o,c=n.get(a);if(c){const l=Ca(c,t);l>0&&s.push({id:a,data:{droppableContainer:o,value:l}})}}return s.sort(va)};function Ea(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function ws(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:zt}function ka(e){return function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s.reduce((a,c)=>({...a,top:a.top+e*c.y,bottom:a.bottom+e*c.y,left:a.left+e*c.x,right:a.right+e*c.x}),{...n})}}const Ra=ka(1);function vs(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Da(e,t,n){const r=vs(t);if(!r)return e;const{scaleX:s,scaleY:o,x:a,y:c}=r,l=e.left-a-(1-s)*parseFloat(n),g=e.top-c-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),p=s?e.width/s:e.width,h=o?e.height/o:e.height;return{width:p,height:h,top:g,right:l+p,bottom:g+h,left:l}}const Aa={ignoreTransform:!1};function Sn(e,t){t===void 0&&(t=Aa);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:g,transformOrigin:p}=Rt(e).getComputedStyle(e);g&&(n=Da(n,g,p))}const{top:r,left:s,width:o,height:a,bottom:c,right:l}=n;return{top:r,left:s,width:o,height:a,bottom:c,right:l}}function Ni(e){return Sn(e,{ignoreTransform:!0})}function Ta(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function xa(e,t){return t===void 0&&(t=Rt(e).getComputedStyle(e)),t.position==="fixed"}function Oa(e,t){t===void 0&&(t=Rt(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(s=>{const o=t[s];return typeof o=="string"?n.test(o):!1})}function ni(e,t){const n=[];function r(s){if(t!=null&&n.length>=t||!s)return n;if(ti(s)&&s.scrollingElement!=null&&!n.includes(s.scrollingElement))return n.push(s.scrollingElement),n;if(!_n(s)||ia(s)||n.includes(s))return n;const o=Rt(e).getComputedStyle(s);return s!==e&&Oa(s,o)&&n.push(s),xa(s,o)?n:r(s.parentNode)}return e?r(e):n}function _s(e){const[t]=ni(e,1);return t??null}function Sr(e){return!ar||!e?null:Ke(e)?e:Qr(e)?ti(e)||e===Je(e).scrollingElement?window:_n(e)?e:null:null}function Cs(e){return Ke(e)?e.scrollX:e.scrollLeft}function Ss(e){return Ke(e)?e.scrollY:e.scrollTop}function Br(e){return{x:Cs(e),y:Ss(e)}}var mt;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(mt||(mt={}));function Es(e){return!ar||!e?!1:e===document.scrollingElement}function ks(e){const t={x:0,y:0},n=Es(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},s=e.scrollTop<=t.y,o=e.scrollLeft<=t.x,a=e.scrollTop>=r.y,c=e.scrollLeft>=r.x;return{isTop:s,isLeft:o,isBottom:a,isRight:c,maxScroll:r,minScroll:t}}const La={x:.2,y:.2};function Ia(e,t,n,r,s){let{top:o,left:a,right:c,bottom:l}=n;r===void 0&&(r=10),s===void 0&&(s=La);const{isTop:g,isBottom:p,isLeft:h,isRight:f}=ks(e),y={x:0,y:0},b={x:0,y:0},v={height:t.height*s.y,width:t.width*s.x};return!g&&o<=t.top+v.height?(y.y=mt.Backward,b.y=r*Math.abs((t.top+v.height-o)/v.height)):!p&&l>=t.bottom-v.height&&(y.y=mt.Forward,b.y=r*Math.abs((t.bottom-v.height-l)/v.height)),!f&&c>=t.right-v.width?(y.x=mt.Forward,b.x=r*Math.abs((t.right-v.width-c)/v.width)):!h&&a<=t.left+v.width&&(y.x=mt.Backward,b.x=r*Math.abs((t.left+v.width-a)/v.width)),{direction:y,speed:b}}function Ma(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:a}=window;return{top:0,left:0,right:o,bottom:a,width:o,height:a}}const{top:t,left:n,right:r,bottom:s}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:s,width:e.clientWidth,height:e.clientHeight}}function Rs(e){return e.reduce((t,n)=>je(t,Br(n)),zt)}function Na(e){return e.reduce((t,n)=>t+Cs(n),0)}function Ua(e){return e.reduce((t,n)=>t+Ss(n),0)}function Ds(e,t){if(t===void 0&&(t=Sn),!e)return;const{top:n,left:r,bottom:s,right:o}=t(e);_s(e)&&(s<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Fa=[["x",["left","right"],Na],["y",["top","bottom"],Ua]];class ri{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=ni(n),s=Rs(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[o,a,c]of Fa)for(const l of a)Object.defineProperty(this,l,{get:()=>{const g=c(r),p=s[o]-g;return this.rect[l]+p},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class sn{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var s;(s=this.target)==null||s.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function ja(e){const{EventTarget:t}=Rt(e);return e instanceof t?e:Je(e)}function Er(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var Mt;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Mt||(Mt={}));function Ui(e){e.preventDefault()}function Ba(e){e.stopPropagation()}var it;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter"})(it||(it={}));const As={start:[it.Space,it.Enter],cancel:[it.Esc],end:[it.Space,it.Enter]},Pa=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case it.Right:return{...n,x:n.x+25};case it.Left:return{...n,x:n.x-25};case it.Down:return{...n,y:n.y+25};case it.Up:return{...n,y:n.y-25}}};class Ts{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new sn(Je(n)),this.windowListeners=new sn(Rt(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Mt.Resize,this.handleCancel),this.windowListeners.add(Mt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Mt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&Ds(r),n(zt)}handleKeyDown(t){if(ei(t)){const{active:n,context:r,options:s}=this.props,{keyboardCodes:o=As,coordinateGetter:a=Pa,scrollBehavior:c="smooth"}=s,{code:l}=t;if(o.end.includes(l)){this.handleEnd(t);return}if(o.cancel.includes(l)){this.handleCancel(t);return}const{collisionRect:g}=r.current,p=g?{x:g.left,y:g.top}:zt;this.referenceCoordinates||(this.referenceCoordinates=p);const h=a(t,{active:n,context:r.current,currentCoordinates:p});if(h){const f=zn(h,p),y={x:0,y:0},{scrollableAncestors:b}=r.current;for(const v of b){const O=t.code,{isTop:T,isRight:I,isLeft:m,isBottom:_,maxScroll:C,minScroll:R}=ks(v),S=Ma(v),A={x:Math.min(O===it.Right?S.right-S.width/2:S.right,Math.max(O===it.Right?S.left:S.left+S.width/2,h.x)),y:Math.min(O===it.Down?S.bottom-S.height/2:S.bottom,Math.max(O===it.Down?S.top:S.top+S.height/2,h.y))},N=O===it.Right&&!I||O===it.Left&&!m,k=O===it.Down&&!_||O===it.Up&&!T;if(N&&A.x!==h.x){const D=v.scrollLeft+f.x,j=O===it.Right&&D<=C.x||O===it.Left&&D>=R.x;if(j&&!f.y){v.scrollTo({left:D,behavior:c});return}j?y.x=v.scrollLeft-D:y.x=O===it.Right?v.scrollLeft-C.x:v.scrollLeft-R.x,y.x&&v.scrollBy({left:-y.x,behavior:c});break}else if(k&&A.y!==h.y){const D=v.scrollTop+f.y,j=O===it.Down&&D<=C.y||O===it.Up&&D>=R.y;if(j&&!f.x){v.scrollTo({top:D,behavior:c});return}j?y.y=v.scrollTop-D:y.y=O===it.Down?v.scrollTop-C.y:v.scrollTop-R.y,y.y&&v.scrollBy({top:-y.y,behavior:c});break}}this.handleMove(t,je(zn(h,this.referenceCoordinates),y))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Ts.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=As,onActivation:s}=t,{active:o}=n;const{code:a}=e.nativeEvent;if(r.start.includes(a)){const c=o.activatorNode.current;return c&&e.target!==c?!1:(e.preventDefault(),s==null||s({event:e.nativeEvent}),!0)}return!1}}];function Fi(e){return!!(e&&"distance"in e)}function ji(e){return!!(e&&"delay"in e)}class ii{constructor(t,n,r){var s;r===void 0&&(r=ja(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:o}=t,{target:a}=o;this.props=t,this.events=n,this.document=Je(a),this.documentListeners=new sn(this.document),this.listeners=new sn(r),this.windowListeners=new sn(Rt(a)),this.initialCoordinates=(s=Hn(o))!=null?s:zt,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),this.windowListeners.add(Mt.Resize,this.handleCancel),this.windowListeners.add(Mt.DragStart,Ui),this.windowListeners.add(Mt.VisibilityChange,this.handleCancel),this.windowListeners.add(Mt.ContextMenu,Ui),this.documentListeners.add(Mt.Keydown,this.handleKeydown),n){if(Fi(n))return;if(ji(n)){this.timeoutId=setTimeout(this.handleStart,n.delay);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(Mt.Click,Ba,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Mt.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:s,props:o}=this,{onMove:a,options:{activationConstraint:c}}=o;if(!s)return;const l=(n=Hn(t))!=null?n:zt,g=zn(s,l);if(!r&&c){if(ji(c))return Er(g,c.tolerance)?this.handleCancel():void 0;if(Fi(c))return c.tolerance!=null&&Er(g,c.tolerance)?this.handleCancel():Er(g,c.distance)?this.handleStart():void 0}t.cancelable&&t.preventDefault(),a(l)}handleEnd(){const{onEnd:t}=this.props;this.detach(),t()}handleCancel(){const{onCancel:t}=this.props;this.detach(),t()}handleKeydown(t){t.code===it.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Va={move:{name:"pointermove"},end:{name:"pointerup"}};class xs extends ii{constructor(t){const{event:n}=t,r=Je(n.target);super(t,Va,r)}}xs.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const Wa={move:{name:"mousemove"},end:{name:"mouseup"}};var Pr;(function(e){e[e.RightClick=2]="RightClick"})(Pr||(Pr={}));class qa extends ii{constructor(t){super(t,Wa,Je(t.event.target))}}qa.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===Pr.RightClick?!1:(r==null||r({event:n}),!0)}}];const kr={move:{name:"touchmove"},end:{name:"touchend"}};class za extends ii{constructor(t){super(t,kr)}static setup(){return window.addEventListener(kr.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(kr.move.name,t)};function t(){}}}za.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:s}=n;return s.length>1?!1:(r==null||r({event:n}),!0)}}];var on;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(on||(on={}));var $n;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})($n||($n={}));function Ha(e){let{acceleration:t,activator:n=on.Pointer,canScroll:r,draggingRect:s,enabled:o,interval:a=5,order:c=$n.TreeOrder,pointerCoordinates:l,scrollableAncestors:g,scrollableAncestorRects:p,delta:h,threshold:f}=e;const y=$a({delta:h,disabled:!o}),[b,v]=sa(),O=F.useRef({x:0,y:0}),T=F.useRef({x:0,y:0}),I=F.useMemo(()=>{switch(n){case on.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case on.DraggableRect:return s}},[n,s,l]),m=F.useRef(null),_=F.useCallback(()=>{const R=m.current;if(!R)return;const S=O.current.x*T.current.x,A=O.current.y*T.current.y;R.scrollBy(S,A)},[]),C=F.useMemo(()=>c===$n.TreeOrder?[...g].reverse():g,[c,g]);F.useEffect(()=>{if(!o||!g.length||!I){v();return}for(const R of C){if((r==null?void 0:r(R))===!1)continue;const S=g.indexOf(R),A=p[S];if(!A)continue;const{direction:N,speed:k}=Ia(R,A,I,t,f);for(const D of["x","y"])y[D][N[D]]||(k[D]=0,N[D]=0);if(k.x>0||k.y>0){v(),m.current=R,b(_,a),O.current=k,T.current=N;return}}O.current={x:0,y:0},T.current={x:0,y:0},v()},[t,_,r,v,o,a,JSON.stringify(I),JSON.stringify(y),b,g,C,p,JSON.stringify(f)])}const Ya={x:{[mt.Backward]:!1,[mt.Forward]:!1},y:{[mt.Backward]:!1,[mt.Forward]:!1}};function $a(e){let{delta:t,disabled:n}=e;const r=qn(t);return Cn(s=>{if(n||!r||!s)return Ya;const o={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[mt.Backward]:s.x[mt.Backward]||o.x===-1,[mt.Forward]:s.x[mt.Forward]||o.x===1},y:{[mt.Backward]:s.y[mt.Backward]||o.y===-1,[mt.Forward]:s.y[mt.Forward]||o.y===1}}},[n,t,r])}function Ka(e,t){const n=t!==null?e.get(t):void 0,r=n?n.node.current:null;return Cn(s=>{var o;return t===null?null:(o=r??s)!=null?o:null},[r,t])}function Ja(e,t){return F.useMemo(()=>e.reduce((n,r)=>{const{sensor:s}=r,o=s.activators.map(a=>({eventName:a.eventName,handler:t(a.handler,r)}));return[...n,...o]},[]),[e,t])}var dn;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(dn||(dn={}));var Vr;(function(e){e.Optimized="optimized"})(Vr||(Vr={}));const Bi=new Map;function Ga(e,t){let{dragging:n,dependencies:r,config:s}=t;const[o,a]=F.useState(null),{frequency:c,measure:l,strategy:g}=s,p=F.useRef(e),h=O(),f=un(h),y=F.useCallback(function(T){T===void 0&&(T=[]),!f.current&&a(I=>I===null?T:I.concat(T.filter(m=>!I.includes(m))))},[f]),b=F.useRef(null),v=Cn(T=>{if(h&&!n)return Bi;if(!T||T===Bi||p.current!==e||o!=null){const I=new Map;for(let m of e){if(!m)continue;if(o&&o.length>0&&!o.includes(m.id)&&m.rect.current){I.set(m.id,m.rect.current);continue}const _=m.node.current,C=_?new ri(l(_),_):null;m.rect.current=C,C&&I.set(m.id,C)}return I}return T},[e,o,n,h,l]);return F.useEffect(()=>{p.current=e},[e]),F.useEffect(()=>{h||y()},[n,h]),F.useEffect(()=>{o&&o.length>0&&a(null)},[JSON.stringify(o)]),F.useEffect(()=>{h||typeof c!="number"||b.current!==null||(b.current=setTimeout(()=>{y(),b.current=null},c))},[c,h,y,...r]),{droppableRects:v,measureDroppableContainers:y,measuringScheduled:o!=null};function O(){switch(g){case dn.Always:return!1;case dn.BeforeDragging:return n;default:return!n}}}function si(e,t){return Cn(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Xa(e,t){return si(e,t)}function Za(e){let{callback:t,disabled:n}=e;const r=cr(t),s=F.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return F.useEffect(()=>()=>s==null?void 0:s.disconnect(),[s]),s}function ur(e){let{callback:t,disabled:n}=e;const r=cr(t),s=F.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return F.useEffect(()=>()=>s==null?void 0:s.disconnect(),[s]),s}function Qa(e){return new ri(Sn(e),e)}function Pi(e,t,n){t===void 0&&(t=Qa);const[r,s]=F.useReducer(c,null),o=Za({callback(l){if(e)for(const g of l){const{type:p,target:h}=g;if(p==="childList"&&h instanceof HTMLElement&&h.contains(e)){s();break}}}}),a=ur({callback:s});return te(()=>{s(),e?(a==null||a.observe(e),o==null||o.observe(document.body,{childList:!0,subtree:!0})):(a==null||a.disconnect(),o==null||o.disconnect())},[e]),r;function c(l){if(!e)return null;if(e.isConnected===!1){var g;return(g=l??n)!=null?g:null}const p=t(e);return JSON.stringify(l)===JSON.stringify(p)?l:p}}function tc(e){const t=si(e);return ws(e,t)}const Vi=[];function ec(e){const t=F.useRef(e),n=Cn(r=>e?r&&r!==Vi&&e&&t.current&&e.parentNode===t.current.parentNode?r:ni(e):Vi,[e]);return F.useEffect(()=>{t.current=e},[e]),n}function nc(e){const[t,n]=F.useState(null),r=F.useRef(e),s=F.useCallback(o=>{const a=Sr(o.target);a&&n(c=>c?(c.set(a,Br(a)),new Map(c)):null)},[]);return F.useEffect(()=>{const o=r.current;if(e!==o){a(o);const c=e.map(l=>{const g=Sr(l);return g?(g.addEventListener("scroll",s,{passive:!0}),[g,Br(g)]):null}).filter(l=>l!=null);n(c.length?new Map(c):null),r.current=e}return()=>{a(e),a(o)};function a(c){c.forEach(l=>{const g=Sr(l);g==null||g.removeEventListener("scroll",s)})}},[s,e]),F.useMemo(()=>e.length?t?Array.from(t.values()).reduce((o,a)=>je(o,a),zt):Rs(e):zt,[e,t])}function Wi(e,t){t===void 0&&(t=[]);const n=F.useRef(null);return F.useEffect(()=>{n.current=null},t),F.useEffect(()=>{const r=e!==zt;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?zn(e,n.current):zt}function rc(e){F.useEffect(()=>{if(!ar)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function ic(e,t){return F.useMemo(()=>e.reduce((n,r)=>{let{eventName:s,handler:o}=r;return n[s]=a=>{o(a,t)},n},{}),[e,t])}function Os(e){return F.useMemo(()=>e?Ta(e):null,[e])}const Rr=[];function sc(e,t){t===void 0&&(t=Sn);const[n]=e,r=Os(n?Rt(n):null),[s,o]=F.useReducer(c,Rr),a=ur({callback:o});return e.length>0&&s===Rr&&o(),te(()=>{e.length?e.forEach(l=>a==null?void 0:a.observe(l)):(a==null||a.disconnect(),o())},[e]),s;function c(){return e.length?e.map(l=>Es(l)?r:new ri(t(l),l)):Rr}}function Ls(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return _n(t)?t:e}function oc(e){let{measure:t}=e;const[n,r]=F.useState(null),s=F.useCallback(g=>{for(const{target:p}of g)if(_n(p)){r(h=>{const f=t(p);return h?{...h,width:f.width,height:f.height}:f});break}},[t]),o=ur({callback:s}),a=F.useCallback(g=>{const p=Ls(g);o==null||o.disconnect(),p&&(o==null||o.observe(p)),r(p?t(p):null)},[t,o]),[c,l]=Wn(a);return F.useMemo(()=>({nodeRef:c,rect:n,setRef:l}),[n,c,l])}const ac=[{sensor:xs,options:{}},{sensor:Ts,options:{}}],cc={current:{}},Fn={draggable:{measure:Ni},droppable:{measure:Ni,strategy:dn.WhileDragging,frequency:Vr.Optimized},dragOverlay:{measure:Sn}};class an extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const lc={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new an,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Yn},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Fn,measureDroppableContainers:Yn,windowRect:null,measuringScheduled:!1},Is={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Yn,draggableNodes:new Map,over:null,measureDroppableContainers:Yn},En=F.createContext(Is),Ms=F.createContext(lc);function uc(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new an}}}function hc(e,t){switch(t.type){case ft.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case ft.DragMove:return e.draggable.active?{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}}:e;case ft.DragEnd:case ft.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case ft.RegisterDroppable:{const{element:n}=t,{id:r}=n,s=new an(e.droppable.containers);return s.set(r,n),{...e,droppable:{...e.droppable,containers:s}}}case ft.SetDroppableDisabled:{const{id:n,key:r,disabled:s}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const a=new an(e.droppable.containers);return a.set(n,{...o,disabled:s}),{...e,droppable:{...e.droppable,containers:a}}}case ft.UnregisterDroppable:{const{id:n,key:r}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;const o=new an(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function dc(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:s}=F.useContext(En),o=qn(r),a=qn(n==null?void 0:n.id);return F.useEffect(()=>{if(!t&&!r&&o&&a!=null){if(!ei(o)||document.activeElement===o.target)return;const c=s.get(a);if(!c)return;const{activatorNode:l,node:g}=c;if(!l.current&&!g.current)return;requestAnimationFrame(()=>{for(const p of[l.current,g.current]){if(!p)continue;const h=ca(p);if(h){h.focus();break}}})}},[r,t,s,a,o]),null}function Ns(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((s,o)=>o({transform:s,...r}),n):n}function fc(e){return F.useMemo(()=>({draggable:{...Fn.draggable,...e==null?void 0:e.draggable},droppable:{...Fn.droppable,...e==null?void 0:e.droppable},dragOverlay:{...Fn.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function gc(e){let{activeNode:t,measure:n,initialRect:r,config:s=!0}=e;const o=F.useRef(!1),{x:a,y:c}=typeof s=="boolean"?{x:s,y:s}:s;te(()=>{if(!a&&!c||!t){o.current=!1;return}if(o.current||!r)return;const g=t==null?void 0:t.node.current;if(!g||g.isConnected===!1)return;const p=n(g),h=ws(p,r);if(a||(h.x=0),c||(h.y=0),o.current=!0,Math.abs(h.x)>0||Math.abs(h.y)>0){const f=_s(g);f&&f.scrollBy({top:h.y,left:h.x})}},[t,a,c,r,n])}const hr=F.createContext({...zt,scaleX:1,scaleY:1});var we;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(we||(we={}));const pc=F.memo(function(t){var n,r,s,o;let{id:a,accessibility:c,autoScroll:l=!0,children:g,sensors:p=ac,collisionDetection:h=Sa,measuring:f,modifiers:y,...b}=t;const v=F.useReducer(hc,void 0,uc),[O,T]=v,[I,m]=pa(),[_,C]=F.useState(we.Uninitialized),R=_===we.Initialized,{draggable:{active:S,nodes:A,translate:N},droppable:{containers:k}}=O,D=S?A.get(S):null,j=F.useRef({initial:null,translated:null}),P=F.useMemo(()=>{var Ct;return S!=null?{id:S,data:(Ct=D==null?void 0:D.data)!=null?Ct:cc,rect:j}:null},[S,D]),z=F.useRef(null),[K,X]=F.useState(null),[et,_t]=F.useState(null),H=un(b,Object.values(b)),Ht=lr("DndDescribedBy",a),Dt=F.useMemo(()=>k.getEnabled(),[k]),Et=fc(f),{droppableRects:nt,measureDroppableContainers:Q,measuringScheduled:At}=Ga(Dt,{dragging:R,dependencies:[N.x,N.y],config:Et.droppable}),ut=Ka(A,S),Bt=F.useMemo(()=>et?Hn(et):null,[et]),pe=ta(),Yt=Xa(ut,Et.draggable.measure);gc({activeNode:S?A.get(S):null,config:pe.layoutShiftCompensation,initialRect:Yt,measure:Et.draggable.measure});const ht=Pi(ut,Et.draggable.measure,Yt),ae=Pi(ut?ut.parentElement:null),kt=F.useRef({activatorEvent:null,active:null,activeNode:ut,collisionRect:null,collisions:null,droppableRects:nt,draggableNodes:A,draggingNode:null,draggingNodeRect:null,droppableContainers:k,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Tt=k.getNodeFor((n=kt.current.over)==null?void 0:n.id),dt=oc({measure:Et.dragOverlay.measure}),L=(r=dt.nodeRef.current)!=null?r:ut,M=R?(s=dt.rect)!=null?s:ht:null,B=!!(dt.nodeRef.current&&dt.rect),W=tc(B?null:ht),w=Os(L?Rt(L):null),i=ec(R?Tt??ut:null),u=sc(i),d=Ns(y,{transform:{x:N.x-W.x,y:N.y-W.y,scaleX:1,scaleY:1},activatorEvent:et,active:P,activeNodeRect:ht,containerNodeRect:ae,draggingNodeRect:M,over:kt.current.over,overlayNodeRect:dt.rect,scrollableAncestors:i,scrollableAncestorRects:u,windowRect:w}),E=Bt?je(Bt,N):null,x=nc(i),U=Wi(x),V=Wi(x,[ht]),Y=je(d,U),tt=M?Ra(M,d):null,J=P&&tt?h({active:P,collisionRect:tt,droppableRects:nt,droppableContainers:Dt,pointerCoordinates:E}):null,G=_a(J,"id"),[rt,$t]=F.useState(null),ye=B?d:je(d,V),ke=Ea(ye,(o=rt==null?void 0:rt.rect)!=null?o:null,ht),ce=F.useCallback((Ct,xt)=>{let{sensor:Ot,options:me}=xt;if(z.current==null)return;const It=A.get(z.current);if(!It)return;const Pt=Ct.nativeEvent,Kt=new Ot({active:z.current,activeNode:It,event:Pt,options:me,context:kt,onStart(Vt){const Qe=z.current;if(Qe==null)return;const tn=A.get(Qe);if(!tn)return;const{onDragStart:xn}=H.current,On={active:{id:Qe,data:tn.data,rect:j}};Fe.unstable_batchedUpdates(()=>{xn==null||xn(On),C(we.Initializing),T({type:ft.DragStart,initialCoordinates:Vt,active:Qe}),I({type:"onDragStart",event:On})})},onMove(Vt){T({type:ft.DragMove,coordinates:Vt})},onEnd:Ue(ft.DragEnd),onCancel:Ue(ft.DragCancel)});Fe.unstable_batchedUpdates(()=>{X(Kt),_t(Ct.nativeEvent)});function Ue(Vt){return async function(){const{active:tn,collisions:xn,over:On,scrollAdjustedTranslate:Ii}=kt.current;let en=null;if(tn&&Ii){const{cancelDrop:nn}=H.current;en={activatorEvent:Pt,active:tn,collisions:xn,delta:Ii,over:On},Vt===ft.DragEnd&&typeof nn=="function"&&await Promise.resolve(nn(en))&&(Vt=ft.DragCancel)}z.current=null,Fe.unstable_batchedUpdates(()=>{T({type:Vt}),C(we.Uninitialized),$t(null),X(null),_t(null);const nn=Vt===ft.DragEnd?"onDragEnd":"onDragCancel";if(en){const _r=H.current[nn];_r==null||_r(en),I({type:nn,event:en})}})}}},[A]),be=F.useCallback((Ct,xt)=>(Ot,me)=>{const It=Ot.nativeEvent,Pt=A.get(me);if(z.current!==null||!Pt||It.dndKit||It.defaultPrevented)return;const Kt={active:Pt};Ct(Ot,xt.options,Kt)===!0&&(It.dndKit={capturedBy:xt.sensor},z.current=me,ce(Ot,xt))},[A,ce]),Li=Ja(p,be);rc(p),te(()=>{ht&&_===we.Initializing&&C(we.Initialized)},[ht,_]),F.useEffect(()=>{const{onDragMove:Ct}=H.current,{active:xt,activatorEvent:Ot,collisions:me,over:It}=kt.current;if(!xt||!Ot)return;const Pt={active:xt,activatorEvent:Ot,collisions:me,delta:{x:Y.x,y:Y.y},over:It};Fe.unstable_batchedUpdates(()=>{Ct==null||Ct(Pt),I({type:"onDragMove",event:Pt})})},[Y.x,Y.y]),F.useEffect(()=>{const{active:Ct,activatorEvent:xt,collisions:Ot,droppableContainers:me,scrollAdjustedTranslate:It}=kt.current;if(!Ct||z.current==null||!xt||!It)return;const{onDragOver:Pt}=H.current,Kt=me.get(G),Ue=Kt&&Kt.rect.current?{id:Kt.id,rect:Kt.rect.current,data:Kt.data,disabled:Kt.disabled}:null,Vt={active:Ct,activatorEvent:xt,collisions:Ot,delta:{x:It.x,y:It.y},over:Ue};Fe.unstable_batchedUpdates(()=>{$t(Ue),Pt==null||Pt(Vt),I({type:"onDragOver",event:Vt})})},[G]),te(()=>{kt.current={activatorEvent:et,active:P,activeNode:ut,collisionRect:tt,collisions:J,droppableRects:nt,draggableNodes:A,draggingNode:L,draggingNodeRect:M,droppableContainers:k,over:rt,scrollableAncestors:i,scrollAdjustedTranslate:Y},j.current={initial:M,translated:tt}},[P,ut,J,tt,A,L,M,nt,k,rt,i,Y]),Ha({...pe,delta:N,draggingRect:tt,pointerCoordinates:E,scrollableAncestors:i,scrollableAncestorRects:u});const Zo=F.useMemo(()=>({active:P,activeNode:ut,activeNodeRect:ht,activatorEvent:et,collisions:J,containerNodeRect:ae,dragOverlay:dt,draggableNodes:A,droppableContainers:k,droppableRects:nt,over:rt,measureDroppableContainers:Q,scrollableAncestors:i,scrollableAncestorRects:u,measuringConfiguration:Et,measuringScheduled:At,windowRect:w}),[P,ut,ht,et,J,ae,dt,A,k,nt,rt,Q,i,u,Et,At,w]),Qo=F.useMemo(()=>({activatorEvent:et,activators:Li,active:P,activeNodeRect:ht,ariaDescribedById:{draggable:Ht},dispatch:T,draggableNodes:A,over:rt,measureDroppableContainers:Q}),[et,Li,P,ht,T,Ht,A,rt,Q]);return lt.createElement(ms.Provider,{value:m},lt.createElement(En.Provider,{value:Qo},lt.createElement(Ms.Provider,{value:Zo},lt.createElement(hr.Provider,{value:ke},g)),lt.createElement(dc,{disabled:(c==null?void 0:c.restoreFocus)===!1})),lt.createElement(ma,{...c,hiddenTextDescribedById:Ht}));function ta(){const Ct=(K==null?void 0:K.autoScrollEnabled)===!1,xt=typeof l=="object"?l.enabled===!1:l===!1,Ot=R&&!Ct&&!xt;return typeof l=="object"?{...l,enabled:Ot}:{enabled:Ot}}}),yc=F.createContext(null),qi="button",bc="Droppable";function mc(e){let{id:t,data:n,disabled:r=!1,attributes:s}=e;const o=lr(bc),{activators:a,activatorEvent:c,active:l,activeNodeRect:g,ariaDescribedById:p,draggableNodes:h,over:f}=F.useContext(En),{role:y=qi,roleDescription:b="draggable",tabIndex:v=0}=s??{},O=(l==null?void 0:l.id)===t,T=F.useContext(O?hr:yc),[I,m]=Wn(),[_,C]=Wn(),R=ic(a,t),S=un(n);te(()=>(h.set(t,{id:t,key:o,node:I,activatorNode:_,data:S}),()=>{const N=h.get(t);N&&N.key===o&&h.delete(t)}),[h,t]);const A=F.useMemo(()=>({role:y,tabIndex:v,"aria-disabled":r,"aria-pressed":O&&y===qi?!0:void 0,"aria-roledescription":b,"aria-describedby":p.draggable}),[r,y,v,O,b,p.draggable]);return{active:l,activatorEvent:c,activeNodeRect:g,attributes:A,isDragging:O,listeners:r?void 0:R,node:I,over:f,setNodeRef:m,setActivatorNodeRef:C,transform:T}}function wc(){return F.useContext(Ms)}const vc="Droppable",_c={timeout:25};function Cc(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:s}=e;const o=lr(vc),{active:a,dispatch:c,over:l,measureDroppableContainers:g}=F.useContext(En),p=F.useRef({disabled:n}),h=F.useRef(!1),f=F.useRef(null),y=F.useRef(null),{disabled:b,updateMeasurementsFor:v,timeout:O}={..._c,...s},T=un(v??r),I=F.useCallback(()=>{if(!h.current){h.current=!0;return}y.current!=null&&clearTimeout(y.current),y.current=setTimeout(()=>{g(Array.isArray(T.current)?T.current:[T.current]),y.current=null},O)},[O]),m=ur({callback:I,disabled:b||!a}),_=F.useCallback((A,N)=>{m&&(N&&(m.unobserve(N),h.current=!1),A&&m.observe(A))},[m]),[C,R]=Wn(_),S=un(t);return F.useEffect(()=>{!m||!C.current||(m.disconnect(),h.current=!1,m.observe(C.current))},[C,m]),te(()=>(c({type:ft.RegisterDroppable,element:{id:r,key:o,disabled:n,node:C,rect:f,data:S}}),()=>c({type:ft.UnregisterDroppable,key:o,id:r})),[r]),F.useEffect(()=>{n!==p.current.disabled&&(c({type:ft.SetDroppableDisabled,id:r,key:o,disabled:n}),p.current.disabled=n)},[r,o,n,c]),{active:a,rect:f,isOver:(l==null?void 0:l.id)===r,node:C,over:l,setNodeRef:R}}function Sc(e){let{animation:t,children:n}=e;const[r,s]=F.useState(null),[o,a]=F.useState(null),c=qn(n);return!n&&!r&&c&&s(c),te(()=>{if(!o)return;const l=r==null?void 0:r.key,g=r==null?void 0:r.props.id;if(l==null||g==null){s(null);return}Promise.resolve(t(g,o)).then(()=>{s(null)})},[t,r,o]),lt.createElement(lt.Fragment,null,n,r?F.cloneElement(r,{ref:a}):null)}const Ec={x:0,y:0,scaleX:1,scaleY:1};function kc(e){let{children:t}=e;return lt.createElement(En.Provider,{value:Is},lt.createElement(hr.Provider,{value:Ec},t))}const Rc={position:"fixed",touchAction:"none"},Dc=e=>ei(e)?"transform 250ms ease":void 0,Ac=F.forwardRef((e,t)=>{let{as:n,activatorEvent:r,adjustScale:s,children:o,className:a,rect:c,style:l,transform:g,transition:p=Dc}=e;if(!c)return null;const h=s?g:{...g,scaleX:1,scaleY:1},f={...Rc,width:c.width,height:c.height,top:c.top,left:c.left,transform:hn.Transform.toString(h),transformOrigin:s&&r?wa(r,c):void 0,transition:typeof p=="function"?p(r):p,...l};return lt.createElement(n,{className:a,style:f,ref:t},o)}),Tc=e=>t=>{let{active:n,dragOverlay:r}=t;const s={},{styles:o,className:a}=e;if(o!=null&&o.active)for(const[c,l]of Object.entries(o.active))l!==void 0&&(s[c]=n.node.style.getPropertyValue(c),n.node.style.setProperty(c,l));if(o!=null&&o.dragOverlay)for(const[c,l]of Object.entries(o.dragOverlay))l!==void 0&&r.node.style.setProperty(c,l);return a!=null&&a.active&&n.node.classList.add(a.active),a!=null&&a.dragOverlay&&r.node.classList.add(a.dragOverlay),function(){for(const[l,g]of Object.entries(s))n.node.style.setProperty(l,g);a!=null&&a.active&&n.node.classList.remove(a.active)}},xc=e=>{let{transform:{initial:t,final:n}}=e;return[{transform:hn.Transform.toString(t)},{transform:hn.Transform.toString(n)}]},Oc={duration:250,easing:"ease",keyframes:xc,sideEffects:Tc({styles:{active:{opacity:"0"}}})};function Lc(e){let{config:t,draggableNodes:n,droppableContainers:r,measuringConfiguration:s}=e;return cr((o,a)=>{if(t===null)return;const c=n.get(o);if(!c)return;const l=c.node.current;if(!l)return;const g=Ls(a);if(!g)return;const{transform:p}=Rt(a).getComputedStyle(a),h=vs(p);if(!h)return;const f=typeof t=="function"?t:Ic(t);return Ds(l,s.draggable.measure),f({active:{id:o,data:c.data,node:l,rect:s.draggable.measure(l)},draggableNodes:n,dragOverlay:{node:a,rect:s.dragOverlay.measure(g)},droppableContainers:r,measuringConfiguration:s,transform:h})})}function Ic(e){const{duration:t,easing:n,sideEffects:r,keyframes:s}={...Oc,...e};return o=>{let{active:a,dragOverlay:c,transform:l,...g}=o;if(!t)return;const p={x:c.rect.left-a.rect.left,y:c.rect.top-a.rect.top},h={scaleX:l.scaleX!==1?a.rect.width*l.scaleX/c.rect.width:1,scaleY:l.scaleY!==1?a.rect.height*l.scaleY/c.rect.height:1},f={x:l.x-p.x,y:l.y-p.y,...h},y=s({...g,active:a,dragOverlay:c,transform:{initial:l,final:f}}),[b]=y,v=y[y.length-1];if(JSON.stringify(b)===JSON.stringify(v))return;const O=r==null?void 0:r({active:a,dragOverlay:c,...g}),T=c.node.animate(y,{duration:t,easing:n,fill:"forwards"});return new Promise(I=>{T.onfinish=()=>{O==null||O(),I()}})}}let zi=0;function Mc(e){return F.useMemo(()=>{if(e!=null)return zi++,zi},[e])}const Nc=lt.memo(e=>{let{adjustScale:t=!1,children:n,dropAnimation:r,style:s,transition:o,modifiers:a,wrapperElement:c="div",className:l,zIndex:g=999}=e;const{activatorEvent:p,active:h,activeNodeRect:f,containerNodeRect:y,draggableNodes:b,droppableContainers:v,dragOverlay:O,over:T,measuringConfiguration:I,scrollableAncestors:m,scrollableAncestorRects:_,windowRect:C}=wc(),R=F.useContext(hr),S=Mc(h==null?void 0:h.id),A=Ns(a,{activatorEvent:p,active:h,activeNodeRect:f,containerNodeRect:y,draggingNodeRect:O.rect,over:T,overlayNodeRect:O.rect,scrollableAncestors:m,scrollableAncestorRects:_,transform:R,windowRect:C}),N=si(f),k=Lc({config:r,draggableNodes:b,droppableContainers:v,measuringConfiguration:I}),D=N?O.setRef:void 0;return lt.createElement(kc,null,lt.createElement(Sc,{animation:k},h&&S?lt.createElement(Ac,{key:S,id:h.id,ref:D,as:c,activatorEvent:p,adjustScale:t,className:l,transition:o,rect:N,style:{zIndex:g,...s},transform:A},n):null))}),qt=()=>new Map,Wr=e=>{const t=qt();return e.forEach((n,r)=>{t.set(r,n)}),t},jt=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},Uc=(e,t)=>{const n=[];for(const[r,s]of e)n.push(t(s,r));return n},Fc=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},Ae=()=>new Set,Dr=e=>e[e.length-1],jc=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Se=Array.from,Bc=Array.isArray;class dr{constructor(){this._observers=qt()}on(t,n){jt(this._observers,t,Ae).add(n)}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Se((this._observers.get(t)||qt()).values()).forEach(r=>r(...n))}destroy(){this._observers=qt()}}const ee=Math.floor,jn=Math.abs,Pc=Math.log10,oi=(e,t)=>e<t?e:t,Me=(e,t)=>e>t?e:t,Us=e=>e!==0?e<0:1/e<0,Hi=1,Yi=2,Ar=4,Tr=8,fn=32,ue=64,Lt=128,fr=31,qr=63,Re=127,Vc=2147483647,Fs=Number.MAX_SAFE_INTEGER,Wc=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&ee(e)===e),qc=String.fromCharCode,zc=e=>e.toLowerCase(),Hc=/^\s*/g,Yc=e=>e.replace(Hc,""),$c=/([A-Z])/g,$i=(e,t)=>Yc(e.replace($c,n=>`${t}${zc(n)}`)),Kc=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},gn=typeof TextEncoder<"u"?new TextEncoder:null,Jc=e=>gn.encode(e),zr=gn?Jc:Kc;let cn=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});cn&&cn.decode(new Uint8Array).length===1&&(cn=null);class kn{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const wt=()=>new kn,Gc=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},ot=e=>{const t=new Uint8Array(Gc(e));let n=0;for(let r=0;r<e.bufs.length;r++){const s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},Xc=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Me(n,t)*2),e.cpos=0)},yt=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},pn=yt,q=(e,t)=>{for(;t>Re;)yt(e,Lt|Re&t),t=ee(t/128);yt(e,Re&t)},ai=(e,t)=>{const n=Us(t);for(n&&(t=-t),yt(e,(t>qr?Lt:0)|(n?ue:0)|qr&t),t=ee(t/64);t>0;)yt(e,(t>Re?Lt:0)|Re&t),t=ee(t/128)},Hr=new Uint8Array(3e4),Zc=Hr.length/3,Qc=(e,t)=>{if(t.length<Zc){const n=gn.encodeInto(t,Hr).written||0;q(e,n);for(let r=0;r<n;r++)yt(e,Hr[r])}else at(e,zr(t))},tl=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;q(e,r);for(let s=0;s<r;s++)yt(e,n.codePointAt(s))},Zt=gn&&gn.encodeInto?Qc:tl,gr=(e,t)=>{const n=e.cbuf.length,r=e.cpos,s=oi(n-r,t.length),o=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,o>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Me(n*2,o)),e.cbuf.set(t.subarray(s)),e.cpos=o)},at=(e,t)=>{q(e,t.byteLength),gr(e,t)},ci=(e,t)=>{Xc(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},el=(e,t)=>ci(e,4).setFloat32(0,t,!1),nl=(e,t)=>ci(e,8).setFloat64(0,t,!1),rl=(e,t)=>ci(e,8).setBigInt64(0,t,!1),Ki=new DataView(new ArrayBuffer(4)),il=e=>(Ki.setFloat32(0,e),Ki.getFloat32(0)===e),We=(e,t)=>{switch(typeof t){case"string":yt(e,119),Zt(e,t);break;case"number":Wc(t)&&jn(t)<=Vc?(yt(e,125),ai(e,t)):il(t)?(yt(e,124),el(e,t)):(yt(e,123),nl(e,t));break;case"bigint":yt(e,122),rl(e,t);break;case"object":if(t===null)yt(e,126);else if(Bc(t)){yt(e,117),q(e,t.length);for(let n=0;n<t.length;n++)We(e,t[n])}else if(t instanceof Uint8Array)yt(e,116),at(e,t);else{yt(e,118);const n=Object.keys(t);q(e,n.length);for(let r=0;r<n.length;r++){const s=n[r];Zt(e,s),We(e,t[s])}}break;case"boolean":yt(e,t?120:121);break;default:yt(e,127)}};class Ji extends kn{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&q(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Gi=e=>{e.count>0&&(ai(e.encoder,e.count===1?e.s:-e.s),e.count>1&&q(e.encoder,e.count-2))};class Bn{constructor(){this.encoder=new kn,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Gi(this),this.count=1,this.s=t)}toUint8Array(){return Gi(this),ot(this.encoder)}}const Xi=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);ai(e.encoder,t),e.count>1&&q(e.encoder,e.count-2)}};class xr{constructor(){this.encoder=new kn,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Xi(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Xi(this),ot(this.encoder)}}class sl{constructor(){this.sarr=[],this.s="",this.lensE=new Bn}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new kn;return this.sarr.push(this.s),this.s="",Zt(t,this.sarr.join("")),gr(t,this.lensE.toUint8Array()),ot(t)}}const ne=e=>new Error(e),Qt=()=>{throw ne("Method unimplemented")},re=()=>{throw ne("Unexpected case")},js=ne("Unexpected end of array"),Bs=ne("Integer out of Range");class pr{constructor(t){this.arr=t,this.pos=0}}const oe=e=>new pr(e),ol=e=>e.pos!==e.arr.length,al=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},bt=e=>al(e,$(e)),Te=e=>e.arr[e.pos++],$=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const s=e.arr[e.pos++];if(t=t+(s&Re)*n,n*=128,s<Lt)return t;if(t>Fs)throw Bs}throw js},li=e=>{let t=e.arr[e.pos++],n=t&qr,r=64;const s=(t&ue)>0?-1:1;if(!(t&Lt))return s*n;const o=e.arr.length;for(;e.pos<o;){if(t=e.arr[e.pos++],n=n+(t&Re)*r,r*=128,t<Lt)return s*n;if(n>Fs)throw Bs}throw js},cl=e=>{let t=$(e);if(t===0)return"";{let n=String.fromCodePoint(Te(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Te(e));else for(;t>0;){const r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},ll=e=>cn.decode(bt(e)),he=cn?ll:cl,ui=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},ul=e=>ui(e,4).getFloat32(0,!1),hl=e=>ui(e,8).getFloat64(0,!1),dl=e=>ui(e,8).getBigInt64(0,!1),fl=[e=>{},e=>null,li,ul,hl,dl,e=>!1,e=>!0,he,e=>{const t=$(e),n={};for(let r=0;r<t;r++){const s=he(e);n[s]=qe(e)}return n},e=>{const t=$(e),n=[];for(let r=0;r<t;r++)n.push(qe(e));return n},bt],qe=e=>fl[127-Te(e)](e);class Zi extends pr{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),ol(this)?this.count=$(this)+1:this.count=-1),this.count--,this.s}}class Pn extends pr{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=li(this);const t=Us(this.s);this.count=1,t&&(this.s=-this.s,this.count=$(this)+2)}return this.count--,this.s}}class Or extends pr{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=li(this),n=t&1;this.diff=ee(t/2),this.count=1,n&&(this.count=$(this)+2)}return this.s+=this.diff,this.count--,this.s}}class gl{constructor(t){this.decoder=new Pn(t),this.str=he(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const pl=crypto.getRandomValues.bind(crypto),yl=Math.random,Ps=()=>pl(new Uint32Array(1))[0],bl=[1e7]+-1e3+-4e3+-8e3+-1e11,Vs=()=>bl.replace(/[018]/g,e=>(e^Ps()&15>>e/4).toString(16)),de=Date.now,Qi=e=>new Promise(e);Promise.all.bind(Promise);const ml=e=>Promise.reject(e),hi=e=>Promise.resolve(e),ts=e=>e===void 0?null:e;class wl{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let Ws=new wl,di=!0;try{typeof localStorage<"u"&&localStorage&&(Ws=localStorage,di=!1)}catch{}const qs=Ws,vl=e=>di||addEventListener("storage",e),_l=e=>di||removeEventListener("storage",e),Cl=Object.assign,Sl=Object.keys,El=(e,t)=>{for(const n in e)t(e[n],n)},Kn=e=>Sl(e).length,kl=e=>{for(const t in e)return!1;return!0},Rl=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},zs=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Dl=(e,t)=>e===t||Kn(e)===Kn(t)&&Rl(e,(n,r)=>(n!==void 0||zs(t,r))&&t[r]===n),fi=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&fi(e,t,n+1)}},Al=()=>{},Tl=e=>e,xl=(e,t)=>e===t,ln=(e,t)=>{if(e==null||t==null)return xl(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!ln(e.get(n),t.get(n)))return!1;break}case Object:if(Kn(e)!==Kn(t))return!1;for(const n in e)if(!zs(e,n)||!ln(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!ln(e[n],t[n]))return!1;break;default:return!1}return!0},Ol=(e,t)=>t.includes(e),ze=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",Hs=typeof window<"u"&&typeof document<"u"&&!ze;let Gt;const Ll=()=>{if(Gt===void 0)if(ze){Gt=qt();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Gt.set(t,""),t=r):t!==null&&(Gt.set(t,r),t=null)}t!==null&&Gt.set(t,"")}else typeof location=="object"?(Gt=qt(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Gt.set(`--${$i(t,"-")}`,n),Gt.set(`-${$i(t,"-")}`,n)}})):Gt=qt();return Gt},Yr=e=>Ll().has(e),Jn=e=>ts(ze?process.env[e.toUpperCase()]:qs.getItem(e)),Il=e=>Yr("--"+e)||Jn(e)!==null;Il("production");const es=ze&&Ol({}.FORCE_COLOR,["true","1","2"]),Ml=!Yr("no-colors")&&(!ze||process.stdout.isTTY||es)&&(!ze||Yr("color")||es||Jn("COLORTERM")!==null||(Jn("TERM")||"").includes("color")),Ys=e=>new Uint8Array(e),Nl=(e,t,n)=>new Uint8Array(e,t,n),Ul=e=>new Uint8Array(e),Fl=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=qc(e[n]);return btoa(t)},jl=e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),Bl=e=>{const t=atob(e),n=Ys(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n},Pl=e=>{const t=Buffer.from(e,"base64");return Nl(t.buffer,t.byteOffset,t.byteLength)},$s=Hs?Fl:jl,Ks=Hs?Bl:Pl,Vl=e=>{const t=Ys(e.byteLength);return t.set(e),t};class Wl{constructor(t,n){this.left=t,this.right=n}}const le=(e,t)=>new Wl(e,t);typeof DOMParser<"u"&&new DOMParser;const ql=e=>Uc(e,(t,n)=>`${n}:${t};`).join(""),fe=Symbol,Ft=fe(),xe=fe(),Js=fe(),gi=fe(),Gs=fe(),Xs=fe(),Zs=fe(),pi=fe(),yr=fe(),zl=e=>{const t=[];let n=0;for(;n<e.length;n++){const r=e[n];r.constructor===String||r.constructor===Number||r.constructor===Object&&t.push(JSON.stringify(r))}return t},ns=[Gs,Zs,pi,Js];let Lr=0,rs=de();const Hl=(e,t)=>{const n=ns[Lr],r=Jn("log"),s=r!==null&&(r==="*"||r==="true"||new RegExp(r,"gi").test(t));return Lr=(Lr+1)%ns.length,t+=": ",s?(...o)=>{const a=de(),c=a-rs;rs=a,e(n,t,yr,...o.map(l=>typeof l=="string"||typeof l=="symbol"?l:JSON.stringify(l)),n," +"+c+"ms")}:Al},Yl={[Ft]:le("font-weight","bold"),[xe]:le("font-weight","normal"),[Js]:le("color","blue"),[Gs]:le("color","green"),[gi]:le("color","grey"),[Xs]:le("color","red"),[Zs]:le("color","purple"),[pi]:le("color","orange"),[yr]:le("color","black")},$l=e=>{const t=[],n=[],r=qt();let s=[],o=0;for(;o<e.length;o++){const a=e[o],c=Yl[a];if(c!==void 0)r.set(c.left,c.right);else if(a.constructor===String||a.constructor===Number){const l=ql(r);o>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}for(o>0&&(s=n,s.unshift(t.join("")));o<e.length;o++){const a=e[o];a instanceof Symbol||s.push(a)}return s},Kl=Ml?$l:zl,Qs=(...e)=>{console.log(...Kl(e)),Jl.forEach(t=>t.print(e))},Jl=Ae(),Gl=e=>Hl(Qs,e),to=e=>({[Symbol.iterator](){return this},next:e}),Xl=(e,t)=>to(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Ir=(e,t)=>to(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class yi{constructor(t,n){this.clock=t,this.len=n}}class Rn{constructor(){this.clients=new Map}}const eo=(e,t,n)=>t.clients.forEach((r,s)=>{const o=e.doc.store.clients.get(s);for(let a=0;a<r.length;a++){const c=r[a];po(e,o,c.clock,c.len,n)}}),Zl=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const s=ee((n+r)/2),o=e[s],a=o.clock;if(a<=t){if(t<a+o.len)return s;n=s+1}else r=s-1}return null},no=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&Zl(n,t.clock)!==null},bi=e=>{e.clients.forEach(t=>{t.sort((s,o)=>s.clock-o.clock);let n,r;for(n=1,r=1;n<t.length;n++){const s=t[r-1],o=t[n];s.clock+s.len>=o.clock?s.len=Me(s.len,o.clock+o.len-s.clock):(r<n&&(t[r]=o),r++)}t.length=r})},Ql=e=>{const t=new Rn;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){const o=r.slice();for(let a=n+1;a<e.length;a++)jc(o,e[a].clients.get(s)||[]);t.clients.set(s,o)}});return bi(t),t},Gn=(e,t,n,r)=>{jt(e.clients,t,()=>[]).push(new yi(n,r))},tu=()=>new Rn,eu=e=>{const t=tu();return e.clients.forEach((n,r)=>{const s=[];for(let o=0;o<n.length;o++){const a=n[o];if(a.deleted){const c=a.id.clock;let l=a.length;if(o+1<n.length)for(let g=n[o+1];o+1<n.length&&g.deleted;g=n[++o+1])l+=g.length;s.push(new yi(c,l))}}s.length>0&&t.clients.set(r,s)}),t},Ge=(e,t)=>{q(e.restEncoder,t.clients.size),Se(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),q(e.restEncoder,n);const s=r.length;q(e.restEncoder,s);for(let o=0;o<s;o++){const a=r[o];e.writeDsClock(a.clock),e.writeDsLen(a.len)}})},mi=e=>{const t=new Rn,n=$(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const s=$(e.restDecoder),o=$(e.restDecoder);if(o>0){const a=jt(t.clients,s,()=>[]);for(let c=0;c<o;c++)a.push(new yi(e.readDsClock(),e.readDsLen()))}}return t},is=(e,t,n)=>{const r=new Rn,s=$(e.restDecoder);for(let o=0;o<s;o++){e.resetDsCurVal();const a=$(e.restDecoder),c=$(e.restDecoder),l=n.clients.get(a)||[],g=vt(n,a);for(let p=0;p<c;p++){const h=e.readDsClock(),f=h+e.readDsLen();if(h<g){g<f&&Gn(r,a,g,f-g);let y=ie(l,h),b=l[y];for(!b.deleted&&b.id.clock<h&&(l.splice(y+1,0,rr(t,b,h-b.id.clock)),y++);y<l.length&&(b=l[y++],b.id.clock<f);)b.deleted||(f<b.id.clock+b.length&&l.splice(y,0,rr(t,b,f-b.id.clock)),b.delete(t))}else Gn(r,a,h,f-h)}}if(r.clients.size>0){const o=new Oe;return q(o.restEncoder,0),Ge(o,r),o.toUint8Array()}return null},ro=Ps;class Xe extends dr{constructor({guid:t=Vs(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:o=null,autoLoad:a=!1,shouldLoad:c=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=ro(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new fo,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=a,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Qi(g=>{this.on("load",()=>{this.isLoaded=!0,g(this)})});const l=()=>Qi(g=>{const p=h=>{(h===void 0||h===!0)&&(this.off("sync",p),g())};this.on("sync",p)});this.on("sync",g=>{g===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=g===void 0||g===!0,this.isLoaded||this.emit("load",[])}),this.whenSynced=l()}load(){const t=this._item;t!==null&&!this.shouldLoad&&st(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Se(this.subdocs).map(t=>t.guid))}transact(t,n=null){return st(this,t,n)}get(t,n=St){const r=jt(this.share,t,()=>{const o=new n;return o._integrate(this,null),o}),s=r.constructor;if(n!==St&&s!==n)if(s===St){const o=new n;o._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=o}),o._start=r._start;for(let a=o._start;a!==null;a=a.right)a.parent=o;return o._length=r._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Pe)}getText(t=""){return this.get(t,$e)}getMap(t=""){return this.get(t,Ye)}getXmlFragment(t=""){return this.get(t,Le)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){Se(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Xe({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,st(t.parent.doc,r=>{const s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,n){super.on(t,n)}off(t,n){super.off(t,n)}}class io{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return $(this.restDecoder)}readDsLen(){return $(this.restDecoder)}}class so extends io{readLeftID(){return Z($(this.restDecoder),$(this.restDecoder))}readRightID(){return Z($(this.restDecoder),$(this.restDecoder))}readClient(){return $(this.restDecoder)}readInfo(){return Te(this.restDecoder)}readString(){return he(this.restDecoder)}readParentInfo(){return $(this.restDecoder)===1}readTypeRef(){return $(this.restDecoder)}readLen(){return $(this.restDecoder)}readAny(){return qe(this.restDecoder)}readBuf(){return Vl(bt(this.restDecoder))}readJSON(){return JSON.parse(he(this.restDecoder))}readKey(){return he(this.restDecoder)}}class nu{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=$(this.restDecoder),this.dsCurrVal}readDsLen(){const t=$(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class He extends nu{constructor(t){super(t),this.keys=[],$(t),this.keyClockDecoder=new Or(bt(t)),this.clientDecoder=new Pn(bt(t)),this.leftClockDecoder=new Or(bt(t)),this.rightClockDecoder=new Or(bt(t)),this.infoDecoder=new Zi(bt(t),Te),this.stringDecoder=new gl(bt(t)),this.parentInfoDecoder=new Zi(bt(t),Te),this.typeRefDecoder=new Pn(bt(t)),this.lenDecoder=new Pn(bt(t))}readLeftID(){return new Be(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Be(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return qe(this.restDecoder)}readBuf(){return bt(this.restDecoder)}readJSON(){return qe(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class oo{constructor(){this.restEncoder=wt()}toUint8Array(){return ot(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){q(this.restEncoder,t)}writeDsLen(t){q(this.restEncoder,t)}}class Dn extends oo{writeLeftID(t){q(this.restEncoder,t.client),q(this.restEncoder,t.clock)}writeRightID(t){q(this.restEncoder,t.client),q(this.restEncoder,t.clock)}writeClient(t){q(this.restEncoder,t)}writeInfo(t){pn(this.restEncoder,t)}writeString(t){Zt(this.restEncoder,t)}writeParentInfo(t){q(this.restEncoder,t?1:0)}writeTypeRef(t){q(this.restEncoder,t)}writeLen(t){q(this.restEncoder,t)}writeAny(t){We(this.restEncoder,t)}writeBuf(t){at(this.restEncoder,t)}writeJSON(t){Zt(this.restEncoder,JSON.stringify(t))}writeKey(t){Zt(this.restEncoder,t)}}class ao{constructor(){this.restEncoder=wt(),this.dsCurrVal=0}toUint8Array(){return ot(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,q(this.restEncoder,n)}writeDsLen(t){t===0&&re(),q(this.restEncoder,t-1),this.dsCurrVal+=t}}class Oe extends ao{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new xr,this.clientEncoder=new Bn,this.leftClockEncoder=new xr,this.rightClockEncoder=new xr,this.infoEncoder=new Ji(pn),this.stringEncoder=new sl,this.parentInfoEncoder=new Ji(pn),this.typeRefEncoder=new Bn,this.lenEncoder=new Bn}toUint8Array(){const t=wt();return q(t,0),at(t,this.keyClockEncoder.toUint8Array()),at(t,this.clientEncoder.toUint8Array()),at(t,this.leftClockEncoder.toUint8Array()),at(t,this.rightClockEncoder.toUint8Array()),at(t,ot(this.infoEncoder)),at(t,this.stringEncoder.toUint8Array()),at(t,ot(this.parentInfoEncoder)),at(t,this.typeRefEncoder.toUint8Array()),at(t,this.lenEncoder.toUint8Array()),gr(t,ot(this.restEncoder)),ot(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){We(this.restEncoder,t)}writeBuf(t){at(this.restEncoder,t)}writeJSON(t){We(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const ru=(e,t,n,r)=>{r=Me(r,t[0].id.clock);const s=ie(t,r);q(e.restEncoder,t.length-s),e.writeClient(n),q(e.restEncoder,r);const o=t[s];o.write(e,r-o.id.clock);for(let a=s+1;a<t.length;a++)t[a].write(e,0)},wi=(e,t,n)=>{const r=new Map;n.forEach((s,o)=>{vt(t,o)>s&&r.set(o,s)}),br(t).forEach((s,o)=>{n.has(o)||r.set(o,0)}),q(e.restEncoder,r.size),Se(r.entries()).sort((s,o)=>o[0]-s[0]).forEach(([s,o])=>{ru(e,t.clients.get(s),s,o)})},iu=(e,t)=>{const n=qt(),r=$(e.restDecoder);for(let s=0;s<r;s++){const o=$(e.restDecoder),a=new Array(o),c=e.readClient();let l=$(e.restDecoder);n.set(c,{i:0,refs:a});for(let g=0;g<o;g++){const p=e.readInfo();switch(fr&p){case 0:{const h=e.readLen();a[g]=new Nt(Z(c,l),h),l+=h;break}case 10:{const h=$(e.restDecoder);a[g]=new Ut(Z(c,l),h),l+=h;break}default:{const h=(p&(ue|Lt))===0,f=new gt(Z(c,l),null,(p&Lt)===Lt?e.readLeftID():null,null,(p&ue)===ue?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(p&fn)===fn?e.readString():null,Mo(e,p));a[g]=f,l+=f.length}}}}return n},su=(e,t,n)=>{const r=[];let s=Se(n.keys()).sort((y,b)=>y-b);if(s.length===0)return null;const o=()=>{if(s.length===0)return null;let y=n.get(s[s.length-1]);for(;y.refs.length===y.i;)if(s.pop(),s.length>0)y=n.get(s[s.length-1]);else return null;return y};let a=o();if(a===null&&r.length===0)return null;const c=new fo,l=new Map,g=(y,b)=>{const v=l.get(y);(v==null||v>b)&&l.set(y,b)};let p=a.refs[a.i++];const h=new Map,f=()=>{for(const y of r){const b=y.id.client,v=n.get(b);v?(v.i--,c.clients.set(b,v.refs.slice(v.i)),n.delete(b),v.i=0,v.refs=[]):c.clients.set(b,[y]),s=s.filter(O=>O!==b)}r.length=0};for(;;){if(p.constructor!==Ut){const b=jt(h,p.id.client,()=>vt(t,p.id.client))-p.id.clock;if(b<0)r.push(p),g(p.id.client,p.id.clock-1),f();else{const v=p.getMissing(e,t);if(v!==null){r.push(p);const O=n.get(v)||{refs:[],i:0};if(O.refs.length===O.i)g(v,vt(t,v)),f();else{p=O.refs[O.i++];continue}}else(b===0||b<p.length)&&(p.integrate(e,b),h.set(p.id.client,p.id.clock+p.length))}}if(r.length>0)p=r.pop();else if(a!==null&&a.i<a.refs.length)p=a.refs[a.i++];else{if(a=o(),a===null)break;p=a.refs[a.i++]}}if(c.clients.size>0){const y=new Oe;return wi(y,c,new Map),q(y.restEncoder,0),{missing:l,update:y.toUint8Array()}}return null},ou=(e,t)=>wi(e,t.doc.store,t.beforeState),au=(e,t,n,r=new He(e))=>st(t,s=>{s.local=!1;let o=!1;const a=s.doc,c=a.store,l=iu(r,a),g=su(s,c,l),p=c.pendingStructs;if(p){for(const[f,y]of p.missing)if(y<vt(c,f)){o=!0;break}if(g){for(const[f,y]of g.missing){const b=p.missing.get(f);(b==null||b>y)&&p.missing.set(f,y)}p.update=Xn([p.update,g.update])}}else c.pendingStructs=g;const h=is(r,s,c);if(c.pendingDs){const f=new He(oe(c.pendingDs));$(f.restDecoder);const y=is(f,s,c);h&&y?c.pendingDs=Xn([h,y]):c.pendingDs=h||y}else c.pendingDs=h;if(o){const f=c.pendingStructs.update;c.pendingStructs=null,co(s.doc,f)}},n,!1),co=(e,t,n,r=He)=>{const s=oe(t);au(s,e,n,new r(s))},cu=(e,t,n)=>co(e,t,n,so),lu=(e,t,n=new Map)=>{wi(e,t.store,n),Ge(e,eu(t.store))},uu=(e,t=new Uint8Array([0]),n=new Oe)=>{const r=lo(t);lu(n,e,r);const s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(Ru(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===Dn)return Eu(s.map((o,a)=>a===0?o:Au(o)));if(n.constructor===Oe)return Xn(s)}return s[0]},hu=(e,t)=>uu(e,t,new Dn),du=e=>{const t=new Map,n=$(e.restDecoder);for(let r=0;r<n;r++){const s=$(e.restDecoder),o=$(e.restDecoder);t.set(s,o)}return t},lo=e=>du(new io(oe(e))),uo=(e,t)=>(q(e.restEncoder,t.size),Se(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{q(e.restEncoder,n),q(e.restEncoder,r)}),e),fu=(e,t)=>uo(e,br(t.store)),gu=(e,t=new ao)=>(e instanceof Map?uo(t,e):fu(t,e),t.toUint8Array()),pu=e=>gu(e,new oo);class yu{constructor(){this.l=[]}}const ss=()=>new yu,os=(e,t)=>e.l.push(t),as=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},ho=(e,t,n)=>fi(e.l,[t,n]);class Be{constructor(t,n){this.client=t,this.clock=n}}const Ln=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,Z=(e,t)=>new Be(e,t),bu=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw re()},rn=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!no(t.ds,e.id),$r=(e,t)=>{const n=jt(e.meta,$r,Ae),r=e.doc.store;n.has(t)||(t.sv.forEach((s,o)=>{s<vt(r,o)&&Ee(e,Z(o,s))}),eo(e,t.ds,s=>{}),n.add(t))};class fo{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const br=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},vt=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},go=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw re()}n.push(t)},ie=(e,t)=>{let n=0,r=e.length-1,s=e[r],o=s.id.clock;if(o===t)return r;let a=ee(t/(o+s.length-1)*r);for(;n<=r;){if(s=e[a],o=s.id.clock,o<=t){if(t<o+s.length)return a;n=a+1}else r=a-1;a=ee((n+r)/2)}throw re()},mu=(e,t)=>{const n=e.clients.get(t.client);return n[ie(n,t.clock)]},Mr=mu,Kr=(e,t,n)=>{const r=ie(t,n),s=t[r];return s.id.clock<n&&s instanceof gt?(t.splice(r+1,0,rr(e,s,n-s.id.clock)),r+1):r},Ee=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Kr(e,n,t.clock)]},cs=(e,t,n)=>{const r=t.clients.get(n.client),s=ie(r,n.clock),o=r[s];return n.clock!==o.id.clock+o.length-1&&o.constructor!==Nt&&r.splice(s+1,0,rr(e,o,n.clock-o.id.clock+1)),o},wu=(e,t,n)=>{const r=e.clients.get(t.id.client);r[ie(r,t.id.clock)]=n},po=(e,t,n,r,s)=>{if(r===0)return;const o=n+r;let a=Kr(e,t,n),c;do c=t[a++],o<c.id.clock+c.length&&Kr(e,t,o),s(c);while(a<t.length&&t[a].id.clock<o)};class vu{constructor(t,n,r){this.doc=t,this.deleteSet=new Rn,this.beforeState=br(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const ls=(e,t)=>t.deleteSet.clients.size===0&&!Fc(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(bi(t.deleteSet),ou(e,t),Ge(e,t.deleteSet),!0),us=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&jt(e.changed,t,Ae).add(n)},Vn=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof gt&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const o=t-s;return o&&e.splice(t+1-o,o),o},_u=(e,t,n)=>{for(const[r,s]of e.clients.entries()){const o=t.clients.get(r);for(let a=s.length-1;a>=0;a--){const c=s[a],l=c.clock+c.len;for(let g=ie(o,c.clock),p=o[g];g<o.length&&p.id.clock<l;p=o[++g]){const h=o[g];if(c.clock+c.len<=h.id.clock)break;h instanceof gt&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},Cu=(e,t)=>{e.clients.forEach((n,r)=>{const s=t.clients.get(r);for(let o=n.length-1;o>=0;o--){const a=n[o],c=oi(s.length-1,1+ie(s,a.clock+a.len-1));for(let l=c,g=s[l];l>0&&g.id.clock>=a.clock;g=s[l])l-=1+Vn(s,l)}})},yo=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,s=r.store,o=n.deleteSet,a=n._mergeStructs;try{bi(o),n.afterState=br(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const c=[];n.changed.forEach((l,g)=>c.push(()=>{(g._item===null||!g._item.deleted)&&g._callObserver(n,l)})),c.push(()=>{n.changedParentTypes.forEach((l,g)=>{g._dEH.l.length>0&&(g._item===null||!g._item.deleted)&&(l=l.filter(p=>p.target._item===null||!p.target._item.deleted),l.forEach(p=>{p.currentTarget=g,p._path=null}),l.sort((p,h)=>p.path.length-h.path.length),ho(g._dEH,l,n))})}),c.push(()=>r.emit("afterTransaction",[n,r])),fi(c,[]),n._needFormattingCleanup&&Vu(n)}finally{r.gc&&_u(o,s,r.gcFilter),Cu(o,s),n.afterState.forEach((p,h)=>{const f=n.beforeState.get(h)||0;if(f!==p){const y=s.clients.get(h),b=Me(ie(y,f),1);for(let v=y.length-1;v>=b;)v-=1+Vn(y,v)}});for(let p=a.length-1;p>=0;p--){const{client:h,clock:f}=a[p].id,y=s.clients.get(h),b=ie(y,f);b+1<y.length&&Vn(y,b+1)>1||b>0&&Vn(y,b)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Qs(pi,Ft,"[yjs] ",xe,Xs,"Changed the client-id because another client seems to be using it."),r.clientID=ro()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const p=new Dn;ls(p,n)&&r.emit("update",[p.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const p=new Oe;ls(p,n)&&r.emit("updateV2",[p.toUint8Array(),n.origin,r,n])}const{subdocsAdded:c,subdocsLoaded:l,subdocsRemoved:g}=n;(c.size>0||g.size>0||l.size>0)&&(c.forEach(p=>{p.clientID=r.clientID,p.collectionid==null&&(p.collectionid=r.collectionid),r.subdocs.add(p)}),g.forEach(p=>r.subdocs.delete(p)),r.emit("subdocs",[{loaded:l,added:c,removed:g},r,n]),g.forEach(p=>p.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):yo(e,t+1)}}},st=(e,t,n=null,r=!0)=>{const s=e._transactionCleanups;let o=!1,a=null;e._transaction===null&&(o=!0,e._transaction=new vu(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{a=t(e._transaction)}finally{if(o){const c=e._transaction===s[0];e._transaction=null,c&&yo(s,0)}}return a};function*Su(e){const t=$(e.restDecoder);for(let n=0;n<t;n++){const r=$(e.restDecoder),s=e.readClient();let o=$(e.restDecoder);for(let a=0;a<r;a++){const c=e.readInfo();if(c===10){const l=$(e.restDecoder);yield new Ut(Z(s,o),l),o+=l}else if(fr&c){const l=(c&(ue|Lt))===0,g=new gt(Z(s,o),null,(c&Lt)===Lt?e.readLeftID():null,null,(c&ue)===ue?e.readRightID():null,l?e.readParentInfo()?e.readString():e.readLeftID():null,l&&(c&fn)===fn?e.readString():null,Mo(e,c));yield g,o+=g.length}else{const l=e.readLen();yield new Nt(Z(s,o),l),o+=l}}}}class vi{constructor(t,n){this.gen=Su(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Ut);return this.curr}}class _i{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Eu=e=>Xn(e,so,Dn),ku=(e,t)=>{if(e.constructor===Nt){const{client:n,clock:r}=e.id;return new Nt(Z(n,r+t),e.length-t)}else if(e.constructor===Ut){const{client:n,clock:r}=e.id;return new Ut(Z(n,r+t),e.length-t)}else{const n=e,{client:r,clock:s}=n.id;return new gt(Z(r,s+t),null,Z(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Xn=(e,t=He,n=Oe)=>{if(e.length===1)return e[0];const r=e.map(p=>new t(oe(p)));let s=r.map(p=>new vi(p,!0)),o=null;const a=new n,c=new _i(a);for(;s=s.filter(f=>f.curr!==null),s.sort((f,y)=>{if(f.curr.id.client===y.curr.id.client){const b=f.curr.id.clock-y.curr.id.clock;return b===0?f.curr.constructor===y.curr.constructor?0:f.curr.constructor===Ut?1:-1:b}else return y.curr.id.client-f.curr.id.client}),s.length!==0;){const p=s[0],h=p.curr.id.client;if(o!==null){let f=p.curr,y=!1;for(;f!==null&&f.id.clock+f.length<=o.struct.id.clock+o.struct.length&&f.id.client>=o.struct.id.client;)f=p.next(),y=!0;if(f===null||f.id.client!==h||y&&f.id.clock>o.struct.id.clock+o.struct.length)continue;if(h!==o.struct.id.client)_e(c,o.struct,o.offset),o={struct:f,offset:0},p.next();else if(o.struct.id.clock+o.struct.length<f.id.clock)if(o.struct.constructor===Ut)o.struct.length=f.id.clock+f.length-o.struct.id.clock;else{_e(c,o.struct,o.offset);const b=f.id.clock-o.struct.id.clock-o.struct.length;o={struct:new Ut(Z(h,o.struct.id.clock+o.struct.length),b),offset:0}}else{const b=o.struct.id.clock+o.struct.length-f.id.clock;b>0&&(o.struct.constructor===Ut?o.struct.length-=b:f=ku(f,b)),o.struct.mergeWith(f)||(_e(c,o.struct,o.offset),o={struct:f,offset:0},p.next())}}else o={struct:p.curr,offset:0},p.next();for(let f=p.curr;f!==null&&f.id.client===h&&f.id.clock===o.struct.id.clock+o.struct.length&&f.constructor!==Ut;f=p.next())_e(c,o.struct,o.offset),o={struct:f,offset:0}}o!==null&&(_e(c,o.struct,o.offset),o=null),Ci(c);const l=r.map(p=>mi(p)),g=Ql(l);return Ge(a,g),a.toUint8Array()},Ru=(e,t,n=He,r=Oe)=>{const s=lo(t),o=new r,a=new _i(o),c=new n(oe(e)),l=new vi(c,!1);for(;l.curr;){const p=l.curr,h=p.id.client,f=s.get(h)||0;if(l.curr.constructor===Ut){l.next();continue}if(p.id.clock+p.length>f)for(_e(a,p,Me(f-p.id.clock,0)),l.next();l.curr&&l.curr.id.client===h;)_e(a,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===h&&l.curr.id.clock+l.curr.length<=f;)l.next()}Ci(a);const g=mi(c);return Ge(o,g),o.toUint8Array()},bo=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:ot(e.encoder.restEncoder)}),e.encoder.restEncoder=wt(),e.written=0)},_e=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&bo(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),q(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Ci=e=>{bo(e);const t=e.encoder.restEncoder;q(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];q(t,r.written),gr(t,r.restEncoder)}},Du=(e,t,n,r)=>{const s=new n(oe(e)),o=new vi(s,!1),a=new r,c=new _i(a);for(let g=o.curr;g!==null;g=o.next())_e(c,t(g),0);Ci(c);const l=mi(s);return Ge(a,l),a.toUint8Array()},Au=e=>Du(e,Tl,He,Dn),hs="You must not compute changes after the event-handler fired.";class mr{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Tu(this.currentTarget,this.target))}deletes(t){return no(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw ne(hs);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const o=n._map.get(s);let a,c;if(this.adds(o)){let l=o.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(o))if(l!==null&&this.deletes(l))a="delete",c=Dr(l.content.getContent());else return;else l!==null&&this.deletes(l)?(a="update",c=Dr(l.content.getContent())):(a="add",c=void 0)}else if(this.deletes(o))a="delete",c=Dr(o.content.getContent());else return;t.set(s,{action:a,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw ne(hs);const n=this.target,r=Ae(),s=Ae(),o=[];if(t={added:r,deleted:s,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let c=null;const l=()=>{c&&o.push(c)};for(let g=n._start;g!==null;g=g.right)g.deleted?this.deletes(g)&&!this.adds(g)&&((c===null||c.delete===void 0)&&(l(),c={delete:0}),c.delete+=g.length,s.add(g)):this.adds(g)?((c===null||c.insert===void 0)&&(l(),c={insert:[]}),c.insert=c.insert.concat(g.content.getContent()),r.add(g)):((c===null||c.retain===void 0)&&(l(),c={retain:0}),c.retain+=g.length);c!==null&&c.retain===void 0&&l()}this._changes=t}return t}}const Tu=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)s.deleted||r++,s=s.right;n.unshift(r)}t=t._item.parent}return n},mo=80;let Si=0;class xu{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Si++}}const Ou=e=>{e.timestamp=Si++},wo=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Si++},Lu=(e,t,n)=>{if(e.length>=mo){const r=e.reduce((s,o)=>s.timestamp<o.timestamp?s:o);return wo(r,t,n),r}else{const r=new xu(t,n);return e.push(r),r}},wr=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((o,a)=>jn(t-o.index)<jn(t-a.index)?o:a);let r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,Ou(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&jn(n.index-s)<r.parent.length/mo?(wo(n,r,s),n):Lu(e._searchMarker,r,s)},yn=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const s=e[r];if(n>0){let o=s.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(s.index-=o.length);if(o===null||o.marker===!0){e.splice(r,1);continue}s.p=o,o.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=Me(t,s.index+n))}},vr=(e,t,n)=>{const r=e,s=t.changedParentTypes;for(;jt(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;ho(r._eH,n,t)};class St{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ss(),this._dEH=ss(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Qt()}clone(){throw Qt()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){os(this._eH,t)}observeDeep(t){os(this._dEH,t)}unobserve(t){as(this._eH,t)}unobserveDeep(t){as(this._dEH,t)}toJSON(){}}const vo=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const s=[];let o=e._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){const a=o.content.getContent();if(a.length<=t)t-=a.length;else{for(let c=t;c<a.length&&r>0;c++)s.push(a[c]),r--;t=0}}o=o.right}return s},_o=e=>{const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},bn=(e,t)=>{let n=0,r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let o=0;o<s.length;o++)t(s[o],n++,e)}r=r.right}},Co=(e,t)=>{const n=[];return bn(e,(r,s)=>{n.push(t(r,s,e))}),n},Iu=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},So=(e,t)=>{const n=wr(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Zn=(e,t,n,r)=>{let s=n;const o=e.doc,a=o.clientID,c=o.store,l=n===null?t._start:n.right;let g=[];const p=()=>{g.length>0&&(s=new gt(Z(a,vt(c,a)),s,s&&s.lastId,l,l&&l.id,t,null,new Ie(g)),s.integrate(e,0),g=[])};r.forEach(h=>{if(h===null)g.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:g.push(h);break;default:switch(p(),h.constructor){case Uint8Array:case ArrayBuffer:s=new gt(Z(a,vt(c,a)),s,s&&s.lastId,l,l&&l.id,t,null,new An(new Uint8Array(h))),s.integrate(e,0);break;case Xe:s=new gt(Z(a,vt(c,a)),s,s&&s.lastId,l,l&&l.id,t,null,new Tn(h)),s.integrate(e,0);break;default:if(h instanceof St)s=new gt(Z(a,vt(c,a)),s,s&&s.lastId,l,l&&l.id,t,null,new ge(h)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),p()},Eo=()=>ne("Length exceeded!"),ko=(e,t,n,r)=>{if(n>t._length)throw Eo();if(n===0)return t._searchMarker&&yn(t._searchMarker,n,r.length),Zn(e,t,null,r);const s=n,o=wr(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index,n===0&&(a=a.prev,n+=a&&a.countable&&!a.deleted?a.length:0));a!==null;a=a.right)if(!a.deleted&&a.countable){if(n<=a.length){n<a.length&&Ee(e,Z(a.id.client,a.id.clock+n));break}n-=a.length}return t._searchMarker&&yn(t._searchMarker,s,r.length),Zn(e,t,a,r)},Mu=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((o,a)=>a.index>o.index?a:o,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return Zn(e,t,s,n)},Ro=(e,t,n,r)=>{if(r===0)return;const s=n,o=r,a=wr(t,n);let c=t._start;for(a!==null&&(c=a.p,n-=a.index);c!==null&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&Ee(e,Z(c.id.client,c.id.clock+n)),n-=c.length);for(;r>0&&c!==null;)c.deleted||(r<c.length&&Ee(e,Z(c.id.client,c.id.clock+r)),c.delete(e),r-=c.length),c=c.right;if(r>0)throw Eo();t._searchMarker&&yn(t._searchMarker,s,-o+r)},Qn=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Ei=(e,t,n,r)=>{const s=t._map.get(n)||null,o=e.doc,a=o.clientID;let c;if(r==null)c=new Ie([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:c=new Ie([r]);break;case Uint8Array:c=new An(r);break;case Xe:c=new Tn(r);break;default:if(r instanceof St)c=new ge(r);else throw new Error("Unexpected content type")}new gt(Z(a,vt(o.store,a)),s,s&&s.lastId,null,null,t,n,c).integrate(e,0)},ki=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Do=e=>{const t={};return e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Ao=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted},In=e=>Xl(e.entries(),t=>!t[1].deleted);class Nu extends mr{constructor(t,n){super(t,n),this._transaction=n}}class Pe extends St{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Pe;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Pe}clone(){const t=new Pe;return t.insert(0,this.toArray().map(n=>n instanceof St?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,n){super._callObserver(t,n),vr(this,t,new Nu(this,t))}insert(t,n){this.doc!==null?st(this.doc,r=>{ko(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?st(this.doc,n=>{Mu(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?st(this.doc,r=>{Ro(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return So(this,t)}toArray(){return _o(this)}slice(t=0,n=this.length){return vo(this,t,n)}toJSON(){return this.map(t=>t instanceof St?t.toJSON():t)}map(t){return Co(this,t)}forEach(t){bn(this,t)}[Symbol.iterator](){return Iu(this)}_write(t){t.writeTypeRef(sh)}}const Uu=e=>new Pe;class Fu extends mr{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Ye extends St{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new Ye}clone(){const t=new Ye;return this.forEach((n,r)=>{t.set(r,n instanceof St?n.clone():n)}),t}_callObserver(t,n){vr(this,t,new Fu(this,t,n))}toJSON(){const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];t[r]=s instanceof St?s.toJSON():s}}),t}get size(){return[...In(this._map)].length}keys(){return Ir(In(this._map),t=>t[0])}values(){return Ir(In(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Ir(In(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?st(this.doc,n=>{Qn(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?st(this.doc,r=>{Ei(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return ki(this,t)}has(t){return Ao(this,t)}clear(){this.doc!==null?st(this.doc,t=>{this.forEach(function(n,r,s){Qn(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(oh)}}const ju=e=>new Ye,Ce=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Dl(e,t);class Jr{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&re(),this.right.content.constructor){case pt:this.right.deleted||Ze(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const ds=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case pt:t.right.deleted||Ze(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Ee(e,Z(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Mn=(e,t,n)=>{const r=new Map,s=wr(t,n);if(s){const o=new Jr(s.p.left,s.p,s.index,r);return ds(e,o,n-s.index)}else{const o=new Jr(null,t._start,0,r);return ds(e,o,n)}},To=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===pt&&Ce(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=e.doc,o=s.clientID;r.forEach((a,c)=>{const l=n.left,g=n.right,p=new gt(Z(o,vt(s.store,o)),l,l&&l.lastId,g,g&&g.id,t,null,new pt(c,a));p.integrate(e,0),n.right=p,n.forward()})},Ze=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},xo=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===pt&&Ce(t[e.right.content.key]||null,e.right.content.value)))break;e.forward()}},Oo=(e,t,n,r)=>{const s=e.doc,o=s.clientID,a=new Map;for(const c in r){const l=r[c],g=n.currentAttributes.get(c)||null;if(!Ce(g,l)){a.set(c,g);const{left:p,right:h}=n;n.right=new gt(Z(o,vt(s.store,o)),p,p&&p.lastId,h,h&&h.id,t,null,new pt(c,l)),n.right.integrate(e,0),n.forward()}}return a},Nr=(e,t,n,r,s)=>{n.currentAttributes.forEach((f,y)=>{s[y]===void 0&&(s[y]=null)});const o=e.doc,a=o.clientID;xo(n,s);const c=Oo(e,t,n,s),l=r.constructor===String?new se(r):r instanceof St?new ge(r):new Ne(r);let{left:g,right:p,index:h}=n;t._searchMarker&&yn(t._searchMarker,n.index,l.getLength()),p=new gt(Z(a,vt(o.store,a)),g,g&&g.lastId,p,p&&p.id,t,null,l),p.integrate(e,0),n.right=p,n.index=h,n.forward(),To(e,t,n,c)},fs=(e,t,n,r,s)=>{const o=e.doc,a=o.clientID;xo(n,s);const c=Oo(e,t,n,s);t:for(;n.right!==null&&(r>0||c.size>0&&(n.right.deleted||n.right.content.constructor===pt));){if(!n.right.deleted)switch(n.right.content.constructor){case pt:{const{key:l,value:g}=n.right.content,p=s[l];if(p!==void 0){if(Ce(p,g))c.delete(l);else{if(r===0)break t;c.set(l,g)}n.right.delete(e)}else n.currentAttributes.set(l,g);break}default:r<n.right.length&&Ee(e,Z(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;n.right=new gt(Z(a,vt(o.store,a)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new se(l)),n.right.integrate(e,0),n.forward()}To(e,t,n,c)},Lo=(e,t,n,r,s)=>{let o=t;const a=qt();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===pt){const g=o.content;a.set(g.key,g)}o=o.right}let c=0,l=!1;for(;t!==o;){if(n===t&&(l=!0),!t.deleted){const g=t.content;switch(g.constructor){case pt:{const{key:p,value:h}=g,f=r.get(p)||null;(a.get(p)!==g||f===h)&&(t.delete(e),c++,!l&&(s.get(p)||null)===h&&f!==h&&(f===null?s.delete(p):s.set(p,f))),!l&&!t.deleted&&Ze(s,g);break}}}t=t.right}return c},Bu=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===pt){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Pu=e=>{let t=0;return st(e.doc,n=>{let r=e._start,s=e._start,o=qt();const a=Wr(o);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case pt:Ze(a,s.content);break;default:t+=Lo(n,r,s,o,a),o=Wr(a),r=s;break}s=s.right}}),t},Vu=e=>{const t=new Set,n=e.doc;for(const[r,s]of e.afterState.entries()){const o=e.beforeState.get(r)||0;s!==o&&po(e,n.store.clients.get(r),o,s,a=>{!a.deleted&&a.content.constructor===pt&&a.constructor!==Nt&&t.add(a.parent)})}st(n,r=>{eo(e,e.deleteSet,s=>{if(s instanceof Nt||!s.parent._hasFormatting||t.has(s.parent))return;const o=s.parent;s.content.constructor===pt?t.add(o):Bu(r,s)});for(const s of t)Pu(s)})},gs=(e,t,n)=>{const r=n,s=Wr(t.currentAttributes),o=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case ge:case Ne:case se:n<t.right.length&&Ee(e,Z(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}o&&Lo(e,o,t.right,s,t.currentAttributes);const a=(t.left||t.right).parent;return a._searchMarker&&yn(a._searchMarker,t.index,-r+n),t};class Wu extends mr{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];st(t,r=>{const s=new Map,o=new Map;let a=this.target._start,c=null;const l={};let g="",p=0,h=0;const f=()=>{if(c!==null){let y=null;switch(c){case"delete":h>0&&(y={delete:h}),h=0;break;case"insert":(typeof g=="object"||g.length>0)&&(y={insert:g},s.size>0&&(y.attributes={},s.forEach((b,v)=>{b!==null&&(y.attributes[v]=b)}))),g="";break;case"retain":p>0&&(y={retain:p},kl(l)||(y.attributes=Cl({},l))),p=0;break}y&&n.push(y),c=null}};for(;a!==null;){switch(a.content.constructor){case ge:case Ne:this.adds(a)?this.deletes(a)||(f(),c="insert",g=a.content.getContent()[0],f()):this.deletes(a)?(c!=="delete"&&(f(),c="delete"),h+=1):a.deleted||(c!=="retain"&&(f(),c="retain"),p+=1);break;case se:this.adds(a)?this.deletes(a)||(c!=="insert"&&(f(),c="insert"),g+=a.content.str):this.deletes(a)?(c!=="delete"&&(f(),c="delete"),h+=a.length):a.deleted||(c!=="retain"&&(f(),c="retain"),p+=a.length);break;case pt:{const{key:y,value:b}=a.content;if(this.adds(a)){if(!this.deletes(a)){const v=s.get(y)||null;Ce(v,b)?b!==null&&a.delete(r):(c==="retain"&&f(),Ce(b,o.get(y)||null)?delete l[y]:l[y]=b)}}else if(this.deletes(a)){o.set(y,b);const v=s.get(y)||null;Ce(v,b)||(c==="retain"&&f(),l[y]=v)}else if(!a.deleted){o.set(y,b);const v=l[y];v!==void 0&&(Ce(v,b)?v!==null&&a.delete(r):(c==="retain"&&f(),b===null?delete l[y]:l[y]=b))}a.deleted||(c==="insert"&&f(),Ze(s,a.content));break}}a=a.right}for(f();n.length>0;){const y=n[n.length-1];if(y.retain!==void 0&&y.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class $e extends St{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new $e}clone(){const t=new $e;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new Wu(this,t,n);vr(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===se&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?st(this.doc,r=>{const s=new Jr(null,this._start,0,new Map);for(let o=0;o<t.length;o++){const a=t[o];if(a.insert!==void 0){const c=!n&&typeof a.insert=="string"&&o===t.length-1&&s.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof c!="string"||c.length>0)&&Nr(r,this,s,c,a.attributes||{})}else a.retain!==void 0?fs(r,this,s,a.retain,a.attributes||{}):a.delete!==void 0&&gs(r,s,a.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){const s=[],o=new Map,a=this.doc;let c="",l=this._start;function g(){if(c.length>0){const h={};let f=!1;o.forEach((b,v)=>{f=!0,h[v]=b});const y={insert:c};f&&(y.attributes=h),s.push(y),c=""}}const p=()=>{for(;l!==null;){if(rn(l,t)||n!==void 0&&rn(l,n))switch(l.content.constructor){case se:{const h=o.get("ychange");t!==void 0&&!rn(l,t)?(h===void 0||h.user!==l.id.client||h.type!=="removed")&&(g(),o.set("ychange",r?r("removed",l.id):{type:"removed"})):n!==void 0&&!rn(l,n)?(h===void 0||h.user!==l.id.client||h.type!=="added")&&(g(),o.set("ychange",r?r("added",l.id):{type:"added"})):h!==void 0&&(g(),o.delete("ychange")),c+=l.content.str;break}case ge:case Ne:{g();const h={insert:l.content.getContent()[0]};if(o.size>0){const f={};h.attributes=f,o.forEach((y,b)=>{f[b]=y})}s.push(h);break}case pt:rn(l,t)&&(g(),Ze(o,l.content));break}l=l.right}g()};return t||n?st(a,h=>{t&&$r(h,t),n&&$r(h,n),p()},"cleanup"):p(),s}insert(t,n,r){if(n.length<=0)return;const s=this.doc;s!==null?st(s,o=>{const a=Mn(o,this,t);r||(r={},a.currentAttributes.forEach((c,l)=>{r[l]=c})),Nr(o,this,a,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r={}){const s=this.doc;s!==null?st(s,o=>{const a=Mn(o,this,t);Nr(o,this,a,n,r)}):this._pending.push(()=>this.insertEmbed(t,n,r))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?st(r,s=>{gs(s,Mn(s,this,t),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const s=this.doc;s!==null?st(s,o=>{const a=Mn(o,this,t);a.right!==null&&fs(o,this,a,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?st(this.doc,n=>{Qn(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?st(this.doc,r=>{Ei(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return ki(this,t)}getAttributes(){return Do(this)}_write(t){t.writeTypeRef(ah)}}const qu=e=>new $e;class Ur{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===mn||n.constructor===Le)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Le extends St{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Le}clone(){const t=new Le;return t.insert(0,this.toArray().map(n=>n instanceof St?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Ur(this,t)}querySelector(t){t=t.toUpperCase();const r=new Ur(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Se(new Ur(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){vr(this,t,new Yu(this,n,t))}toString(){return Co(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),bn(this,o=>{s.insertBefore(o.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?st(this.doc,r=>{ko(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)st(this.doc,r=>{const s=t&&t instanceof St?t._item:t;Zn(r,this,s,n)});else{const r=this._prelimContent,s=t===null?0:r.findIndex(o=>o===t)+1;if(s===0&&t!==null)throw ne("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?st(this.doc,r=>{Ro(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return _o(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return So(this,t)}slice(t=0,n=this.length){return vo(this,t,n)}forEach(t){bn(this,t)}_write(t){t.writeTypeRef(lh)}}const zu=e=>new Le;class mn extends Le{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new mn(this.nodeName)}clone(){const t=new mn(this.nodeName),n=this.getAttributes();return El(n,(r,s)=>{typeof r=="string"&&t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof St?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const c in t)r.push(c);r.sort();const s=r.length;for(let c=0;c<s;c++){const l=r[c];n.push(l+'="'+t[l]+'"')}const o=this.nodeName.toLocaleLowerCase(),a=n.length>0?" "+n.join(" "):"";return`<${o}${a}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?st(this.doc,n=>{Qn(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?st(this.doc,r=>{Ei(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return ki(this,t)}hasAttribute(t){return Ao(this,t)}getAttributes(){return Do(this)}toDOM(t=document,n={},r){const s=t.createElement(this.nodeName),o=this.getAttributes();for(const a in o){const c=o[a];typeof c=="string"&&s.setAttribute(a,c)}return bn(this,a=>{s.appendChild(a.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(ch),t.writeKey(this.nodeName)}}const Hu=e=>new mn(e.readKey());class Yu extends mr{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class tr extends Ye{constructor(t){super(),this.hookName=t}_copy(){return new tr(this.hookName)}clone(){const t=new tr(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const s=n[this.hookName];let o;return s!==void 0?o=s.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(t){t.writeTypeRef(uh),t.writeKey(this.hookName)}}const $u=e=>new tr(e.readKey());class er extends $e{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new er}clone(){const t=new er;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{const n=[];for(const s in t.attributes){const o=[];for(const a in t.attributes[s])o.push({key:a,value:t.attributes[s][a]});o.sort((a,c)=>a.key<c.key?-1:1),n.push({nodeName:s,attrs:o})}n.sort((s,o)=>s.nodeName<o.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const o=n[s];r+=`<${o.nodeName}`;for(let a=0;a<o.attrs.length;a++){const c=o.attrs[a];r+=` ${c.key}="${c.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(hh)}}const Ku=e=>new er;class Ri{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Qt()}mergeWith(t){return!1}write(t,n,r){throw Qt()}integrate(t,n){throw Qt()}}const Ju=0;class Nt extends Ri{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),go(t.doc.store,this)}write(t,n){t.writeInfo(Ju),t.writeLen(this.length-n)}getMissing(t,n){return null}}class An{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new An(this.content)}splice(t){throw Qt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const Gu=e=>new An(e.readBuf());class wn{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new wn(this.len)}splice(t){const n=new wn(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Gn(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const Xu=e=>new wn(e.readLen()),Io=(e,t)=>new Xe({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Tn{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Tn(Io(this.doc.guid,this.opts))}splice(t){throw Qt()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Zu=e=>new Tn(Io(e.readString(),e.readAny()));class Ne{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Ne(this.embed)}splice(t){throw Qt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const Qu=e=>new Ne(e.readJSON());class pt{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new pt(this.key,this.value)}splice(t){throw Qt()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const th=e=>new pt(e.readKey(),e.readJSON());class nr{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new nr(this.arr)}splice(t){const n=new nr(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const o=this.arr[s];t.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}}const eh=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new nr(n)};class Ie{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ie(this.arr)}splice(t){const n=new Ie(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const o=this.arr[s];t.writeAny(o)}}getRef(){return 8}}const nh=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new Ie(n)};class se{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new se(this.str)}splice(t){const n=new se(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const rh=e=>new se(e.readString()),ih=[Uu,ju,qu,Hu,zu,$u,Ku],sh=0,oh=1,ah=2,ch=3,lh=4,uh=5,hh=6;class ge{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ge(this.type._copy())}splice(t){throw Qt()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const dh=e=>new ge(ih[e.readTypeRef()](e)),rr=(e,t,n)=>{const{client:r,clock:s}=t.id,o=new gt(Z(r,s+n),t,Z(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=Z(t.redone.client,t.redone.clock+n)),t.right=o,o.right!==null&&(o.right.left=o),e._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=n,o};class gt extends Ri{constructor(t,n,r,s,o,a,c,l){super(t,l.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=o,this.parent=a,this.parentSub=c,this.redone=null,this.content=l,this.info=this.content.isCountable()?Yi:0}set marker(t){(this.info&Tr)>0!==t&&(this.info^=Tr)}get marker(){return(this.info&Tr)>0}get keep(){return(this.info&Hi)>0}set keep(t){this.keep!==t&&(this.info^=Hi)}get countable(){return(this.info&Yi)>0}get deleted(){return(this.info&Ar)>0}set deleted(t){this.deleted!==t&&(this.info^=Ar)}markDeleted(){this.info|=Ar}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=vt(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=vt(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Be&&this.id.client!==this.parent.client&&this.parent.clock>=vt(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=cs(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ee(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Nt||this.right&&this.right.constructor===Nt)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===gt&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===gt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Be){const r=Mr(n,this.parent);r.constructor===Nt?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=cs(t,t.doc.store,Z(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const o=new Set,a=new Set;for(;s!==null&&s!==this.right;){if(a.add(s),o.add(s),Ln(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,o.clear();else if(Ln(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&a.has(Mr(t.doc.store,s.origin)))o.has(Mr(t.doc.store,s.origin))||(r=s,o.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),go(t.doc.store,this),this.content.integrate(t,this),us(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Nt(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:Z(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Ln(t.origin,this.lastId)&&this.right===t&&Ln(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Gn(t.deleteSet,this.id.client,this.id.clock,this.length),us(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw re();this.content.gc(t),n?wu(t,this,new Nt(this.id,this.length)):this.content=new wn(this.length)}write(t,n){const r=n>0?Z(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,o=this.parentSub,a=this.content.getRef()&fr|(r===null?0:Lt)|(s===null?0:ue)|(o===null?0:fn);if(t.writeInfo(a),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){const c=this.parent;if(c._item!==void 0){const l=c._item;if(l===null){const g=bu(c);t.writeParentInfo(!0),t.writeString(g)}else t.writeParentInfo(!1),t.writeLeftID(l.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===Be?(t.writeParentInfo(!1),t.writeLeftID(c)):re();o!==null&&t.writeString(o)}this.content.write(t,n)}}const Mo=(e,t)=>fh[t&fr](e),fh=[()=>{re()},Xu,eh,Gu,rh,Qu,th,dh,nh,Zu,()=>{re()}],gh=10;class Ut extends Ri{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){re()}write(t,n){t.writeInfo(gh),q(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const No=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Uo="__ $YJS$ __";No[Uo]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");No[Uo]=!0;const ph=1200,yh=2500,ir=3e4,Gr=e=>{if(e.shouldConnect&&e.ws===null){const t=new WebSocket(e.url),n=e.binaryType;let r=null;n&&(t.binaryType=n),e.ws=t,e.connecting=!0,e.connected=!1,t.onmessage=a=>{e.lastMessageReceived=de();const c=a.data,l=typeof c=="string"?JSON.parse(c):c;l&&l.type==="pong"&&(clearTimeout(r),r=setTimeout(o,ir/2)),e.emit("message",[l,e])};const s=a=>{e.ws!==null&&(e.ws=null,e.connecting=!1,e.connected?(e.connected=!1,e.emit("disconnect",[{type:"disconnect",error:a},e])):e.unsuccessfulReconnects++,setTimeout(Gr,oi(Pc(e.unsuccessfulReconnects+1)*ph,yh),e)),clearTimeout(r)},o=()=>{e.ws===t&&e.send({type:"ping"})};t.onclose=()=>s(null),t.onerror=a=>s(a),t.onopen=()=>{e.lastMessageReceived=de(),e.connecting=!1,e.connected=!0,e.unsuccessfulReconnects=0,e.emit("connect",[{type:"connect"},e]),r=setTimeout(o,ir/2)}}};class bh extends dr{constructor(t,{binaryType:n}={}){super(),this.url=t,this.ws=null,this.binaryType=n||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&ir<de()-this.lastMessageReceived&&this.ws.close()},ir/2),Gr(this)}send(t){this.ws&&this.ws.send(JSON.stringify(t))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&Gr(this)}}const Fo=new Map;class mh{constructor(t){this.room=t,this.onmessage=null,this._onChange=n=>n.key===t&&this.onmessage!==null&&this.onmessage({data:Ks(n.newValue||"")}),vl(this._onChange)}postMessage(t){qs.setItem(this.room,$s(Ul(t)))}close(){_l(this._onChange)}}const wh=typeof BroadcastChannel>"u"?mh:BroadcastChannel,Di=e=>jt(Fo,e,()=>{const t=Ae(),n=new wh(e);return n.onmessage=r=>t.forEach(s=>s(r.data,"broadcastchannel")),{bc:n,subs:t}}),vh=(e,t)=>(Di(e).subs.add(t),t),_h=(e,t)=>{const n=Di(e),r=n.subs.delete(t);return r&&n.subs.size===0&&(n.bc.close(),Fo.delete(e)),r},Ch=(e,t,n=null)=>{const r=Di(e);r.bc.postMessage(t),r.subs.forEach(s=>s(t,n))},Sh=()=>{let e=!0;return(t,n)=>{if(e){e=!1;try{t()}finally{e=!0}}else n!==void 0&&n()}};function Nn(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var jo={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){var n=Math.floor,r=Math.abs,s=Math.pow;return function(){function o(a,c,l){function g(f,y){if(!c[f]){if(!a[f]){var b=typeof Nn=="function"&&Nn;if(!y&&b)return b(f,!0);if(p)return p(f,!0);var v=new Error("Cannot find module '"+f+"'");throw v.code="MODULE_NOT_FOUND",v}var O=c[f]={exports:{}};a[f][0].call(O.exports,function(T){var I=a[f][1][T];return g(I||T)},O,O.exports,o,a,c,l)}return c[f].exports}for(var p=typeof Nn=="function"&&Nn,h=0;h<l.length;h++)g(l[h]);return g}return o}()({1:[function(o,a,c){function l(_){var C=_.length;if(0<C%4)throw new Error("Invalid string. Length must be a multiple of 4");var R=_.indexOf("=");R===-1&&(R=C);var S=R===C?0:4-R%4;return[R,S]}function g(_,C,R){return 3*(C+R)/4-R}function p(_){var C,R,S=l(_),A=S[0],N=S[1],k=new O(g(_,A,N)),D=0,j=0<N?A-4:A;for(R=0;R<j;R+=4)C=v[_.charCodeAt(R)]<<18|v[_.charCodeAt(R+1)]<<12|v[_.charCodeAt(R+2)]<<6|v[_.charCodeAt(R+3)],k[D++]=255&C>>16,k[D++]=255&C>>8,k[D++]=255&C;return N===2&&(C=v[_.charCodeAt(R)]<<2|v[_.charCodeAt(R+1)]>>4,k[D++]=255&C),N===1&&(C=v[_.charCodeAt(R)]<<10|v[_.charCodeAt(R+1)]<<4|v[_.charCodeAt(R+2)]>>2,k[D++]=255&C>>8,k[D++]=255&C),k}function h(_){return b[63&_>>18]+b[63&_>>12]+b[63&_>>6]+b[63&_]}function f(_,C,R){for(var S,A=[],N=C;N<R;N+=3)S=(16711680&_[N]<<16)+(65280&_[N+1]<<8)+(255&_[N+2]),A.push(h(S));return A.join("")}function y(_){for(var C,R=_.length,S=R%3,A=[],N=16383,k=0,D=R-S;k<D;k+=N)A.push(f(_,k,k+N>D?D:k+N));return S===1?(C=_[R-1],A.push(b[C>>2]+b[63&C<<4]+"==")):S===2&&(C=(_[R-2]<<8)+_[R-1],A.push(b[C>>10]+b[63&C>>4]+b[63&C<<2]+"=")),A.join("")}c.byteLength=function(_){var C=l(_),R=C[0],S=C[1];return 3*(R+S)/4-S},c.toByteArray=p,c.fromByteArray=y;for(var b=[],v=[],O=typeof Uint8Array>"u"?Array:Uint8Array,T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",I=0,m=T.length;I<m;++I)b[I]=T[I],v[T.charCodeAt(I)]=I;v[45]=62,v[95]=63},{}],2:[function(){},{}],3:[function(o,a,c){(function(){(function(){var l=String.fromCharCode,g=Math.min;function p(i){if(2147483647<i)throw new RangeError('The value "'+i+'" is invalid for option "size"');var u=new Uint8Array(i);return u.__proto__=h.prototype,u}function h(i,u,d){if(typeof i=="number"){if(typeof u=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return v(i)}return f(i,u,d)}function f(i,u,d){if(typeof i=="string")return O(i,u);if(ArrayBuffer.isView(i))return T(i);if(i==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i);if(L(i,ArrayBuffer)||i&&L(i.buffer,ArrayBuffer))return I(i,u,d);if(typeof i=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var E=i.valueOf&&i.valueOf();if(E!=null&&E!==i)return h.from(E,u,d);var x=m(i);if(x)return x;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof i[Symbol.toPrimitive]=="function")return h.from(i[Symbol.toPrimitive]("string"),u,d);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i)}function y(i){if(typeof i!="number")throw new TypeError('"size" argument must be of type number');if(0>i)throw new RangeError('The value "'+i+'" is invalid for option "size"')}function b(i,u,d){return y(i),0>=i||u===void 0?p(i):typeof d=="string"?p(i).fill(u,d):p(i).fill(u)}function v(i){return y(i),p(0>i?0:0|_(i))}function O(i,u){if((typeof u!="string"||u==="")&&(u="utf8"),!h.isEncoding(u))throw new TypeError("Unknown encoding: "+u);var d=0|C(i,u),E=p(d),x=E.write(i,u);return x!==d&&(E=E.slice(0,x)),E}function T(i){for(var u=0>i.length?0:0|_(i.length),d=p(u),E=0;E<u;E+=1)d[E]=255&i[E];return d}function I(i,u,d){if(0>u||i.byteLength<u)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<u+(d||0))throw new RangeError('"length" is outside of buffer bounds');var E;return E=u===void 0&&d===void 0?new Uint8Array(i):d===void 0?new Uint8Array(i,u):new Uint8Array(i,u,d),E.__proto__=h.prototype,E}function m(i){if(h.isBuffer(i)){var u=0|_(i.length),d=p(u);return d.length===0||i.copy(d,0,0,u),d}return i.length===void 0?i.type==="Buffer"&&Array.isArray(i.data)?T(i.data):void 0:typeof i.length!="number"||M(i.length)?p(0):T(i)}function _(i){if(i>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647 .toString(16)+" bytes");return 0|i}function C(i,u){if(h.isBuffer(i))return i.length;if(ArrayBuffer.isView(i)||L(i,ArrayBuffer))return i.byteLength;if(typeof i!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof i);var d=i.length,E=2<arguments.length&&arguments[2]===!0;if(!E&&d===0)return 0;for(var x=!1;;)switch(u){case"ascii":case"latin1":case"binary":return d;case"utf8":case"utf-8":return ht(i).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*d;case"hex":return d>>>1;case"base64":return Tt(i).length;default:if(x)return E?-1:ht(i).length;u=(""+u).toLowerCase(),x=!0}}function R(i,u,d){var E=!1;if((u===void 0||0>u)&&(u=0),u>this.length||((d===void 0||d>this.length)&&(d=this.length),0>=d)||(d>>>=0,u>>>=0,d<=u))return"";for(i||(i="utf8");;)switch(i){case"hex":return Dt(this,u,d);case"utf8":case"utf-8":return et(this,u,d);case"ascii":return H(this,u,d);case"latin1":case"binary":return Ht(this,u,d);case"base64":return X(this,u,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Et(this,u,d);default:if(E)throw new TypeError("Unknown encoding: "+i);i=(i+"").toLowerCase(),E=!0}}function S(i,u,d){var E=i[u];i[u]=i[d],i[d]=E}function A(i,u,d,E,x){if(i.length===0)return-1;if(typeof d=="string"?(E=d,d=0):2147483647<d?d=2147483647:-2147483648>d&&(d=-2147483648),d=+d,M(d)&&(d=x?0:i.length-1),0>d&&(d=i.length+d),d>=i.length){if(x)return-1;d=i.length-1}else if(0>d)if(x)d=0;else return-1;if(typeof u=="string"&&(u=h.from(u,E)),h.isBuffer(u))return u.length===0?-1:N(i,u,d,E,x);if(typeof u=="number")return u&=255,typeof Uint8Array.prototype.indexOf=="function"?x?Uint8Array.prototype.indexOf.call(i,u,d):Uint8Array.prototype.lastIndexOf.call(i,u,d):N(i,[u],d,E,x);throw new TypeError("val must be string, number or Buffer")}function N(i,u,d,E,x){function U(ye,ke){return V===1?ye[ke]:ye.readUInt16BE(ke*V)}var V=1,Y=i.length,tt=u.length;if(E!==void 0&&(E=(E+"").toLowerCase(),E==="ucs2"||E==="ucs-2"||E==="utf16le"||E==="utf-16le")){if(2>i.length||2>u.length)return-1;V=2,Y/=2,tt/=2,d/=2}var J;if(x){var G=-1;for(J=d;J<Y;J++)if(U(i,J)!==U(u,G===-1?0:J-G))G!==-1&&(J-=J-G),G=-1;else if(G===-1&&(G=J),J-G+1===tt)return G*V}else for(d+tt>Y&&(d=Y-tt),J=d;0<=J;J--){for(var rt=!0,$t=0;$t<tt;$t++)if(U(i,J+$t)!==U(u,$t)){rt=!1;break}if(rt)return J}return-1}function k(i,u,d,E){d=+d||0;var x=i.length-d;E?(E=+E,E>x&&(E=x)):E=x;var U=u.length;E>U/2&&(E=U/2);for(var V,Y=0;Y<E;++Y){if(V=parseInt(u.substr(2*Y,2),16),M(V))return Y;i[d+Y]=V}return Y}function D(i,u,d,E){return dt(ht(u,i.length-d),i,d,E)}function j(i,u,d,E){return dt(ae(u),i,d,E)}function P(i,u,d,E){return j(i,u,d,E)}function z(i,u,d,E){return dt(Tt(u),i,d,E)}function K(i,u,d,E){return dt(kt(u,i.length-d),i,d,E)}function X(i,u,d){return u===0&&d===i.length?B.fromByteArray(i):B.fromByteArray(i.slice(u,d))}function et(i,u,d){d=g(i.length,d);for(var E=[],x=u;x<d;){var U=i[x],V=null,Y=239<U?4:223<U?3:191<U?2:1;if(x+Y<=d){var tt,J,G,rt;Y===1?128>U&&(V=U):Y===2?(tt=i[x+1],(192&tt)==128&&(rt=(31&U)<<6|63&tt,127<rt&&(V=rt))):Y===3?(tt=i[x+1],J=i[x+2],(192&tt)==128&&(192&J)==128&&(rt=(15&U)<<12|(63&tt)<<6|63&J,2047<rt&&(55296>rt||57343<rt)&&(V=rt))):Y===4&&(tt=i[x+1],J=i[x+2],G=i[x+3],(192&tt)==128&&(192&J)==128&&(192&G)==128&&(rt=(15&U)<<18|(63&tt)<<12|(63&J)<<6|63&G,65535<rt&&1114112>rt&&(V=rt)))}V===null?(V=65533,Y=1):65535<V&&(V-=65536,E.push(55296|1023&V>>>10),V=56320|1023&V),E.push(V),x+=Y}return _t(E)}function _t(i){var u=i.length;if(u<=4096)return l.apply(String,i);for(var d="",E=0;E<u;)d+=l.apply(String,i.slice(E,E+=4096));return d}function H(i,u,d){var E="";d=g(i.length,d);for(var x=u;x<d;++x)E+=l(127&i[x]);return E}function Ht(i,u,d){var E="";d=g(i.length,d);for(var x=u;x<d;++x)E+=l(i[x]);return E}function Dt(i,u,d){var E=i.length;(!u||0>u)&&(u=0),(!d||0>d||d>E)&&(d=E);for(var x="",U=u;U<d;++U)x+=Yt(i[U]);return x}function Et(i,u,d){for(var E=i.slice(u,d),x="",U=0;U<E.length;U+=2)x+=l(E[U]+256*E[U+1]);return x}function nt(i,u,d){if(i%1!=0||0>i)throw new RangeError("offset is not uint");if(i+u>d)throw new RangeError("Trying to access beyond buffer length")}function Q(i,u,d,E,x,U){if(!h.isBuffer(i))throw new TypeError('"buffer" argument must be a Buffer instance');if(u>x||u<U)throw new RangeError('"value" argument is out of bounds');if(d+E>i.length)throw new RangeError("Index out of range")}function At(i,u,d,E){if(d+E>i.length)throw new RangeError("Index out of range");if(0>d)throw new RangeError("Index out of range")}function ut(i,u,d,E,x){return u=+u,d>>>=0,x||At(i,u,d,4),W.write(i,u,d,E,23,4),d+4}function Bt(i,u,d,E,x){return u=+u,d>>>=0,x||At(i,u,d,8),W.write(i,u,d,E,52,8),d+8}function pe(i){if(i=i.split("=")[0],i=i.trim().replace(w,""),2>i.length)return"";for(;i.length%4!=0;)i+="=";return i}function Yt(i){return 16>i?"0"+i.toString(16):i.toString(16)}function ht(i,u){u=u||1/0;for(var d,E=i.length,x=null,U=[],V=0;V<E;++V){if(d=i.charCodeAt(V),55295<d&&57344>d){if(!x){if(56319<d){-1<(u-=3)&&U.push(239,191,189);continue}else if(V+1===E){-1<(u-=3)&&U.push(239,191,189);continue}x=d;continue}if(56320>d){-1<(u-=3)&&U.push(239,191,189),x=d;continue}d=(x-55296<<10|d-56320)+65536}else x&&-1<(u-=3)&&U.push(239,191,189);if(x=null,128>d){if(0>(u-=1))break;U.push(d)}else if(2048>d){if(0>(u-=2))break;U.push(192|d>>6,128|63&d)}else if(65536>d){if(0>(u-=3))break;U.push(224|d>>12,128|63&d>>6,128|63&d)}else if(1114112>d){if(0>(u-=4))break;U.push(240|d>>18,128|63&d>>12,128|63&d>>6,128|63&d)}else throw new Error("Invalid code point")}return U}function ae(i){for(var u=[],d=0;d<i.length;++d)u.push(255&i.charCodeAt(d));return u}function kt(i,u){for(var d,E,x,U=[],V=0;V<i.length&&!(0>(u-=2));++V)d=i.charCodeAt(V),E=d>>8,x=d%256,U.push(x),U.push(E);return U}function Tt(i){return B.toByteArray(pe(i))}function dt(i,u,d,E){for(var x=0;x<E&&!(x+d>=u.length||x>=i.length);++x)u[x+d]=i[x];return x}function L(i,u){return i instanceof u||i!=null&&i.constructor!=null&&i.constructor.name!=null&&i.constructor.name===u.name}function M(i){return i!==i}var B=o("base64-js"),W=o("ieee754");c.Buffer=h,c.SlowBuffer=function(i){return+i!=i&&(i=0),h.alloc(+i)},c.INSPECT_MAX_BYTES=50,c.kMaxLength=2147483647,h.TYPED_ARRAY_SUPPORT=function(){try{var i=new Uint8Array(1);return i.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},i.foo()===42}catch{return!1}}(),h.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){return h.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){return h.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol<"u"&&Symbol.species!=null&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),h.poolSize=8192,h.from=function(i,u,d){return f(i,u,d)},h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,h.alloc=function(i,u,d){return b(i,u,d)},h.allocUnsafe=function(i){return v(i)},h.allocUnsafeSlow=function(i){return v(i)},h.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==h.prototype},h.compare=function(i,u){if(L(i,Uint8Array)&&(i=h.from(i,i.offset,i.byteLength)),L(u,Uint8Array)&&(u=h.from(u,u.offset,u.byteLength)),!h.isBuffer(i)||!h.isBuffer(u))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===u)return 0;for(var d=i.length,E=u.length,x=0,U=g(d,E);x<U;++x)if(i[x]!==u[x]){d=i[x],E=u[x];break}return d<E?-1:E<d?1:0},h.isEncoding=function(i){switch((i+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(i,u){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return h.alloc(0);var d;if(u===void 0)for(u=0,d=0;d<i.length;++d)u+=i[d].length;var E=h.allocUnsafe(u),x=0;for(d=0;d<i.length;++d){var U=i[d];if(L(U,Uint8Array)&&(U=h.from(U)),!h.isBuffer(U))throw new TypeError('"list" argument must be an Array of Buffers');U.copy(E,x),x+=U.length}return E},h.byteLength=C,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var i=this.length;if(i%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var u=0;u<i;u+=2)S(this,u,u+1);return this},h.prototype.swap32=function(){var i=this.length;if(i%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var u=0;u<i;u+=4)S(this,u,u+3),S(this,u+1,u+2);return this},h.prototype.swap64=function(){var i=this.length;if(i%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var u=0;u<i;u+=8)S(this,u,u+7),S(this,u+1,u+6),S(this,u+2,u+5),S(this,u+3,u+4);return this},h.prototype.toString=function(){var i=this.length;return i===0?"":arguments.length===0?et(this,0,i):R.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(i){if(!h.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i||h.compare(this,i)===0},h.prototype.inspect=function(){var i="",u=c.INSPECT_MAX_BYTES;return i=this.toString("hex",0,u).replace(/(.{2})/g,"$1 ").trim(),this.length>u&&(i+=" ... "),"<Buffer "+i+">"},h.prototype.compare=function(i,u,d,E,x){if(L(i,Uint8Array)&&(i=h.from(i,i.offset,i.byteLength)),!h.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(u===void 0&&(u=0),d===void 0&&(d=i?i.length:0),E===void 0&&(E=0),x===void 0&&(x=this.length),0>u||d>i.length||0>E||x>this.length)throw new RangeError("out of range index");if(E>=x&&u>=d)return 0;if(E>=x)return-1;if(u>=d)return 1;if(u>>>=0,d>>>=0,E>>>=0,x>>>=0,this===i)return 0;for(var U=x-E,V=d-u,Y=g(U,V),tt=this.slice(E,x),J=i.slice(u,d),G=0;G<Y;++G)if(tt[G]!==J[G]){U=tt[G],V=J[G];break}return U<V?-1:V<U?1:0},h.prototype.includes=function(i,u,d){return this.indexOf(i,u,d)!==-1},h.prototype.indexOf=function(i,u,d){return A(this,i,u,d,!0)},h.prototype.lastIndexOf=function(i,u,d){return A(this,i,u,d,!1)},h.prototype.write=function(i,u,d,E){if(u===void 0)E="utf8",d=this.length,u=0;else if(d===void 0&&typeof u=="string")E=u,d=this.length,u=0;else if(isFinite(u))u>>>=0,isFinite(d)?(d>>>=0,E===void 0&&(E="utf8")):(E=d,d=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var x=this.length-u;if((d===void 0||d>x)&&(d=x),0<i.length&&(0>d||0>u)||u>this.length)throw new RangeError("Attempt to write outside buffer bounds");E||(E="utf8");for(var U=!1;;)switch(E){case"hex":return k(this,i,u,d);case"utf8":case"utf-8":return D(this,i,u,d);case"ascii":return j(this,i,u,d);case"latin1":case"binary":return P(this,i,u,d);case"base64":return z(this,i,u,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return K(this,i,u,d);default:if(U)throw new TypeError("Unknown encoding: "+E);E=(""+E).toLowerCase(),U=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},h.prototype.slice=function(i,u){var d=this.length;i=~~i,u=u===void 0?d:~~u,0>i?(i+=d,0>i&&(i=0)):i>d&&(i=d),0>u?(u+=d,0>u&&(u=0)):u>d&&(u=d),u<i&&(u=i);var E=this.subarray(i,u);return E.__proto__=h.prototype,E},h.prototype.readUIntLE=function(i,u,d){i>>>=0,u>>>=0,d||nt(i,u,this.length);for(var E=this[i],x=1,U=0;++U<u&&(x*=256);)E+=this[i+U]*x;return E},h.prototype.readUIntBE=function(i,u,d){i>>>=0,u>>>=0,d||nt(i,u,this.length);for(var E=this[i+--u],x=1;0<u&&(x*=256);)E+=this[i+--u]*x;return E},h.prototype.readUInt8=function(i,u){return i>>>=0,u||nt(i,1,this.length),this[i]},h.prototype.readUInt16LE=function(i,u){return i>>>=0,u||nt(i,2,this.length),this[i]|this[i+1]<<8},h.prototype.readUInt16BE=function(i,u){return i>>>=0,u||nt(i,2,this.length),this[i]<<8|this[i+1]},h.prototype.readUInt32LE=function(i,u){return i>>>=0,u||nt(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+16777216*this[i+3]},h.prototype.readUInt32BE=function(i,u){return i>>>=0,u||nt(i,4,this.length),16777216*this[i]+(this[i+1]<<16|this[i+2]<<8|this[i+3])},h.prototype.readIntLE=function(i,u,d){i>>>=0,u>>>=0,d||nt(i,u,this.length);for(var E=this[i],x=1,U=0;++U<u&&(x*=256);)E+=this[i+U]*x;return x*=128,E>=x&&(E-=s(2,8*u)),E},h.prototype.readIntBE=function(i,u,d){i>>>=0,u>>>=0,d||nt(i,u,this.length);for(var E=u,x=1,U=this[i+--E];0<E&&(x*=256);)U+=this[i+--E]*x;return x*=128,U>=x&&(U-=s(2,8*u)),U},h.prototype.readInt8=function(i,u){return i>>>=0,u||nt(i,1,this.length),128&this[i]?-1*(255-this[i]+1):this[i]},h.prototype.readInt16LE=function(i,u){i>>>=0,u||nt(i,2,this.length);var d=this[i]|this[i+1]<<8;return 32768&d?4294901760|d:d},h.prototype.readInt16BE=function(i,u){i>>>=0,u||nt(i,2,this.length);var d=this[i+1]|this[i]<<8;return 32768&d?4294901760|d:d},h.prototype.readInt32LE=function(i,u){return i>>>=0,u||nt(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},h.prototype.readInt32BE=function(i,u){return i>>>=0,u||nt(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},h.prototype.readFloatLE=function(i,u){return i>>>=0,u||nt(i,4,this.length),W.read(this,i,!0,23,4)},h.prototype.readFloatBE=function(i,u){return i>>>=0,u||nt(i,4,this.length),W.read(this,i,!1,23,4)},h.prototype.readDoubleLE=function(i,u){return i>>>=0,u||nt(i,8,this.length),W.read(this,i,!0,52,8)},h.prototype.readDoubleBE=function(i,u){return i>>>=0,u||nt(i,8,this.length),W.read(this,i,!1,52,8)},h.prototype.writeUIntLE=function(i,u,d,E){if(i=+i,u>>>=0,d>>>=0,!E){var x=s(2,8*d)-1;Q(this,i,u,d,x,0)}var U=1,V=0;for(this[u]=255&i;++V<d&&(U*=256);)this[u+V]=255&i/U;return u+d},h.prototype.writeUIntBE=function(i,u,d,E){if(i=+i,u>>>=0,d>>>=0,!E){var x=s(2,8*d)-1;Q(this,i,u,d,x,0)}var U=d-1,V=1;for(this[u+U]=255&i;0<=--U&&(V*=256);)this[u+U]=255&i/V;return u+d},h.prototype.writeUInt8=function(i,u,d){return i=+i,u>>>=0,d||Q(this,i,u,1,255,0),this[u]=255&i,u+1},h.prototype.writeUInt16LE=function(i,u,d){return i=+i,u>>>=0,d||Q(this,i,u,2,65535,0),this[u]=255&i,this[u+1]=i>>>8,u+2},h.prototype.writeUInt16BE=function(i,u,d){return i=+i,u>>>=0,d||Q(this,i,u,2,65535,0),this[u]=i>>>8,this[u+1]=255&i,u+2},h.prototype.writeUInt32LE=function(i,u,d){return i=+i,u>>>=0,d||Q(this,i,u,4,4294967295,0),this[u+3]=i>>>24,this[u+2]=i>>>16,this[u+1]=i>>>8,this[u]=255&i,u+4},h.prototype.writeUInt32BE=function(i,u,d){return i=+i,u>>>=0,d||Q(this,i,u,4,4294967295,0),this[u]=i>>>24,this[u+1]=i>>>16,this[u+2]=i>>>8,this[u+3]=255&i,u+4},h.prototype.writeIntLE=function(i,u,d,E){if(i=+i,u>>>=0,!E){var x=s(2,8*d-1);Q(this,i,u,d,x-1,-x)}var U=0,V=1,Y=0;for(this[u]=255&i;++U<d&&(V*=256);)0>i&&Y===0&&this[u+U-1]!==0&&(Y=1),this[u+U]=255&(i/V>>0)-Y;return u+d},h.prototype.writeIntBE=function(i,u,d,E){if(i=+i,u>>>=0,!E){var x=s(2,8*d-1);Q(this,i,u,d,x-1,-x)}var U=d-1,V=1,Y=0;for(this[u+U]=255&i;0<=--U&&(V*=256);)0>i&&Y===0&&this[u+U+1]!==0&&(Y=1),this[u+U]=255&(i/V>>0)-Y;return u+d},h.prototype.writeInt8=function(i,u,d){return i=+i,u>>>=0,d||Q(this,i,u,1,127,-128),0>i&&(i=255+i+1),this[u]=255&i,u+1},h.prototype.writeInt16LE=function(i,u,d){return i=+i,u>>>=0,d||Q(this,i,u,2,32767,-32768),this[u]=255&i,this[u+1]=i>>>8,u+2},h.prototype.writeInt16BE=function(i,u,d){return i=+i,u>>>=0,d||Q(this,i,u,2,32767,-32768),this[u]=i>>>8,this[u+1]=255&i,u+2},h.prototype.writeInt32LE=function(i,u,d){return i=+i,u>>>=0,d||Q(this,i,u,4,2147483647,-2147483648),this[u]=255&i,this[u+1]=i>>>8,this[u+2]=i>>>16,this[u+3]=i>>>24,u+4},h.prototype.writeInt32BE=function(i,u,d){return i=+i,u>>>=0,d||Q(this,i,u,4,2147483647,-2147483648),0>i&&(i=4294967295+i+1),this[u]=i>>>24,this[u+1]=i>>>16,this[u+2]=i>>>8,this[u+3]=255&i,u+4},h.prototype.writeFloatLE=function(i,u,d){return ut(this,i,u,!0,d)},h.prototype.writeFloatBE=function(i,u,d){return ut(this,i,u,!1,d)},h.prototype.writeDoubleLE=function(i,u,d){return Bt(this,i,u,!0,d)},h.prototype.writeDoubleBE=function(i,u,d){return Bt(this,i,u,!1,d)},h.prototype.copy=function(i,u,d,E){if(!h.isBuffer(i))throw new TypeError("argument should be a Buffer");if(d||(d=0),E||E===0||(E=this.length),u>=i.length&&(u=i.length),u||(u=0),0<E&&E<d&&(E=d),E===d||i.length===0||this.length===0)return 0;if(0>u)throw new RangeError("targetStart out of bounds");if(0>d||d>=this.length)throw new RangeError("Index out of range");if(0>E)throw new RangeError("sourceEnd out of bounds");E>this.length&&(E=this.length),i.length-u<E-d&&(E=i.length-u+d);var x=E-d;if(this===i&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(u,d,E);else if(this===i&&d<u&&u<E)for(var U=x-1;0<=U;--U)i[U+u]=this[U+d];else Uint8Array.prototype.set.call(i,this.subarray(d,E),u);return x},h.prototype.fill=function(i,u,d,E){if(typeof i=="string"){if(typeof u=="string"?(E=u,u=0,d=this.length):typeof d=="string"&&(E=d,d=this.length),E!==void 0&&typeof E!="string")throw new TypeError("encoding must be a string");if(typeof E=="string"&&!h.isEncoding(E))throw new TypeError("Unknown encoding: "+E);if(i.length===1){var x=i.charCodeAt(0);(E==="utf8"&&128>x||E==="latin1")&&(i=x)}}else typeof i=="number"&&(i&=255);if(0>u||this.length<u||this.length<d)throw new RangeError("Out of range index");if(d<=u)return this;u>>>=0,d=d===void 0?this.length:d>>>0,i||(i=0);var U;if(typeof i=="number")for(U=u;U<d;++U)this[U]=i;else{var V=h.isBuffer(i)?i:h.from(i,E),Y=V.length;if(Y===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(U=0;U<d-u;++U)this[U+u]=V[U%Y]}return this};var w=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,o("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(o,a,c){(function(l){(function(){function g(){let h;try{h=c.storage.getItem("debug")}catch{}return!h&&typeof l<"u"&&"env"in l&&(h=l.env.DEBUG),h}c.formatArgs=function(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+a.exports.humanize(this.diff),!this.useColors)return;const f="color: "+this.color;h.splice(1,0,f,"color: inherit");let y=0,b=0;h[0].replace(/%[a-zA-Z%]/g,v=>{v==="%%"||(y++,v==="%c"&&(b=y))}),h.splice(b,0,f)},c.save=function(h){try{h?c.storage.setItem("debug",h):c.storage.removeItem("debug")}catch{}},c.load=g,c.useColors=function(){return!!(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},c.storage=function(){try{return localStorage}catch{}}(),c.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),c.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],c.log=console.debug||console.log||(()=>{}),a.exports=o("./common")(c);const{formatters:p}=a.exports;p.j=function(h){try{return JSON.stringify(h)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}}).call(this)}).call(this,o("_process"))},{"./common":5,_process:12}],5:[function(o,a){a.exports=function(c){function l(h){function f(...v){if(!f.enabled)return;const O=f,T=+new Date,I=T-(y||T);O.diff=I,O.prev=y,O.curr=T,y=T,v[0]=l.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let m=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(C,R)=>{if(C==="%%")return"%";m++;const S=l.formatters[R];if(typeof S=="function"){const A=v[m];C=S.call(O,A),v.splice(m,1),m--}return C}),l.formatArgs.call(O,v),(O.log||l.log).apply(O,v)}let y,b=null;return f.namespace=h,f.useColors=l.useColors(),f.color=l.selectColor(h),f.extend=g,f.destroy=l.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>b===null?l.enabled(h):b,set:v=>{b=v}}),typeof l.init=="function"&&l.init(f),f}function g(h,f){const y=l(this.namespace+(typeof f>"u"?":":f)+h);return y.log=this.log,y}function p(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}return l.debug=l,l.default=l,l.coerce=function(h){return h instanceof Error?h.stack||h.message:h},l.disable=function(){const h=[...l.names.map(p),...l.skips.map(p).map(f=>"-"+f)].join(",");return l.enable(""),h},l.enable=function(h){l.save(h),l.names=[],l.skips=[];let f;const y=(typeof h=="string"?h:"").split(/[\s,]+/),b=y.length;for(f=0;f<b;f++)y[f]&&(h=y[f].replace(/\*/g,".*?"),h[0]==="-"?l.skips.push(new RegExp("^"+h.substr(1)+"$")):l.names.push(new RegExp("^"+h+"$")))},l.enabled=function(h){if(h[h.length-1]==="*")return!0;let f,y;for(f=0,y=l.skips.length;f<y;f++)if(l.skips[f].test(h))return!1;for(f=0,y=l.names.length;f<y;f++)if(l.names[f].test(h))return!0;return!1},l.humanize=o("ms"),l.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(c).forEach(h=>{l[h]=c[h]}),l.names=[],l.skips=[],l.formatters={},l.selectColor=function(h){let f=0;for(let y=0;y<h.length;y++)f=(f<<5)-f+h.charCodeAt(y),f|=0;return l.colors[r(f)%l.colors.length]},l.enable(l.load()),l}},{ms:11}],6:[function(o,a){function c(l,g){for(const p in g)Object.defineProperty(l,p,{value:g[p],enumerable:!0,configurable:!0});return l}a.exports=function(l,g,p){if(!l||typeof l=="string")throw new TypeError("Please pass an Error to err-code");p||(p={}),typeof g=="object"&&(p=g,g=""),g&&(p.code=g);try{return c(l,p)}catch{p.message=l.message,p.stack=l.stack;const f=function(){};return f.prototype=Object.create(Object.getPrototypeOf(l)),c(new f,p)}}},{}],7:[function(o,a){function c(k){console&&console.warn&&console.warn(k)}function l(){l.init.call(this)}function g(k){if(typeof k!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}function p(k){return k._maxListeners===void 0?l.defaultMaxListeners:k._maxListeners}function h(k,D,j,P){var z,K,X;if(g(j),K=k._events,K===void 0?(K=k._events=Object.create(null),k._eventsCount=0):(K.newListener!==void 0&&(k.emit("newListener",D,j.listener?j.listener:j),K=k._events),X=K[D]),X===void 0)X=K[D]=j,++k._eventsCount;else if(typeof X=="function"?X=K[D]=P?[j,X]:[X,j]:P?X.unshift(j):X.push(j),z=p(k),0<z&&X.length>z&&!X.warned){X.warned=!0;var et=new Error("Possible EventEmitter memory leak detected. "+X.length+" "+(D+" listeners added. Use emitter.setMaxListeners() to increase limit"));et.name="MaxListenersExceededWarning",et.emitter=k,et.type=D,et.count=X.length,c(et)}return k}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(k,D,j){var P={fired:!1,wrapFn:void 0,target:k,type:D,listener:j},z=f.bind(P);return z.listener=j,P.wrapFn=z,z}function b(k,D,j){var P=k._events;if(P===void 0)return[];var z=P[D];return z===void 0?[]:typeof z=="function"?j?[z.listener||z]:[z]:j?I(z):O(z,z.length)}function v(k){var D=this._events;if(D!==void 0){var j=D[k];if(typeof j=="function")return 1;if(j!==void 0)return j.length}return 0}function O(k,D){for(var j=Array(D),P=0;P<D;++P)j[P]=k[P];return j}function T(k,D){for(;D+1<k.length;D++)k[D]=k[D+1];k.pop()}function I(k){for(var D=Array(k.length),j=0;j<D.length;++j)D[j]=k[j].listener||k[j];return D}function m(k,D,j){typeof k.on=="function"&&_(k,"error",D,j)}function _(k,D,j,P){if(typeof k.on=="function")P.once?k.once(D,j):k.on(D,j);else if(typeof k.addEventListener=="function")k.addEventListener(D,function z(K){P.once&&k.removeEventListener(D,z),j(K)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k)}var C,R=typeof Reflect=="object"?Reflect:null,S=R&&typeof R.apply=="function"?R.apply:function(k,D,j){return Function.prototype.apply.call(k,D,j)};C=R&&typeof R.ownKeys=="function"?R.ownKeys:Object.getOwnPropertySymbols?function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:function(k){return Object.getOwnPropertyNames(k)};var A=Number.isNaN||function(k){return k!==k};a.exports=l,a.exports.once=function(k,D){return new Promise(function(j,P){function z(X){k.removeListener(D,K),P(X)}function K(){typeof k.removeListener=="function"&&k.removeListener("error",z),j([].slice.call(arguments))}_(k,D,K,{once:!0}),D!=="error"&&m(k,z,{once:!0})})},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var N=10;Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return N},set:function(k){if(typeof k!="number"||0>k||A(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");N=k}}),l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(k){if(typeof k!="number"||0>k||A(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this},l.prototype.getMaxListeners=function(){return p(this)},l.prototype.emit=function(k){for(var D=[],j=1;j<arguments.length;j++)D.push(arguments[j]);var P=k==="error",z=this._events;if(z!==void 0)P=P&&z.error===void 0;else if(!P)return!1;if(P){var K;if(0<D.length&&(K=D[0]),K instanceof Error)throw K;var X=new Error("Unhandled error."+(K?" ("+K.message+")":""));throw X.context=K,X}var et=z[k];if(et===void 0)return!1;if(typeof et=="function")S(et,this,D);else for(var _t=et.length,H=O(et,_t),j=0;j<_t;++j)S(H[j],this,D);return!0},l.prototype.addListener=function(k,D){return h(this,k,D,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(k,D){return h(this,k,D,!0)},l.prototype.once=function(k,D){return g(D),this.on(k,y(this,k,D)),this},l.prototype.prependOnceListener=function(k,D){return g(D),this.prependListener(k,y(this,k,D)),this},l.prototype.removeListener=function(k,D){var j,P,z,K,X;if(g(D),P=this._events,P===void 0)return this;if(j=P[k],j===void 0)return this;if(j===D||j.listener===D)--this._eventsCount==0?this._events=Object.create(null):(delete P[k],P.removeListener&&this.emit("removeListener",k,j.listener||D));else if(typeof j!="function"){for(z=-1,K=j.length-1;0<=K;K--)if(j[K]===D||j[K].listener===D){X=j[K].listener,z=K;break}if(0>z)return this;z===0?j.shift():T(j,z),j.length===1&&(P[k]=j[0]),P.removeListener!==void 0&&this.emit("removeListener",k,X||D)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(k){var D,j,P;if(j=this._events,j===void 0)return this;if(j.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):j[k]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete j[k]),this;if(arguments.length===0){var z,K=Object.keys(j);for(P=0;P<K.length;++P)z=K[P],z!=="removeListener"&&this.removeAllListeners(z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(D=j[k],typeof D=="function")this.removeListener(k,D);else if(D!==void 0)for(P=D.length-1;0<=P;P--)this.removeListener(k,D[P]);return this},l.prototype.listeners=function(k){return b(this,k,!0)},l.prototype.rawListeners=function(k){return b(this,k,!1)},l.listenerCount=function(k,D){return typeof k.listenerCount=="function"?k.listenerCount(D):v.call(k,D)},l.prototype.listenerCount=v,l.prototype.eventNames=function(){return 0<this._eventsCount?C(this._events):[]}},{}],8:[function(o,a){a.exports=function(){if(typeof globalThis>"u")return null;var c={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return c.RTCPeerConnection?c:null}},{}],9:[function(o,a,c){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */c.read=function(l,g,p,h,f){var y,b,v=8*f-h-1,O=(1<<v)-1,T=O>>1,I=-7,m=p?f-1:0,_=p?-1:1,C=l[g+m];for(m+=_,y=C&(1<<-I)-1,C>>=-I,I+=v;0<I;y=256*y+l[g+m],m+=_,I-=8);for(b=y&(1<<-I)-1,y>>=-I,I+=h;0<I;b=256*b+l[g+m],m+=_,I-=8);if(y===0)y=1-T;else{if(y===O)return b?NaN:(C?-1:1)*(1/0);b+=s(2,h),y-=T}return(C?-1:1)*b*s(2,y-h)},c.write=function(l,g,p,h,f,y){var b,v,O,T=Math.LN2,I=Math.log,m=8*y-f-1,_=(1<<m)-1,C=_>>1,R=f===23?s(2,-24)-s(2,-77):0,S=h?0:y-1,A=h?1:-1,N=0>g||g===0&&0>1/g?1:0;for(g=r(g),isNaN(g)||g===1/0?(v=isNaN(g)?1:0,b=_):(b=n(I(g)/T),1>g*(O=s(2,-b))&&(b--,O*=2),g+=1<=b+C?R/O:R*s(2,1-C),2<=g*O&&(b++,O/=2),b+C>=_?(v=0,b=_):1<=b+C?(v=(g*O-1)*s(2,f),b+=C):(v=g*s(2,C-1)*s(2,f),b=0));8<=f;l[p+S]=255&v,S+=A,v/=256,f-=8);for(b=b<<f|v,m+=f;0<m;l[p+S]=255&b,S+=A,b/=256,m-=8);l[p+S-A]|=128*N}},{}],10:[function(o,a){a.exports=typeof Object.create=="function"?function(c,l){l&&(c.super_=l,c.prototype=Object.create(l.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}))}:function(c,l){if(l){c.super_=l;var g=function(){};g.prototype=l.prototype,c.prototype=new g,c.prototype.constructor=c}}},{}],11:[function(o,a){var c=Math.round;function l(f){if(f+="",!(100<f.length)){var y=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(y){var b=parseFloat(y[1]),v=(y[2]||"ms").toLowerCase();return v==="years"||v==="year"||v==="yrs"||v==="yr"||v==="y"?315576e5*b:v==="weeks"||v==="week"||v==="w"?6048e5*b:v==="days"||v==="day"||v==="d"?864e5*b:v==="hours"||v==="hour"||v==="hrs"||v==="hr"||v==="h"?36e5*b:v==="minutes"||v==="minute"||v==="mins"||v==="min"||v==="m"?6e4*b:v==="seconds"||v==="second"||v==="secs"||v==="sec"||v==="s"?1e3*b:v==="milliseconds"||v==="millisecond"||v==="msecs"||v==="msec"||v==="ms"?b:void 0}}}function g(f){var y=r(f);return 864e5<=y?c(f/864e5)+"d":36e5<=y?c(f/36e5)+"h":6e4<=y?c(f/6e4)+"m":1e3<=y?c(f/1e3)+"s":f+"ms"}function p(f){var y=r(f);return 864e5<=y?h(f,y,864e5,"day"):36e5<=y?h(f,y,36e5,"hour"):6e4<=y?h(f,y,6e4,"minute"):1e3<=y?h(f,y,1e3,"second"):f+" ms"}function h(f,y,b,v){return c(f/b)+" "+v+(y>=1.5*b?"s":"")}a.exports=function(f,y){y=y||{};var b=typeof f;if(b=="string"&&0<f.length)return l(f);if(b==="number"&&isFinite(f))return y.long?p(f):g(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))}},{}],12:[function(o,a){function c(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function g(R){if(v===setTimeout)return setTimeout(R,0);if((v===c||!v)&&setTimeout)return v=setTimeout,setTimeout(R,0);try{return v(R,0)}catch{try{return v.call(null,R,0)}catch{return v.call(this,R,0)}}}function p(R){if(O===clearTimeout)return clearTimeout(R);if((O===l||!O)&&clearTimeout)return O=clearTimeout,clearTimeout(R);try{return O(R)}catch{try{return O.call(null,R)}catch{return O.call(this,R)}}}function h(){_&&I&&(_=!1,I.length?m=I.concat(m):C=-1,m.length&&f())}function f(){if(!_){var R=g(h);_=!0;for(var S=m.length;S;){for(I=m,m=[];++C<S;)I&&I[C].run();C=-1,S=m.length}I=null,_=!1,p(R)}}function y(R,S){this.fun=R,this.array=S}function b(){}var v,O,T=a.exports={};(function(){try{v=typeof setTimeout=="function"?setTimeout:c}catch{v=c}try{O=typeof clearTimeout=="function"?clearTimeout:l}catch{O=l}})();var I,m=[],_=!1,C=-1;T.nextTick=function(R){var S=Array(arguments.length-1);if(1<arguments.length)for(var A=1;A<arguments.length;A++)S[A-1]=arguments[A];m.push(new y(R,S)),m.length!==1||_||g(f)},y.prototype.run=function(){this.fun.apply(null,this.array)},T.title="browser",T.browser=!0,T.env={},T.argv=[],T.version="",T.versions={},T.on=b,T.addListener=b,T.once=b,T.off=b,T.removeListener=b,T.removeAllListeners=b,T.emit=b,T.prependListener=b,T.prependOnceListener=b,T.listeners=function(){return[]},T.binding=function(){throw new Error("process.binding is not supported")},T.cwd=function(){return"/"},T.chdir=function(){throw new Error("process.chdir is not supported")},T.umask=function(){return 0}},{}],13:[function(o,a){(function(c){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let l;a.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window>"u"?c:window):g=>(l||(l=Promise.resolve())).then(g).catch(p=>setTimeout(()=>{throw p},0))}).call(this)}).call(this,typeof Jt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Jt)},{}],14:[function(o,a){(function(c,l){(function(){var g=o("safe-buffer").Buffer,p=l.crypto||l.msCrypto;a.exports=p&&p.getRandomValues?function(h,f){if(h>4294967295)throw new RangeError("requested too many random bytes");var y=g.allocUnsafe(h);if(0<h)if(65536<h)for(var b=0;b<h;b+=65536)p.getRandomValues(y.slice(b,b+65536));else p.getRandomValues(y);return typeof f=="function"?c.nextTick(function(){f(null,y)}):y}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,o("_process"),typeof Jt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Jt)},{_process:12,"safe-buffer":30}],15:[function(o,a){function c(b,v){b.prototype=Object.create(v.prototype),b.prototype.constructor=b,b.__proto__=v}function l(b,v,O){function T(m,_,C){return typeof v=="string"?v:v(m,_,C)}O||(O=Error);var I=function(m){function _(C,R,S){return m.call(this,T(C,R,S))||this}return c(_,m),_}(O);I.prototype.name=O.name,I.prototype.code=b,y[b]=I}function g(b,v){if(Array.isArray(b)){var O=b.length;return b=b.map(function(T){return T+""}),2<O?"one of ".concat(v," ").concat(b.slice(0,O-1).join(", "),", or ")+b[O-1]:O===2?"one of ".concat(v," ").concat(b[0]," or ").concat(b[1]):"of ".concat(v," ").concat(b[0])}return"of ".concat(v," ").concat(b+"")}function p(b,v,O){return b.substr(!O||0>O?0:+O,v.length)===v}function h(b,v,O){return(O===void 0||O>b.length)&&(O=b.length),b.substring(O-v.length,O)===v}function f(b,v,O){return typeof O!="number"&&(O=0),!(O+v.length>b.length)&&b.indexOf(v,O)!==-1}var y={};l("ERR_INVALID_OPT_VALUE",function(b,v){return'The value "'+v+'" is invalid for option "'+b+'"'},TypeError),l("ERR_INVALID_ARG_TYPE",function(b,v,O){var T;typeof v=="string"&&p(v,"not ")?(T="must not be",v=v.replace(/^not /,"")):T="must be";var I;if(h(b," argument"))I="The ".concat(b," ").concat(T," ").concat(g(v,"type"));else{var m=f(b,".")?"property":"argument";I='The "'.concat(b,'" ').concat(m," ").concat(T," ").concat(g(v,"type"))}return I+=". Received type ".concat(typeof O),I},TypeError),l("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),l("ERR_METHOD_NOT_IMPLEMENTED",function(b){return"The "+b+" method is not implemented"}),l("ERR_STREAM_PREMATURE_CLOSE","Premature close"),l("ERR_STREAM_DESTROYED",function(b){return"Cannot call "+b+" after a stream was destroyed"}),l("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),l("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),l("ERR_STREAM_WRITE_AFTER_END","write after end"),l("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),l("ERR_UNKNOWN_ENCODING",function(b){return"Unknown encoding: "+b},TypeError),l("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),a.exports.codes=y},{}],16:[function(o,a){(function(c){(function(){function l(T){return this instanceof l?(f.call(this,T),y.call(this,T),this.allowHalfOpen=!0,void(T&&(T.readable===!1&&(this.readable=!1),T.writable===!1&&(this.writable=!1),T.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",g))))):new l(T)}function g(){this._writableState.ended||c.nextTick(p,this)}function p(T){T.end()}var h=Object.keys||function(T){var I=[];for(var m in T)I.push(m);return I};a.exports=l;var f=o("./_stream_readable"),y=o("./_stream_writable");o("inherits")(l,f);for(var b,v=h(y.prototype),O=0;O<v.length;O++)b=v[O],l.prototype[b]||(l.prototype[b]=y.prototype[b]);Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(T){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=T,this._writableState.destroyed=T)}})}).call(this)}).call(this,o("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(o,a){function c(g){return this instanceof c?void l.call(this,g):new c(g)}a.exports=c;var l=o("./_stream_transform");o("inherits")(c,l),c.prototype._transform=function(g,p,h){h(null,g)}},{"./_stream_transform":19,inherits:10}],18:[function(o,a){(function(c,l){(function(){function g(w){return Et.from(w)}function p(w){return Et.isBuffer(w)||w instanceof nt}function h(w,i,u){return typeof w.prependListener=="function"?w.prependListener(i,u):void(w._events&&w._events[i]?Array.isArray(w._events[i])?w._events[i].unshift(u):w._events[i]=[u,w._events[i]]:w.on(i,u))}function f(w,i,u){_t=_t||o("./_stream_duplex"),w=w||{},typeof u!="boolean"&&(u=i instanceof _t),this.objectMode=!!w.objectMode,u&&(this.objectMode=this.objectMode||!!w.readableObjectMode),this.highWaterMark=ae(this,w,"readableHighWaterMark",u),this.buffer=new pe,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=w.emitClose!==!1,this.autoDestroy=!!w.autoDestroy,this.destroyed=!1,this.defaultEncoding=w.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,w.encoding&&(!At&&(At=o("string_decoder/").StringDecoder),this.decoder=new At(w.encoding),this.encoding=w.encoding)}function y(w){if(_t=_t||o("./_stream_duplex"),!(this instanceof y))return new y(w);var i=this instanceof _t;this._readableState=new f(w,this,i),this.readable=!0,w&&(typeof w.read=="function"&&(this._read=w.read),typeof w.destroy=="function"&&(this._destroy=w.destroy)),Dt.call(this)}function b(w,i,u,d,E){H("readableAddChunk",i);var x=w._readableState;if(i===null)x.reading=!1,m(w,x);else{var U;if(E||(U=O(x,i)),U)B(w,U);else if(!(x.objectMode||i&&0<i.length))d||(x.reading=!1,R(w,x));else if(typeof i=="string"||x.objectMode||Object.getPrototypeOf(i)===Et.prototype||(i=g(i)),d)x.endEmitted?B(w,new M):v(w,x,i,!0);else if(x.ended)B(w,new dt);else{if(x.destroyed)return!1;x.reading=!1,x.decoder&&!u?(i=x.decoder.write(i),x.objectMode||i.length!==0?v(w,x,i,!1):R(w,x)):v(w,x,i,!1)}}return!x.ended&&(x.length<x.highWaterMark||x.length===0)}function v(w,i,u,d){i.flowing&&i.length===0&&!i.sync?(i.awaitDrain=0,w.emit("data",u)):(i.length+=i.objectMode?1:u.length,d?i.buffer.unshift(u):i.buffer.push(u),i.needReadable&&_(w)),R(w,i)}function O(w,i){var u;return p(i)||typeof i=="string"||i===void 0||w.objectMode||(u=new Tt("chunk",["string","Buffer","Uint8Array"],i)),u}function T(w){return 1073741824<=w?w=1073741824:(w--,w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,w|=w>>>16,w++),w}function I(w,i){return 0>=w||i.length===0&&i.ended?0:i.objectMode?1:w===w?(w>i.highWaterMark&&(i.highWaterMark=T(w)),w<=i.length?w:i.ended?i.length:(i.needReadable=!0,0)):i.flowing&&i.length?i.buffer.head.data.length:i.length}function m(w,i){if(H("onEofChunk"),!i.ended){if(i.decoder){var u=i.decoder.end();u&&u.length&&(i.buffer.push(u),i.length+=i.objectMode?1:u.length)}i.ended=!0,i.sync?_(w):(i.needReadable=!1,!i.emittedReadable&&(i.emittedReadable=!0,C(w)))}}function _(w){var i=w._readableState;H("emitReadable",i.needReadable,i.emittedReadable),i.needReadable=!1,i.emittedReadable||(H("emitReadable",i.flowing),i.emittedReadable=!0,c.nextTick(C,w))}function C(w){var i=w._readableState;H("emitReadable_",i.destroyed,i.length,i.ended),!i.destroyed&&(i.length||i.ended)&&(w.emit("readable"),i.emittedReadable=!1),i.needReadable=!i.flowing&&!i.ended&&i.length<=i.highWaterMark,P(w)}function R(w,i){i.readingMore||(i.readingMore=!0,c.nextTick(S,w,i))}function S(w,i){for(;!i.reading&&!i.ended&&(i.length<i.highWaterMark||i.flowing&&i.length===0);){var u=i.length;if(H("maybeReadMore read 0"),w.read(0),u===i.length)break}i.readingMore=!1}function A(w){return function(){var i=w._readableState;H("pipeOnDrain",i.awaitDrain),i.awaitDrain&&i.awaitDrain--,i.awaitDrain===0&&Ht(w,"data")&&(i.flowing=!0,P(w))}}function N(w){var i=w._readableState;i.readableListening=0<w.listenerCount("readable"),i.resumeScheduled&&!i.paused?i.flowing=!0:0<w.listenerCount("data")&&w.resume()}function k(w){H("readable nexttick read 0"),w.read(0)}function D(w,i){i.resumeScheduled||(i.resumeScheduled=!0,c.nextTick(j,w,i))}function j(w,i){H("resume",i.reading),i.reading||w.read(0),i.resumeScheduled=!1,w.emit("resume"),P(w),i.flowing&&!i.reading&&w.read(0)}function P(w){var i=w._readableState;for(H("flow",i.flowing);i.flowing&&w.read()!==null;);}function z(w,i){if(i.length===0)return null;var u;return i.objectMode?u=i.buffer.shift():!w||w>=i.length?(u=i.decoder?i.buffer.join(""):i.buffer.length===1?i.buffer.first():i.buffer.concat(i.length),i.buffer.clear()):u=i.buffer.consume(w,i.decoder),u}function K(w){var i=w._readableState;H("endReadable",i.endEmitted),i.endEmitted||(i.ended=!0,c.nextTick(X,i,w))}function X(w,i){if(H("endReadableNT",w.endEmitted,w.length),!w.endEmitted&&w.length===0&&(w.endEmitted=!0,i.readable=!1,i.emit("end"),w.autoDestroy)){var u=i._writableState;(!u||u.autoDestroy&&u.finished)&&i.destroy()}}function et(w,i){for(var u=0,d=w.length;u<d;u++)if(w[u]===i)return u;return-1}a.exports=y;var _t;y.ReadableState=f;var H;o("events").EventEmitter;var Ht=function(w,i){return w.listeners(i).length},Dt=o("./internal/streams/stream"),Et=o("buffer").Buffer,nt=l.Uint8Array||function(){},Q=o("util");H=Q&&Q.debuglog?Q.debuglog("stream"):function(){};var At,ut,Bt,pe=o("./internal/streams/buffer_list"),Yt=o("./internal/streams/destroy"),ht=o("./internal/streams/state"),ae=ht.getHighWaterMark,kt=o("../errors").codes,Tt=kt.ERR_INVALID_ARG_TYPE,dt=kt.ERR_STREAM_PUSH_AFTER_EOF,L=kt.ERR_METHOD_NOT_IMPLEMENTED,M=kt.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;o("inherits")(y,Dt);var B=Yt.errorOrDestroy,W=["error","close","destroy","pause","resume"];Object.defineProperty(y.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(w){this._readableState&&(this._readableState.destroyed=w)}}),y.prototype.destroy=Yt.destroy,y.prototype._undestroy=Yt.undestroy,y.prototype._destroy=function(w,i){i(w)},y.prototype.push=function(w,i){var u,d=this._readableState;return d.objectMode?u=!0:typeof w=="string"&&(i=i||d.defaultEncoding,i!==d.encoding&&(w=Et.from(w,i),i=""),u=!0),b(this,w,i,!1,u)},y.prototype.unshift=function(w){return b(this,w,null,!0,!1)},y.prototype.isPaused=function(){return this._readableState.flowing===!1},y.prototype.setEncoding=function(w){At||(At=o("string_decoder/").StringDecoder);var i=new At(w);this._readableState.decoder=i,this._readableState.encoding=this._readableState.decoder.encoding;for(var u=this._readableState.buffer.head,d="";u!==null;)d+=i.write(u.data),u=u.next;return this._readableState.buffer.clear(),d!==""&&this._readableState.buffer.push(d),this._readableState.length=d.length,this},y.prototype.read=function(w){H("read",w),w=parseInt(w,10);var i=this._readableState,u=w;if(w!==0&&(i.emittedReadable=!1),w===0&&i.needReadable&&((i.highWaterMark===0?0<i.length:i.length>=i.highWaterMark)||i.ended))return H("read: emitReadable",i.length,i.ended),i.length===0&&i.ended?K(this):_(this),null;if(w=I(w,i),w===0&&i.ended)return i.length===0&&K(this),null;var d=i.needReadable;H("need readable",d),(i.length===0||i.length-w<i.highWaterMark)&&(d=!0,H("length less than watermark",d)),i.ended||i.reading?(d=!1,H("reading or ended",d)):d&&(H("do read"),i.reading=!0,i.sync=!0,i.length===0&&(i.needReadable=!0),this._read(i.highWaterMark),i.sync=!1,!i.reading&&(w=I(u,i)));var E;return E=0<w?z(w,i):null,E===null?(i.needReadable=i.length<=i.highWaterMark,w=0):(i.length-=w,i.awaitDrain=0),i.length===0&&(!i.ended&&(i.needReadable=!0),u!==w&&i.ended&&K(this)),E!==null&&this.emit("data",E),E},y.prototype._read=function(){B(this,new L("_read()"))},y.prototype.pipe=function(w,i){function u(ce,be){H("onunpipe"),ce===J&&be&&be.hasUnpiped===!1&&(be.hasUnpiped=!0,E())}function d(){H("onend"),w.end()}function E(){H("cleanup"),w.removeListener("close",V),w.removeListener("finish",Y),w.removeListener("drain",ye),w.removeListener("error",U),w.removeListener("unpipe",u),J.removeListener("end",d),J.removeListener("end",tt),J.removeListener("data",x),ke=!0,G.awaitDrain&&(!w._writableState||w._writableState.needDrain)&&ye()}function x(ce){H("ondata");var be=w.write(ce);H("dest.write",be),be===!1&&((G.pipesCount===1&&G.pipes===w||1<G.pipesCount&&et(G.pipes,w)!==-1)&&!ke&&(H("false write response, pause",G.awaitDrain),G.awaitDrain++),J.pause())}function U(ce){H("onerror",ce),tt(),w.removeListener("error",U),Ht(w,"error")===0&&B(w,ce)}function V(){w.removeListener("finish",Y),tt()}function Y(){H("onfinish"),w.removeListener("close",V),tt()}function tt(){H("unpipe"),J.unpipe(w)}var J=this,G=this._readableState;switch(G.pipesCount){case 0:G.pipes=w;break;case 1:G.pipes=[G.pipes,w];break;default:G.pipes.push(w)}G.pipesCount+=1,H("pipe count=%d opts=%j",G.pipesCount,i);var rt=(!i||i.end!==!1)&&w!==c.stdout&&w!==c.stderr,$t=rt?d:tt;G.endEmitted?c.nextTick($t):J.once("end",$t),w.on("unpipe",u);var ye=A(J);w.on("drain",ye);var ke=!1;return J.on("data",x),h(w,"error",U),w.once("close",V),w.once("finish",Y),w.emit("pipe",J),G.flowing||(H("pipe resume"),J.resume()),w},y.prototype.unpipe=function(w){var i=this._readableState,u={hasUnpiped:!1};if(i.pipesCount===0)return this;if(i.pipesCount===1)return w&&w!==i.pipes?this:(w||(w=i.pipes),i.pipes=null,i.pipesCount=0,i.flowing=!1,w&&w.emit("unpipe",this,u),this);if(!w){var d=i.pipes,E=i.pipesCount;i.pipes=null,i.pipesCount=0,i.flowing=!1;for(var x=0;x<E;x++)d[x].emit("unpipe",this,{hasUnpiped:!1});return this}var U=et(i.pipes,w);return U===-1?this:(i.pipes.splice(U,1),i.pipesCount-=1,i.pipesCount===1&&(i.pipes=i.pipes[0]),w.emit("unpipe",this,u),this)},y.prototype.on=function(w,i){var u=Dt.prototype.on.call(this,w,i),d=this._readableState;return w==="data"?(d.readableListening=0<this.listenerCount("readable"),d.flowing!==!1&&this.resume()):w=="readable"&&!d.endEmitted&&!d.readableListening&&(d.readableListening=d.needReadable=!0,d.flowing=!1,d.emittedReadable=!1,H("on readable",d.length,d.reading),d.length?_(this):!d.reading&&c.nextTick(k,this)),u},y.prototype.addListener=y.prototype.on,y.prototype.removeListener=function(w,i){var u=Dt.prototype.removeListener.call(this,w,i);return w==="readable"&&c.nextTick(N,this),u},y.prototype.removeAllListeners=function(w){var i=Dt.prototype.removeAllListeners.apply(this,arguments);return(w==="readable"||w===void 0)&&c.nextTick(N,this),i},y.prototype.resume=function(){var w=this._readableState;return w.flowing||(H("resume"),w.flowing=!w.readableListening,D(this,w)),w.paused=!1,this},y.prototype.pause=function(){return H("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(H("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},y.prototype.wrap=function(w){var i=this,u=this._readableState,d=!1;for(var E in w.on("end",function(){if(H("wrapped end"),u.decoder&&!u.ended){var U=u.decoder.end();U&&U.length&&i.push(U)}i.push(null)}),w.on("data",function(U){if(H("wrapped data"),u.decoder&&(U=u.decoder.write(U)),!(u.objectMode&&U==null)&&(u.objectMode||U&&U.length)){var V=i.push(U);V||(d=!0,w.pause())}}),w)this[E]===void 0&&typeof w[E]=="function"&&(this[E]=function(U){return function(){return w[U].apply(w,arguments)}}(E));for(var x=0;x<W.length;x++)w.on(W[x],this.emit.bind(this,W[x]));return this._read=function(U){H("wrapped _read",U),d&&(d=!1,w.resume())},this},typeof Symbol=="function"&&(y.prototype[Symbol.asyncIterator]=function(){return ut===void 0&&(ut=o("./internal/streams/async_iterator")),ut(this)}),Object.defineProperty(y.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(y.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(y.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(w){this._readableState&&(this._readableState.flowing=w)}}),y._fromList=z,Object.defineProperty(y.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(y.from=function(w,i){return Bt===void 0&&(Bt=o("./internal/streams/from")),Bt(y,w,i)})}).call(this)}).call(this,o("_process"),typeof Jt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Jt)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(o,a){function c(T,I){var m=this._transformState;m.transforming=!1;var _=m.writecb;if(_===null)return this.emit("error",new y);m.writechunk=null,m.writecb=null,I!=null&&this.push(I),_(T);var C=this._readableState;C.reading=!1,(C.needReadable||C.length<C.highWaterMark)&&this._read(C.highWaterMark)}function l(T){return this instanceof l?(O.call(this,T),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,T&&(typeof T.transform=="function"&&(this._transform=T.transform),typeof T.flush=="function"&&(this._flush=T.flush)),void this.on("prefinish",g)):new l(T)}function g(){var T=this;typeof this._flush!="function"||this._readableState.destroyed?p(this,null,null):this._flush(function(I,m){p(T,I,m)})}function p(T,I,m){if(I)return T.emit("error",I);if(m!=null&&T.push(m),T._writableState.length)throw new v;if(T._transformState.transforming)throw new b;return T.push(null)}a.exports=l;var h=o("../errors").codes,f=h.ERR_METHOD_NOT_IMPLEMENTED,y=h.ERR_MULTIPLE_CALLBACK,b=h.ERR_TRANSFORM_ALREADY_TRANSFORMING,v=h.ERR_TRANSFORM_WITH_LENGTH_0,O=o("./_stream_duplex");o("inherits")(l,O),l.prototype.push=function(T,I){return this._transformState.needTransform=!1,O.prototype.push.call(this,T,I)},l.prototype._transform=function(T,I,m){m(new f("_transform()"))},l.prototype._write=function(T,I,m){var _=this._transformState;if(_.writecb=m,_.writechunk=T,_.writeencoding=I,!_.transforming){var C=this._readableState;(_.needTransform||C.needReadable||C.length<C.highWaterMark)&&this._read(C.highWaterMark)}},l.prototype._read=function(){var T=this._transformState;T.writechunk===null||T.transforming?T.needTransform=!0:(T.transforming=!0,this._transform(T.writechunk,T.writeencoding,T.afterTransform))},l.prototype._destroy=function(T,I){O.prototype._destroy.call(this,T,function(m){I(m)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(o,a){(function(c,l){(function(){function g(L){var M=this;this.next=null,this.entry=null,this.finish=function(){K(M,L)}}function p(L){return H.from(L)}function h(L){return H.isBuffer(L)||L instanceof Ht}function f(){}function y(L,M,B){X=X||o("./_stream_duplex"),L=L||{},typeof B!="boolean"&&(B=M instanceof X),this.objectMode=!!L.objectMode,B&&(this.objectMode=this.objectMode||!!L.writableObjectMode),this.highWaterMark=nt(this,L,"writableHighWaterMark",B),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var W=L.decodeStrings===!1;this.decodeStrings=!W,this.defaultEncoding=L.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(w){R(M,w)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=L.emitClose!==!1,this.autoDestroy=!!L.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new g(this)}function b(L){X=X||o("./_stream_duplex");var M=this instanceof X;return M||dt.call(b,this)?(this._writableState=new y(L,this,M),this.writable=!0,L&&(typeof L.write=="function"&&(this._write=L.write),typeof L.writev=="function"&&(this._writev=L.writev),typeof L.destroy=="function"&&(this._destroy=L.destroy),typeof L.final=="function"&&(this._final=L.final)),void _t.call(this)):new b(L)}function v(L,M){var B=new ae;Tt(L,B),c.nextTick(M,B)}function O(L,M,B,W){var w;return B===null?w=new ht:typeof B!="string"&&!M.objectMode&&(w=new At("chunk",["string","Buffer"],B)),!w||(Tt(L,w),c.nextTick(W,w),!1)}function T(L,M,B){return L.objectMode||L.decodeStrings===!1||typeof M!="string"||(M=H.from(M,B)),M}function I(L,M,B,W,w,i){if(!B){var u=T(M,W,w);W!==u&&(B=!0,w="buffer",W=u)}var d=M.objectMode?1:W.length;M.length+=d;var E=M.length<M.highWaterMark;if(E||(M.needDrain=!0),M.writing||M.corked){var x=M.lastBufferedRequest;M.lastBufferedRequest={chunk:W,encoding:w,isBuf:B,callback:i,next:null},x?x.next=M.lastBufferedRequest:M.bufferedRequest=M.lastBufferedRequest,M.bufferedRequestCount+=1}else m(L,M,!1,d,W,w,i);return E}function m(L,M,B,W,w,i,u){M.writelen=W,M.writecb=u,M.writing=!0,M.sync=!0,M.destroyed?M.onwrite(new Yt("write")):B?L._writev(w,M.onwrite):L._write(w,i,M.onwrite),M.sync=!1}function _(L,M,B,W,w){--M.pendingcb,B?(c.nextTick(w,W),c.nextTick(P,L,M),L._writableState.errorEmitted=!0,Tt(L,W)):(w(W),L._writableState.errorEmitted=!0,Tt(L,W),P(L,M))}function C(L){L.writing=!1,L.writecb=null,L.length-=L.writelen,L.writelen=0}function R(L,M){var B=L._writableState,W=B.sync,w=B.writecb;if(typeof w!="function")throw new Bt;if(C(B),M)_(L,B,W,M,w);else{var i=k(B)||L.destroyed;i||B.corked||B.bufferProcessing||!B.bufferedRequest||N(L,B),W?c.nextTick(S,L,B,i,w):S(L,B,i,w)}}function S(L,M,B,W){B||A(L,M),M.pendingcb--,W(),P(L,M)}function A(L,M){M.length===0&&M.needDrain&&(M.needDrain=!1,L.emit("drain"))}function N(L,M){M.bufferProcessing=!0;var B=M.bufferedRequest;if(L._writev&&B&&B.next){var W=M.bufferedRequestCount,w=Array(W),i=M.corkedRequestsFree;i.entry=B;for(var u=0,d=!0;B;)w[u]=B,B.isBuf||(d=!1),B=B.next,u+=1;w.allBuffers=d,m(L,M,!0,M.length,w,"",i.finish),M.pendingcb++,M.lastBufferedRequest=null,i.next?(M.corkedRequestsFree=i.next,i.next=null):M.corkedRequestsFree=new g(M),M.bufferedRequestCount=0}else{for(;B;){var E=B.chunk,x=B.encoding,U=B.callback,V=M.objectMode?1:E.length;if(m(L,M,!1,V,E,x,U),B=B.next,M.bufferedRequestCount--,M.writing)break}B===null&&(M.lastBufferedRequest=null)}M.bufferedRequest=B,M.bufferProcessing=!1}function k(L){return L.ending&&L.length===0&&L.bufferedRequest===null&&!L.finished&&!L.writing}function D(L,M){L._final(function(B){M.pendingcb--,B&&Tt(L,B),M.prefinished=!0,L.emit("prefinish"),P(L,M)})}function j(L,M){M.prefinished||M.finalCalled||(typeof L._final!="function"||M.destroyed?(M.prefinished=!0,L.emit("prefinish")):(M.pendingcb++,M.finalCalled=!0,c.nextTick(D,L,M)))}function P(L,M){var B=k(M);if(B&&(j(L,M),M.pendingcb===0&&(M.finished=!0,L.emit("finish"),M.autoDestroy))){var W=L._readableState;(!W||W.autoDestroy&&W.endEmitted)&&L.destroy()}return B}function z(L,M,B){M.ending=!0,P(L,M),B&&(M.finished?c.nextTick(B):L.once("finish",B)),M.ended=!0,L.writable=!1}function K(L,M,B){var W=L.entry;for(L.entry=null;W;){var w=W.callback;M.pendingcb--,w(B),W=W.next}M.corkedRequestsFree.next=L}a.exports=b;var X;b.WritableState=y;var et={deprecate:o("util-deprecate")},_t=o("./internal/streams/stream"),H=o("buffer").Buffer,Ht=l.Uint8Array||function(){},Dt=o("./internal/streams/destroy"),Et=o("./internal/streams/state"),nt=Et.getHighWaterMark,Q=o("../errors").codes,At=Q.ERR_INVALID_ARG_TYPE,ut=Q.ERR_METHOD_NOT_IMPLEMENTED,Bt=Q.ERR_MULTIPLE_CALLBACK,pe=Q.ERR_STREAM_CANNOT_PIPE,Yt=Q.ERR_STREAM_DESTROYED,ht=Q.ERR_STREAM_NULL_VALUES,ae=Q.ERR_STREAM_WRITE_AFTER_END,kt=Q.ERR_UNKNOWN_ENCODING,Tt=Dt.errorOrDestroy;o("inherits")(b,_t),y.prototype.getBuffer=function(){for(var L=this.bufferedRequest,M=[];L;)M.push(L),L=L.next;return M},function(){try{Object.defineProperty(y.prototype,"buffer",{get:et.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var dt;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(dt=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(L){return!!dt.call(this,L)||this===b&&L&&L._writableState instanceof y}})):dt=function(L){return L instanceof this},b.prototype.pipe=function(){Tt(this,new pe)},b.prototype.write=function(L,M,B){var W=this._writableState,w=!1,i=!W.objectMode&&h(L);return i&&!H.isBuffer(L)&&(L=p(L)),typeof M=="function"&&(B=M,M=null),i?M="buffer":!M&&(M=W.defaultEncoding),typeof B!="function"&&(B=f),W.ending?v(this,B):(i||O(this,W,L,B))&&(W.pendingcb++,w=I(this,W,i,L,M,B)),w},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var L=this._writableState;L.corked&&(L.corked--,!L.writing&&!L.corked&&!L.bufferProcessing&&L.bufferedRequest&&N(this,L))},b.prototype.setDefaultEncoding=function(L){if(typeof L=="string"&&(L=L.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((L+"").toLowerCase())))throw new kt(L);return this._writableState.defaultEncoding=L,this},Object.defineProperty(b.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),b.prototype._write=function(L,M,B){B(new ut("_write()"))},b.prototype._writev=null,b.prototype.end=function(L,M,B){var W=this._writableState;return typeof L=="function"?(B=L,L=null,M=null):typeof M=="function"&&(B=M,M=null),L!=null&&this.write(L,M),W.corked&&(W.corked=1,this.uncork()),W.ending||z(this,W,B),this},Object.defineProperty(b.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(b.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(L){this._writableState&&(this._writableState.destroyed=L)}}),b.prototype.destroy=Dt.destroy,b.prototype._undestroy=Dt.undestroy,b.prototype._destroy=function(L,M){M(L)}}).call(this)}).call(this,o("_process"),typeof Jt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Jt)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(o,a){(function(c){(function(){function l(A,N,k){return N in A?Object.defineProperty(A,N,{value:k,enumerable:!0,configurable:!0,writable:!0}):A[N]=k,A}function g(A,N){return{value:A,done:N}}function p(A){var N=A[v];if(N!==null){var k=A[C].read();k!==null&&(A[m]=null,A[v]=null,A[O]=null,N(g(k,!1)))}}function h(A){c.nextTick(p,A)}function f(A,N){return function(k,D){A.then(function(){return N[I]?void k(g(void 0,!0)):void N[_](k,D)},D)}}var y,b=o("./end-of-stream"),v=Symbol("lastResolve"),O=Symbol("lastReject"),T=Symbol("error"),I=Symbol("ended"),m=Symbol("lastPromise"),_=Symbol("handlePromise"),C=Symbol("stream"),R=Object.getPrototypeOf(function(){}),S=Object.setPrototypeOf((y={get stream(){return this[C]},next:function(){var A=this,N=this[T];if(N!==null)return Promise.reject(N);if(this[I])return Promise.resolve(g(void 0,!0));if(this[C].destroyed)return new Promise(function(P,z){c.nextTick(function(){A[T]?z(A[T]):P(g(void 0,!0))})});var k,D=this[m];if(D)k=new Promise(f(D,this));else{var j=this[C].read();if(j!==null)return Promise.resolve(g(j,!1));k=new Promise(this[_])}return this[m]=k,k}},l(y,Symbol.asyncIterator,function(){return this}),l(y,"return",function(){var A=this;return new Promise(function(N,k){A[C].destroy(null,function(D){return D?void k(D):void N(g(void 0,!0))})})}),y),R);a.exports=function(A){var N,k=Object.create(S,(N={},l(N,C,{value:A,writable:!0}),l(N,v,{value:null,writable:!0}),l(N,O,{value:null,writable:!0}),l(N,T,{value:null,writable:!0}),l(N,I,{value:A._readableState.endEmitted,writable:!0}),l(N,_,{value:function(D,j){var P=k[C].read();P?(k[m]=null,k[v]=null,k[O]=null,D(g(P,!1))):(k[v]=D,k[O]=j)},writable:!0}),N));return k[m]=null,b(A,function(D){if(D&&D.code!=="ERR_STREAM_PREMATURE_CLOSE"){var j=k[O];return j!==null&&(k[m]=null,k[v]=null,k[O]=null,j(D)),void(k[T]=D)}var P=k[v];P!==null&&(k[m]=null,k[v]=null,k[O]=null,P(g(void 0,!0))),k[I]=!0}),A.on("readable",h.bind(null,k)),k}}).call(this)}).call(this,o("_process"))},{"./end-of-stream":24,_process:12}],22:[function(o,a){function c(m,_){var C=Object.keys(m);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(m);_&&(R=R.filter(function(S){return Object.getOwnPropertyDescriptor(m,S).enumerable})),C.push.apply(C,R)}return C}function l(m){for(var _,C=1;C<arguments.length;C++)_=arguments[C]==null?{}:arguments[C],C%2?c(Object(_),!0).forEach(function(R){g(m,R,_[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(_)):c(Object(_)).forEach(function(R){Object.defineProperty(m,R,Object.getOwnPropertyDescriptor(_,R))});return m}function g(m,_,C){return _ in m?Object.defineProperty(m,_,{value:C,enumerable:!0,configurable:!0,writable:!0}):m[_]=C,m}function p(m,_){if(!(m instanceof _))throw new TypeError("Cannot call a class as a function")}function h(m,_){for(var C,R=0;R<_.length;R++)C=_[R],C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(m,C.key,C)}function f(m,_,C){return _&&h(m.prototype,_),C&&h(m,C),m}function y(m,_,C){v.prototype.copy.call(m,_,C)}var b=o("buffer"),v=b.Buffer,O=o("util"),T=O.inspect,I=T&&T.custom||"inspect";a.exports=function(){function m(){p(this,m),this.head=null,this.tail=null,this.length=0}return f(m,[{key:"push",value:function(_){var C={data:_,next:null};0<this.length?this.tail.next=C:this.head=C,this.tail=C,++this.length}},{key:"unshift",value:function(_){var C={data:_,next:this.head};this.length===0&&(this.tail=C),this.head=C,++this.length}},{key:"shift",value:function(){if(this.length!==0){var _=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,_}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(_){if(this.length===0)return"";for(var C=this.head,R=""+C.data;C=C.next;)R+=_+C.data;return R}},{key:"concat",value:function(_){if(this.length===0)return v.alloc(0);for(var C=v.allocUnsafe(_>>>0),R=this.head,S=0;R;)y(R.data,C,S),S+=R.data.length,R=R.next;return C}},{key:"consume",value:function(_,C){var R;return _<this.head.data.length?(R=this.head.data.slice(0,_),this.head.data=this.head.data.slice(_)):_===this.head.data.length?R=this.shift():R=C?this._getString(_):this._getBuffer(_),R}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(_){var C=this.head,R=1,S=C.data;for(_-=S.length;C=C.next;){var A=C.data,N=_>A.length?A.length:_;if(S+=N===A.length?A:A.slice(0,_),_-=N,_===0){N===A.length?(++R,this.head=C.next?C.next:this.tail=null):(this.head=C,C.data=A.slice(N));break}++R}return this.length-=R,S}},{key:"_getBuffer",value:function(_){var C=v.allocUnsafe(_),R=this.head,S=1;for(R.data.copy(C),_-=R.data.length;R=R.next;){var A=R.data,N=_>A.length?A.length:_;if(A.copy(C,C.length-_,0,N),_-=N,_===0){N===A.length?(++S,this.head=R.next?R.next:this.tail=null):(this.head=R,R.data=A.slice(N));break}++S}return this.length-=S,C}},{key:I,value:function(_,C){return T(this,l({},C,{depth:0,customInspect:!1}))}}]),m}()},{buffer:3,util:2}],23:[function(o,a){(function(c){(function(){function l(h,f){p(h,f),g(h)}function g(h){h._writableState&&!h._writableState.emitClose||h._readableState&&!h._readableState.emitClose||h.emit("close")}function p(h,f){h.emit("error",f)}a.exports={destroy:function(h,f){var y=this,b=this._readableState&&this._readableState.destroyed,v=this._writableState&&this._writableState.destroyed;return b||v?(f?f(h):h&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,c.nextTick(p,this,h)):c.nextTick(p,this,h)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(h||null,function(O){!f&&O?y._writableState?y._writableState.errorEmitted?c.nextTick(g,y):(y._writableState.errorEmitted=!0,c.nextTick(l,y,O)):c.nextTick(l,y,O):f?(c.nextTick(g,y),f(O)):c.nextTick(g,y)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(h,f){var y=h._readableState,b=h._writableState;y&&y.autoDestroy||b&&b.autoDestroy?h.destroy(f):h.emit("error",f)}}}).call(this)}).call(this,o("_process"))},{_process:12}],24:[function(o,a){function c(f){var y=!1;return function(){if(!y){y=!0;for(var b=arguments.length,v=Array(b),O=0;O<b;O++)v[O]=arguments[O];f.apply(this,v)}}}function l(){}function g(f){return f.setHeader&&typeof f.abort=="function"}function p(f,y,b){if(typeof y=="function")return p(f,null,y);y||(y={}),b=c(b||l);var v=y.readable||y.readable!==!1&&f.readable,O=y.writable||y.writable!==!1&&f.writable,T=function(){f.writable||m()},I=f._writableState&&f._writableState.finished,m=function(){O=!1,I=!0,v||b.call(f)},_=f._readableState&&f._readableState.endEmitted,C=function(){v=!1,_=!0,O||b.call(f)},R=function(N){b.call(f,N)},S=function(){var N;return v&&!_?(f._readableState&&f._readableState.ended||(N=new h),b.call(f,N)):O&&!I?(f._writableState&&f._writableState.ended||(N=new h),b.call(f,N)):void 0},A=function(){f.req.on("finish",m)};return g(f)?(f.on("complete",m),f.on("abort",S),f.req?A():f.on("request",A)):O&&!f._writableState&&(f.on("end",T),f.on("close",T)),f.on("end",C),f.on("finish",m),y.error!==!1&&f.on("error",R),f.on("close",S),function(){f.removeListener("complete",m),f.removeListener("abort",S),f.removeListener("request",A),f.req&&f.req.removeListener("finish",m),f.removeListener("end",T),f.removeListener("close",T),f.removeListener("finish",m),f.removeListener("end",C),f.removeListener("error",R),f.removeListener("close",S)}}var h=o("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;a.exports=p},{"../../../errors":15}],25:[function(o,a){a.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(o,a){function c(I){var m=!1;return function(){m||(m=!0,I.apply(void 0,arguments))}}function l(I){if(I)throw I}function g(I){return I.setHeader&&typeof I.abort=="function"}function p(I,m,_,C){C=c(C);var R=!1;I.on("close",function(){R=!0}),b===void 0&&(b=o("./end-of-stream")),b(I,{readable:m,writable:_},function(A){return A?C(A):(R=!0,void C())});var S=!1;return function(A){if(!R)return S?void 0:(S=!0,g(I)?I.abort():typeof I.destroy=="function"?I.destroy():void C(A||new T("pipe")))}}function h(I){I()}function f(I,m){return I.pipe(m)}function y(I){return I.length&&typeof I[I.length-1]=="function"?I.pop():l}var b,v=o("../../../errors").codes,O=v.ERR_MISSING_ARGS,T=v.ERR_STREAM_DESTROYED;a.exports=function(){for(var I=arguments.length,m=Array(I),_=0;_<I;_++)m[_]=arguments[_];var C=y(m);if(Array.isArray(m[0])&&(m=m[0]),2>m.length)throw new O("streams");var R,S=m.map(function(A,N){var k=N<m.length-1;return p(A,k,0<N,function(D){R||(R=D),D&&S.forEach(h),k||(S.forEach(h),C(R))})});return m.reduce(f)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(o,a){function c(g,p,h){return g.highWaterMark==null?p?g[h]:null:g.highWaterMark}var l=o("../../../errors").codes.ERR_INVALID_OPT_VALUE;a.exports={getHighWaterMark:function(g,p,h,f){var y=c(p,f,h);if(y!=null){if(!(isFinite(y)&&n(y)===y)||0>y){var b=f?h:"highWaterMark";throw new l(b,y)}return n(y)}return g.objectMode?16:16384}}},{"../../../errors":15}],28:[function(o,a){a.exports=o("events").EventEmitter},{events:7}],29:[function(o,a,c){c=a.exports=o("./lib/_stream_readable.js"),c.Stream=c,c.Readable=c,c.Writable=o("./lib/_stream_writable.js"),c.Duplex=o("./lib/_stream_duplex.js"),c.Transform=o("./lib/_stream_transform.js"),c.PassThrough=o("./lib/_stream_passthrough.js"),c.finished=o("./lib/internal/streams/end-of-stream.js"),c.pipeline=o("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(o,a,c){function l(f,y){for(var b in f)y[b]=f[b]}function g(f,y,b){return h(f,y,b)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var p=o("buffer"),h=p.Buffer;h.from&&h.alloc&&h.allocUnsafe&&h.allocUnsafeSlow?a.exports=p:(l(p,c),c.Buffer=g),g.prototype=Object.create(h.prototype),l(h,g),g.from=function(f,y,b){if(typeof f=="number")throw new TypeError("Argument must not be a number");return h(f,y,b)},g.alloc=function(f,y,b){if(typeof f!="number")throw new TypeError("Argument must be a number");var v=h(f);return y===void 0?v.fill(0):typeof b=="string"?v.fill(y,b):v.fill(y),v},g.allocUnsafe=function(f){if(typeof f!="number")throw new TypeError("Argument must be a number");return h(f)},g.allocUnsafeSlow=function(f){if(typeof f!="number")throw new TypeError("Argument must be a number");return p.SlowBuffer(f)}},{buffer:3}],31:[function(o,a,c){function l(S){if(!S)return"utf8";for(var A;;)switch(S){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return S;default:if(A)return;S=(""+S).toLowerCase(),A=!0}}function g(S){var A=l(S);if(typeof A!="string"&&(C.isEncoding===R||!R(S)))throw new Error("Unknown encoding: "+S);return A||S}function p(S){this.encoding=g(S);var A;switch(this.encoding){case"utf16le":this.text=v,this.end=O,A=4;break;case"utf8":this.fillLast=b,A=4;break;case"base64":this.text=T,this.end=I,A=3;break;default:return this.write=m,void(this.end=_)}this.lastNeed=0,this.lastTotal=0,this.lastChar=C.allocUnsafe(A)}function h(S){return 127>=S?0:S>>5==6?2:S>>4==14?3:S>>3==30?4:S>>6==2?-1:-2}function f(S,A,N){var k=A.length-1;if(k<N)return 0;var D=h(A[k]);return 0<=D?(0<D&&(S.lastNeed=D-1),D):--k<N||D===-2?0:(D=h(A[k]),0<=D?(0<D&&(S.lastNeed=D-2),D):--k<N||D===-2?0:(D=h(A[k]),0<=D?(0<D&&(D===2?D=0:S.lastNeed=D-3),D):0))}function y(S,A){if((192&A[0])!=128)return S.lastNeed=0,"�";if(1<S.lastNeed&&1<A.length){if((192&A[1])!=128)return S.lastNeed=1,"�";if(2<S.lastNeed&&2<A.length&&(192&A[2])!=128)return S.lastNeed=2,"�"}}function b(S){var A=this.lastTotal-this.lastNeed,N=y(this,S);return N===void 0?this.lastNeed<=S.length?(S.copy(this.lastChar,A,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(S.copy(this.lastChar,A,0,S.length),void(this.lastNeed-=S.length)):N}function v(S,A){if((S.length-A)%2==0){var N=S.toString("utf16le",A);if(N){var k=N.charCodeAt(N.length-1);if(55296<=k&&56319>=k)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=S[S.length-2],this.lastChar[1]=S[S.length-1],N.slice(0,-1)}return N}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=S[S.length-1],S.toString("utf16le",A,S.length-1)}function O(S){var A=S&&S.length?this.write(S):"";if(this.lastNeed){var N=this.lastTotal-this.lastNeed;return A+this.lastChar.toString("utf16le",0,N)}return A}function T(S,A){var N=(S.length-A)%3;return N==0?S.toString("base64",A):(this.lastNeed=3-N,this.lastTotal=3,N==1?this.lastChar[0]=S[S.length-1]:(this.lastChar[0]=S[S.length-2],this.lastChar[1]=S[S.length-1]),S.toString("base64",A,S.length-N))}function I(S){var A=S&&S.length?this.write(S):"";return this.lastNeed?A+this.lastChar.toString("base64",0,3-this.lastNeed):A}function m(S){return S.toString(this.encoding)}function _(S){return S&&S.length?this.write(S):""}var C=o("safe-buffer").Buffer,R=C.isEncoding||function(S){switch(S=""+S,S&&S.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};c.StringDecoder=p,p.prototype.write=function(S){if(S.length===0)return"";var A,N;if(this.lastNeed){if(A=this.fillLast(S),A===void 0)return"";N=this.lastNeed,this.lastNeed=0}else N=0;return N<S.length?A?A+this.text(S,N):this.text(S,N):A||""},p.prototype.end=function(S){var A=S&&S.length?this.write(S):"";return this.lastNeed?A+"�":A},p.prototype.text=function(S,A){var N=f(this,S,A);if(!this.lastNeed)return S.toString("utf8",A);this.lastTotal=N;var k=S.length-(N-this.lastNeed);return S.copy(this.lastChar,0,k),S.toString("utf8",A,k)},p.prototype.fillLast=function(S){return this.lastNeed<=S.length?(S.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(S.copy(this.lastChar,this.lastTotal-this.lastNeed,0,S.length),void(this.lastNeed-=S.length))}},{"safe-buffer":30}],32:[function(o,a){(function(c){(function(){function l(g){try{if(!c.localStorage)return!1}catch{return!1}var p=c.localStorage[g];return p!=null&&(p+"").toLowerCase()==="true"}a.exports=function(g,p){function h(){if(!f){if(l("throwDeprecation"))throw new Error(p);l("traceDeprecation")?console.trace(p):console.warn(p),f=!0}return g.apply(this,arguments)}if(l("noDeprecation"))return g;var f=!1;return h}}).call(this)}).call(this,typeof Jt>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Jt)},{}],"/":[function(o,a){function c(I){return I.replace(/a=ice-options:trickle\s\n/g,"")}function l(I){console.warn(I)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const g=o("debug")("simple-peer"),p=o("get-browser-rtc"),h=o("randombytes"),f=o("readable-stream"),y=o("queue-microtask"),b=o("err-code"),{Buffer:v}=o("buffer"),O=65536;class T extends f.Duplex{constructor(m){if(m=Object.assign({allowHalfOpen:!1},m),super(m),this._id=h(4).toString("hex").slice(0,7),this._debug("new peer %o",m),this.channelName=m.initiator?m.channelName||h(20).toString("hex"):null,this.initiator=m.initiator||!1,this.channelConfig=m.channelConfig||T.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},T.config,m.config),this.offerOptions=m.offerOptions||{},this.answerOptions=m.answerOptions||{},this.sdpTransform=m.sdpTransform||(_=>_),this.streams=m.streams||(m.stream?[m.stream]:[]),this.trickle=m.trickle===void 0||m.trickle,this.allowHalfTrickle=m.allowHalfTrickle!==void 0&&m.allowHalfTrickle,this.iceCompleteTimeout=m.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=m.wrtc&&typeof m.wrtc=="object"?m.wrtc:p(),!this._wrtc)throw b(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(_){return void this.destroy(b(_,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=_=>{this._onIceCandidate(_)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(_=>{this.destroy(b(_,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=_=>{this._setupData(_)},this.streams&&this.streams.forEach(_=>{this.addStream(_)}),this._pc.ontrack=_=>{this._onTrack(_)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(m){if(!this.destroying){if(this.destroyed)throw b(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof m=="string")try{m=JSON.parse(m)}catch{m={}}this._debug("signal()"),m.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),m.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(m.transceiverRequest.kind,m.transceiverRequest.init)),m.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(m.candidate):this._pendingCandidates.push(m.candidate)),m.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(m)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(_=>{this._addIceCandidate(_)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(_=>{this.destroy(b(_,"ERR_SET_REMOTE_DESCRIPTION"))}),m.sdp||m.candidate||m.renegotiate||m.transceiverRequest||this.destroy(b(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(m){const _=new this._wrtc.RTCIceCandidate(m);this._pc.addIceCandidate(_).catch(C=>{!_.address||_.address.endsWith(".local")?l("Ignoring unsupported ICE candidate."):this.destroy(b(C,"ERR_ADD_ICE_CANDIDATE"))})}send(m){if(!this.destroying){if(this.destroyed)throw b(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(m)}}addTransceiver(m,_){if(!this.destroying){if(this.destroyed)throw b(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(m,_),this._needsNegotiation()}catch(C){this.destroy(b(C,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:m,init:_}})}}addStream(m){if(!this.destroying){if(this.destroyed)throw b(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),m.getTracks().forEach(_=>{this.addTrack(_,m)})}}addTrack(m,_){if(this.destroying)return;if(this.destroyed)throw b(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const C=this._senderMap.get(m)||new Map;let R=C.get(_);if(!R)R=this._pc.addTrack(m,_),C.set(_,R),this._senderMap.set(m,C),this._needsNegotiation();else throw R.removed?b(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):b(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(m,_,C){if(this.destroying)return;if(this.destroyed)throw b(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const R=this._senderMap.get(m),S=R?R.get(C):null;if(!S)throw b(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");_&&this._senderMap.set(_,R),S.replaceTrack==null?this.destroy(b(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):S.replaceTrack(_)}removeTrack(m,_){if(this.destroying)return;if(this.destroyed)throw b(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const C=this._senderMap.get(m),R=C?C.get(_):null;if(!R)throw b(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{R.removed=!0,this._pc.removeTrack(R)}catch(S){S.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(R):this.destroy(b(S,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(m){if(!this.destroying){if(this.destroyed)throw b(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),m.getTracks().forEach(_=>{this.removeTrack(_,m)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,y(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw b(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(m){this._destroy(m,()=>{})}_destroy(m,_){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",m&&(m.message||m)),y(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",m&&(m.message||m)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,m&&this.emit("error",m),this.emit("close"),_()}))}_setupData(m){if(!m.channel)return this.destroy(b(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=m.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=O),this.channelName=this._channel.label,this._channel.onmessage=C=>{this._onChannelMessage(C)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=C=>{const R=C.error instanceof Error?C.error:new Error(`Datachannel error: ${C.message} ${C.filename}:${C.lineno}:${C.colno}`);this.destroy(b(R,"ERR_DATA_CHANNEL"))};let _=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(_&&this._onChannelClose(),_=!0):_=!1},5e3)}_read(){}_write(m,_,C){if(this.destroyed)return C(b(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(m)}catch(R){return this.destroy(b(R,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>O?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=C):C(null)}else this._debug("write before connect"),this._chunk=m,this._cb=C}_onFinish(){if(!this.destroyed){const m=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?m():this.once("connect",m)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(m=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(m.sdp=c(m.sdp)),m.sdp=this.sdpTransform(m.sdp);const _=()=>{if(!this.destroyed){const C=this._pc.localDescription||m;this._debug("signal"),this.emit("signal",{type:C.type,sdp:C.sdp})}};this._pc.setLocalDescription(m).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(C=>{this.destroy(b(C,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(m=>{this.destroy(b(m,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(m=>{m.mid||!m.sender.track||m.requested||(m.requested=!0,this.addTransceiver(m.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(m=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(m.sdp=c(m.sdp)),m.sdp=this.sdpTransform(m.sdp);const _=()=>{if(!this.destroyed){const C=this._pc.localDescription||m;this._debug("signal"),this.emit("signal",{type:C.type,sdp:C.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(m).then(()=>{this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(C=>{this.destroy(b(C,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(m=>{this.destroy(b(m,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(b(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const m=this._pc.iceConnectionState,_=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",m,_),this.emit("iceStateChange",m,_),(m==="connected"||m==="completed")&&(this._pcReady=!0,this._maybeReady()),m==="failed"&&this.destroy(b(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),m==="closed"&&this.destroy(b(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(m){const _=C=>(Object.prototype.toString.call(C.values)==="[object Array]"&&C.values.forEach(R=>{Object.assign(C,R)}),C);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(C=>{const R=[];C.forEach(S=>{R.push(_(S))}),m(null,R)},C=>m(C)):0<this._pc.getStats.length?this._pc.getStats(C=>{if(this.destroyed)return;const R=[];C.result().forEach(S=>{const A={};S.names().forEach(N=>{A[N]=S.stat(N)}),A.id=S.id,A.type=S.type,A.timestamp=S.timestamp,R.push(_(A))}),m(null,R)},C=>m(C)):m(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const m=()=>{this.destroyed||this.getStats((_,C)=>{if(this.destroyed)return;_&&(C=[]);const R={},S={},A={};let N=!1;C.forEach(D=>{(D.type==="remotecandidate"||D.type==="remote-candidate")&&(R[D.id]=D),(D.type==="localcandidate"||D.type==="local-candidate")&&(S[D.id]=D),(D.type==="candidatepair"||D.type==="candidate-pair")&&(A[D.id]=D)});const k=D=>{N=!0;let j=S[D.localCandidateId];j&&(j.ip||j.address)?(this.localAddress=j.ip||j.address,this.localPort=+j.port):j&&j.ipAddress?(this.localAddress=j.ipAddress,this.localPort=+j.portNumber):typeof D.googLocalAddress=="string"&&(j=D.googLocalAddress.split(":"),this.localAddress=j[0],this.localPort=+j[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let P=R[D.remoteCandidateId];P&&(P.ip||P.address)?(this.remoteAddress=P.ip||P.address,this.remotePort=+P.port):P&&P.ipAddress?(this.remoteAddress=P.ipAddress,this.remotePort=+P.portNumber):typeof D.googRemoteAddress=="string"&&(P=D.googRemoteAddress.split(":"),this.remoteAddress=P[0],this.remotePort=+P[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(C.forEach(D=>{D.type==="transport"&&D.selectedCandidatePairId&&k(A[D.selectedCandidatePairId]),(D.type==="googCandidatePair"&&D.googActiveConnection==="true"||(D.type==="candidatepair"||D.type==="candidate-pair")&&D.selected)&&k(D)}),!N&&(!Object.keys(A).length||Object.keys(S).length))return void setTimeout(m,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(j){return this.destroy(b(j,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const D=this._cb;this._cb=null,D(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};m()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>O)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(m=>{this._pc.removeTrack(m),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(m){this.destroyed||(m.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:m.candidate.candidate,sdpMLineIndex:m.candidate.sdpMLineIndex,sdpMid:m.candidate.sdpMid}}):!m.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),m.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(m){if(this.destroyed)return;let _=m.data;_ instanceof ArrayBuffer&&(_=v.from(_)),this.push(_)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const m=this._cb;this._cb=null,m(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(m){this.destroyed||m.streams.forEach(_=>{this._debug("on track"),this.emit("track",m.track,_),this._remoteTracks.push({track:m.track,stream:_}),this._remoteStreams.some(C=>C.id===_.id)||(this._remoteStreams.push(_),y(()=>{this._debug("on stream"),this.emit("stream",_)}))})}_debug(){const m=[].slice.call(arguments);m[0]="["+this._id+"] "+m[0],g.apply(null,m)}}T.WEBRTC_SUPPORT=!!p(),T.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},T.channelConfig={},a.exports=T},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})})(jo);var Eh=jo.exports;const kh=ea(Eh),Ai=0,Ti=1,Bo=2,Po=(e,t)=>{q(e,Ai);const n=pu(t);at(e,n)},Vo=(e,t,n)=>{q(e,Ti),at(e,hu(t,n))},Rh=(e,t,n)=>Vo(t,n,bt(e)),Wo=(e,t,n)=>{try{cu(t,bt(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Dh=(e,t)=>{q(e,Bo),at(e,t)},Ah=Wo,Th=(e,t,n,r)=>{const s=$(e);switch(s){case Ai:Rh(e,t,n);break;case Ti:Wo(e,n,r);break;case Bo:Ah(e,n,r);break;default:throw new Error("Unknown message type")}return s},Fr=3e4;class xh extends dr{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=de();this.getLocalState()!==null&&Fr/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((s,o)=>{o!==this.clientID&&Fr<=n-s.lastUpdated&&this.states.has(o)&&r.push(o)}),r.length>0&&Xr(this,r,"timeout")},ee(Fr/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const n=this.clientID,r=this.meta.get(n),s=r===void 0?0:r.clock+1,o=this.states.get(n);t===null?this.states.delete(n):this.states.set(n,t),this.meta.set(n,{clock:s,lastUpdated:de()});const a=[],c=[],l=[],g=[];t===null?g.push(n):o==null?t!=null&&a.push(n):(c.push(n),ln(o,t)||l.push(n)),(a.length>0||l.length>0||g.length>0)&&this.emit("change",[{added:a,updated:l,removed:g},"local"]),this.emit("update",[{added:a,updated:c,removed:g},"local"])}setLocalStateField(t,n){const r=this.getLocalState();r!==null&&this.setLocalState({...r,[t]:n})}getStates(){return this.states}}const Xr=(e,t,n)=>{const r=[];for(let s=0;s<t.length;s++){const o=t[s];if(e.states.has(o)){if(e.states.delete(o),o===e.clientID){const a=e.meta.get(o);e.meta.set(o,{clock:a.clock+1,lastUpdated:de()})}r.push(o)}}r.length>0&&(e.emit("change",[{added:[],updated:[],removed:r},n]),e.emit("update",[{added:[],updated:[],removed:r},n]))},sr=(e,t,n=e.states)=>{const r=t.length,s=wt();q(s,r);for(let o=0;o<r;o++){const a=t[o],c=n.get(a)||null,l=e.meta.get(a).clock;q(s,a),q(s,l),Zt(s,JSON.stringify(c))}return ot(s)},Oh=(e,t,n)=>{const r=oe(t),s=de(),o=[],a=[],c=[],l=[],g=$(r);for(let p=0;p<g;p++){const h=$(r);let f=$(r);const y=JSON.parse(he(r)),b=e.meta.get(h),v=e.states.get(h),O=b===void 0?0:b.clock;(O<f||O===f&&y===null&&e.states.has(h))&&(y===null?h===e.clientID&&e.getLocalState()!=null?f++:e.states.delete(h):e.states.set(h,y),e.meta.set(h,{clock:f,lastUpdated:s}),b===void 0&&y!==null?o.push(h):b!==void 0&&y===null?l.push(h):y!==null&&(ln(y,v)||c.push(h),a.push(h)))}(o.length>0||c.length>0||l.length>0)&&e.emit("change",[{added:o,updated:c,removed:l},n]),(o.length>0||a.length>0||l.length>0)&&e.emit("update",[{added:o,updated:a,removed:l},n])},Lh=(e,t)=>{const n=zr(e).buffer,r=zr(t).buffer;return crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]).then(s=>crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},qo=(e,t)=>{if(!t)return hi(e);const n=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e).then(r=>{const s=wt();return Zt(s,"AES-GCM"),at(s,n),at(s,new Uint8Array(r)),ot(s)})},Ih=(e,t)=>{const n=wt();return We(n,e),qo(ot(n),t)},zo=(e,t)=>{if(!t)return hi(e);const n=oe(e);he(n)!=="AES-GCM"&&ml(ne("Unknown encryption algorithm"));const s=bt(n),o=bt(n);return crypto.subtle.decrypt({name:"AES-GCM",iv:s},t,o).then(a=>new Uint8Array(a))},Mh=(e,t)=>zo(e,t).then(n=>qe(oe(new Uint8Array(n)))),Wt=Gl("y-webrtc"),Ve=0,Ho=3,vn=1,xi=4,or=new Map,De=new Map,Yo=e=>{let t=!0;e.webrtcConns.forEach(n=>{n.synced||(t=!1)}),(!t&&e.synced||t&&!e.synced)&&(e.synced=t,e.provider.emit("synced",[{synced:t}]),Wt("synced ",Ft,e.name,xe," with all peers"))},$o=(e,t,n)=>{const r=oe(t),s=wt(),o=$(r);if(e===void 0)return null;const a=e.awareness,c=e.doc;let l=!1;switch(o){case Ve:{q(s,Ve);const g=Th(r,s,c,e);g===Ti&&!e.synced&&n(),g===Ai&&(l=!0);break}case Ho:q(s,vn),at(s,sr(a,Array.from(a.getStates().keys()))),l=!0;break;case vn:Oh(a,bt(r),e);break;case xi:{const g=Te(r)===1,p=he(r);if(p!==e.peerId&&(e.bcConns.has(p)&&!g||!e.bcConns.has(p)&&g)){const h=[],f=[];g?(e.bcConns.add(p),f.push(p)):(e.bcConns.delete(p),h.push(p)),e.provider.emit("peers",[{added:f,removed:h,webrtcPeers:Array.from(e.webrtcConns.keys()),bcPeers:Array.from(e.bcConns)}]),Ko(e)}break}default:return console.error("Unable to compute message"),s}return l?s:null},Nh=(e,t)=>{const n=e.room;return Wt("received message from ",Ft,e.remotePeerId,gi," (",n.name,")",xe,yr),$o(n,t,()=>{e.synced=!0,Wt("synced ",Ft,n.name,xe," with ",Ft,e.remotePeerId),Yo(n)})},jr=(e,t)=>{Wt("send message to ",Ft,e.remotePeerId,xe,gi," (",e.room.name,")",yr);try{e.peer.send(ot(t))}catch{}},Uh=(e,t)=>{Wt("broadcast message in ",Ft,e.name,xe),e.webrtcConns.forEach(n=>{try{n.peer.send(t)}catch{}})};class ps{constructor(t,n,r,s){Wt("establishing connection to ",Ft,r),this.room=s,this.remotePeerId=r,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new kh({initiator:n,...s.provider.peerOpts}),this.peer.on("signal",o=>{Oi(t,s,{to:r,from:s.peerId,type:"signal",signal:o})}),this.peer.on("connect",()=>{Wt("connected to ",Ft,r),this.connected=!0;const a=s.provider.doc,c=s.awareness,l=wt();q(l,Ve),Po(l,a),jr(this,l);const g=c.getStates();if(g.size>0){const p=wt();q(p,vn),at(p,sr(c,Array.from(g.keys()))),jr(this,p)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,s.webrtcConns.has(this.remotePeerId)&&(s.webrtcConns.delete(this.remotePeerId),s.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(s.webrtcConns.keys()),bcPeers:Array.from(s.bcConns)}])),Yo(s),this.peer.destroy(),Wt("closed connection to ",Ft,r),Zr(s)}),this.peer.on("error",o=>{Wt("Error in connection to ",Ft,r,": ",o),Zr(s)}),this.peer.on("data",o=>{const a=Nh(this,o);a!==null&&jr(this,a)})}destroy(){this.peer.destroy()}}const ve=(e,t)=>qo(t,e.key).then(n=>e.mux(()=>Ch(e.name,n))),ys=(e,t)=>{e.bcconnected&&ve(e,t),Uh(e,t)},Zr=e=>{or.forEach(t=>{t.connected&&(t.send({type:"subscribe",topics:[e.name]}),e.webrtcConns.size<e.provider.maxConns&&Oi(t,e,{type:"announce",from:e.peerId}))})},Ko=e=>{if(e.provider.filterBcConns){const t=wt();q(t,xi),pn(t,1),Zt(t,e.peerId),ve(e,ot(t))}};class Fh{constructor(t,n,r,s){this.peerId=Vs(),this.doc=t,this.awareness=n.awareness,this.provider=n,this.synced=!1,this.name=r,this.key=s,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=Sh(),this.bcconnected=!1,this._bcSubscriber=o=>zo(new Uint8Array(o),s).then(a=>this.mux(()=>{const c=$o(this,a,()=>{});c&&ve(this,ot(c))})),this._docUpdateHandler=(o,a)=>{const c=wt();q(c,Ve),Dh(c,o),ys(this,ot(c))},this._awarenessUpdateHandler=({added:o,updated:a,removed:c},l)=>{const g=o.concat(a).concat(c),p=wt();q(p,vn),at(p,sr(this.awareness,g)),ys(this,ot(p))},this._beforeUnloadHandler=()=>{Xr(this.awareness,[t.clientID],"window unload"),De.forEach(o=>{o.disconnect()})},typeof window<"u"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),Zr(this);const t=this.name;vh(t,this._bcSubscriber),this.bcconnected=!0,Ko(this);const n=wt();q(n,Ve),Po(n,this.doc),ve(this,ot(n));const r=wt();q(r,Ve),Vo(r,this.doc),ve(this,ot(r));const s=wt();q(s,Ho),ve(this,ot(s));const o=wt();q(o,vn),at(o,sr(this.awareness,[this.doc.clientID])),ve(this,ot(o))}disconnect(){or.forEach(n=>{n.connected&&n.send({type:"unsubscribe",topics:[this.name]})}),Xr(this.awareness,[this.doc.clientID],"disconnect");const t=wt();q(t,xi),pn(t,0),Zt(t,this.peerId),ve(this,ot(t)),_h(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(n=>n.destroy())}destroy(){this.disconnect(),typeof window<"u"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.off("exit",this._beforeUnloadHandler)}}const jh=(e,t,n,r)=>{if(De.has(n))throw ne(`A Yjs Doc connected to room "${n}" already exists!`);const s=new Fh(e,t,n,r);return De.set(n,s),s},Oi=(e,t,n)=>{t.key?Ih(n,t.key).then(r=>{e.send({type:"publish",topic:t.name,data:$s(r)})}):e.send({type:"publish",topic:t.name,data:n})};class Bh extends bh{constructor(t){super(t),this.providers=new Set,this.on("connect",()=>{Wt(`connected (${t})`);const n=Array.from(De.keys());this.send({type:"subscribe",topics:n}),De.forEach(r=>Oi(this,r,{type:"announce",from:r.peerId}))}),this.on("message",n=>{switch(n.type){case"publish":{const r=n.topic,s=De.get(r);if(s==null||typeof r!="string")return;const o=a=>{const c=s.webrtcConns,l=s.peerId;if(a==null||a.from===l||a.to!==void 0&&a.to!==l||s.bcConns.has(a.from))return;const g=c.has(a.from)?()=>{}:()=>s.provider.emit("peers",[{removed:[],added:[a.from],webrtcPeers:Array.from(s.webrtcConns.keys()),bcPeers:Array.from(s.bcConns)}]);switch(a.type){case"announce":c.size<s.provider.maxConns&&(jt(c,a.from,()=>new ps(this,!0,a.from,s)),g());break;case"signal":a.to===l&&(jt(c,a.from,()=>new ps(this,!1,a.from,s)).peer.signal(a.signal),g());break}};s.key?typeof n.data=="string"&&Mh(Ks(n.data),s.key).then(o):o(n.data)}}}),this.on("disconnect",()=>Wt(`disconnect (${t})`))}}class Ph extends dr{constructor(t,n,{signaling:r=["wss://y-webrtc-eu.fly.dev"],password:s=null,awareness:o=new xh(n),maxConns:a=20+ee(yl()*15),filterBcConns:c=!0,peerOpts:l={}}={}){super(),this.roomName=t,this.doc=n,this.filterBcConns=c,this.awareness=o,this.shouldConnect=!1,this.signalingUrls=r,this.signalingConns=[],this.maxConns=a,this.peerOpts=l,this.key=s?Lh(s,t):hi(null),this.room=null,this.key.then(g=>{this.room=jh(n,this,t,g),this.shouldConnect?this.room.connect():this.room.disconnect()}),this.connect(),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(t=>{const n=jt(or,t,()=>new Bh(t));this.signalingConns.push(n),n.providers.add(this)}),this.room&&this.room.connect()}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(t=>{t.providers.delete(this),t.providers.size===0&&(t.destroy(),or.delete(t.url))}),this.room&&this.room.disconnect()}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),De.delete(this.roomName)}),super.destroy()}}const Jo=F.createContext(void 0);function Vh(e){const{children:t}=e,n=F.useRef(new Xe),r=F.useRef(),s=F.useRef({getTableSyncState:a});F.useEffect(()=>{const l={name:"my room",password:"abc",playerName:"some guy"},g=n.current,p={signaling:[],password:l.password},h=new Ph(l.name,g,p);h.awareness.on("update",o);const f={name:l.playerName};return h.awareness.setLocalState(f),r.current=h.awareness,()=>{h.destroy()}},[]);function o(){}function a(c){return n.current.getMap(c)}return ct.jsx(Jo.Provider,{value:s.current,children:t})}const Go=F.createContext(void 0),Wh=F.forwardRef((e,t)=>{const{id:n,children:r}=e,s=F.useContext(Jo),o=F.useRef(),a={registerPile:c,unregisterPile:l,registerDragEvent:g};F.useImperativeHandle(t,()=>a),F.useEffect(()=>{s&&(o.current=s.getTableSyncState(n),console.log(n,o.current))},[n]);function c(p){}function l(p){}function g(p){p.type!=="move"&&(p.type,console.log(`drag ${p.type}`,p,o.current))}return ct.jsx(Go.Provider,{value:a,children:r})});function qh(e){const{id:t,children:n,style:r}=e,s=F.useRef(null);function o(g){const p=g.active.id.toString(),h=g.active.data.current,{over:f,delta:y}=g;return{delta:y,card:{...h,id:p},sourcePile:h.parentPile,targetPile:f?f.id.toString():void 0}}function a(g){if(!s.current)return;const p=o(g);p&&s.current.registerDragEvent({type:"start",...p})}function c(g){if(!s.current)return;const p=o(g);p&&s.current.registerDragEvent({type:"move",...p})}function l(g){if(!s.current)return;const p=o(g);p&&s.current.registerDragEvent({type:"end",...p})}return ct.jsx("div",{className:"table",style:r,children:ct.jsxs(pc,{onDragStart:a,onDragMove:c,onDragEnd:l,children:[ct.jsx(Vh,{children:ct.jsx(Wh,{id:t,ref:s,children:n})}),ct.jsx(Nc,{children:"overlay"})]})})}function zh(e){let t=1779033703,n=3144134277,r=1013904242,s=2773480762;for(let o=0,a;o<e.length;o++)a=e.charCodeAt(o),t=n^Math.imul(t^a,597399067),n=r^Math.imul(n^a,2869860233),r=s^Math.imul(r^a,951274213),s=t^Math.imul(s^a,2716044179);return t=Math.imul(r^t>>>18,597399067),n=Math.imul(s^n>>>22,2869860233),r=Math.imul(t^r>>>17,951274213),s=Math.imul(n^s>>>19,2716044179),[(t^n^r^s)>>>0,(n^t)>>>0,(r^t)>>>0,(s^t)>>>0]}function Hh(e,t,n,r){return function(){e>>>=0,t>>>=0,n>>>=0,r>>>=0;let s=e+t|0;return e=t^t>>>9,t=n+(n<<3)|0,n=n<<21|n>>>11,r=r+1|0,s=s+r|0,n=n+s|0,(s>>>0)/4294967296}}function Yh(e,t="seed"){const n=zh(t),r=Hh(...n);return Xt.map(Xt.range(0,e),()=>r())}function Xo(e){const{id:t,children:n,offset:r,rotation:s,style:o}=e,a=1.1,{isDragging:c,attributes:l,listeners:g,transform:p,setNodeRef:h}=mc({id:t,data:e}),[f,y]=F.useState(!1),[b]=na(()=>{const[O,T]=r||[0,0],I=Xt.chain([p?`translate3d(${p.x+O}px, ${p.y+T}px, 0px)`:`translate3d(${O}px, ${T}px, 0px)`,c?`scaleX(${a}) scaleY(${a})`:"scaleX(1) scaleY(1)",Xt.isNumber(s)?`rotate(${s}deg)`:"rotate(0deg)"]).compact().join(" ").value();return{config:{mass:2,tension:600,friction:50},transform:I,onStart:()=>y(!0),onRest:()=>y(!1)}},[p,c,r,s]),v=Xt.chain(["card",c||f?"dragging":void 0]).compact().join(" ").value();return ct.jsxs(ra.div,{ref:h,className:v,style:o?{...b,...o}:b,...g,...l,children:[ct.jsx("div",{className:"back"}),ct.jsx("div",{className:"front",children:n})]})}function Un(e){const{id:t,cards:n,cardOffset:r,cardMess:s,style:o}=e,a=[0,20],c=10,{isOver:l,setNodeRef:g}=Cc({id:t}),[p,h]=F.useState([]),[f,y]=F.useState([]),b=F.useContext(Go),v={rotations:`${t}.rotations`};F.useEffect(()=>{if(b)return b.registerPile(e),()=>{b.unregisterPile(e)}},[]),F.useEffect(()=>{const T=Xt.map(Yh((n==null?void 0:n.length)||0,v.rotations),m=>(m*2-1)*(s||c));y(T);const I=Xt.chain(n).map((m,_)=>Xt.chain([m.offset,r!==void 0?[r[0]*_,r[1]*_]:void 0,[a[0]*_,a[1]*_]]).compact().first().value()).value();h(I)},[t,n,r,s]);const O=Xt.chain(["pile",l?"active":void 0]).compact().join(" ").value();return ct.jsx(ct.Fragment,{children:ct.jsx("div",{ref:g,className:O,style:o,children:n?n.map((T,I)=>{const m=p[I]||[0,0],_=T.rotation||Xt.get(f,I)||0;return ct.jsx(Xo,{...T,parentPile:t,offset:m,rotation:_,style:{position:"absolute",top:"1em",left:"1em"}},T.id)}):null})})}function Jh(){return ct.jsx("div",{className:"route cards",children:ct.jsxs(qh,{id:"skitgubbe",style:{display:"grid",gap:"0.5em",aspectRatio:"16/9",width:"auto",height:"100%",maxWidth:"100%",alignItems:"center",justifyContent:"center"},children:[ct.jsx(Un,{id:"pile-1",style:{gridRow:1},cards:[{id:"card-3",children:"C"},{id:"card-4",children:"D"},{id:"card-5",children:"E"},{id:"card-6",children:"F"}]}),ct.jsx(Un,{id:"pile-main",style:{gridRow:2}}),ct.jsx(Xo,{id:"card-1",style:{gridRow:1},children:"A"}),ct.jsx(Un,{id:"pile-2",style:{gridRow:3},cards:[{id:"card-7",children:"G"}]}),ct.jsx(Un,{id:"pile-3",style:{gridRow:3}})]})})}export{Jh as RouteCards,Jh as default};

var k=(o,t,i)=>{if(!t.has(o))throw TypeError("Cannot "+i)};var u=(o,t,i)=>(k(o,t,"read from private field"),i?i.call(o):t.get(o)),z=(o,t,i)=>{if(t.has(o))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(o):t.set(o,i)},C=(o,t,i,e)=>(k(o,t,"write to private field"),e?e.call(o,i):t.set(o,i),i);var A=(o,t,i)=>(k(o,t,"access private method"),i);import{r as M,j as R,n as V}from"./index-NepP2luA.js";import{S as _,C as L,G as T,V as E,u as G,b as W}from"./index-cGRZym6M.js";import"./react-spring_web.modern-nqxZiJqR.js";import{C as Y}from"./index-aWCdcJU0.js";var S,c,O,I;class q extends T{constructor(i,e){super(i);z(this,O);z(this,S,void 0);z(this,c,void 0);C(this,c,e.density),C(this,S,u(this,c))}get density(){return u(this,c)}add(i){C(this,c,u(this,c)+i),this.grid.registerChanged(this)}step(i){A(this,O,I).call(this,20,i),C(this,S,u(this,c))}getRGBA(){return[255,0,100,Math.min(u(this,c),1)*255]}}S=new WeakMap,c=new WeakMap,O=new WeakSet,I=function(i,e){const n=e*i*this.grid.size.x*this.grid.size.y,s=this.dir.N(),h=this.dir.E(),a=this.dir.S(),d=this.dir.W();C(this,c,(u(this,S)+n*(((d==null?void 0:d.density)||0)+((h==null?void 0:h.density)||0)+((s==null?void 0:s.density)||0)+((a==null?void 0:a.density)||0)))/(1+4*n)),C(this,c,u(this,c)*.99),u(this,c)<1e-6&&C(this,c,0),Math.abs(u(this,S)-u(this,c))>1e-6&&(this.grid.registerChanged(this),this.grid.registerChanged(s),this.grid.registerChanged(h),this.grid.registerChanged(a),this.grid.registerChanged(d))};class H extends _{createGrid(t){return new L({...t,createEmpty:i=>new q(i,{density:0})})}set_bnd(t,i,e){const n=this.grid.xy2index;for(let s=1;s<=t;s++)e[n(0,s)]=i==1?-e[n(1,s)]:e[n(1,s)],e[n(t+1,s)]=i==1?-e[n(t,s)]:e[n(t,s)],e[n(s,0)]=i==2?-e[n(s,1)]:e[n(s,1)],e[n(s,t+1)]=i==2?-e[n(s,t)]:e[n(s,t)];e[n(0,0)]=.5*(e[n(1,0)]+e[n(0,1)]),e[n(0,t+1)]=.5*(e[n(1,t+1)]+e[n(0,t)]),e[n(t+1,0)]=.5*(e[n(t,0)]+e[n(t+1,1)]),e[n(t+1,t+1)]=.5*(e[n(t,t+1)]+e[n(t+1,t)])}advect(t,i,e,n,s,h){const a=this.grid.size.y,d=this.grid.xy2index;let l,f,P,j,w,b,D;D=h*a;for(let g=1;g<=a;g++)for(let p=1;p<=a;p++){l=g-D*n[d(g,p)],f=p-D*s[d(g,p)],l<.5&&(l=.5),l>a+.5&&(l=a+.5);const v=l,r=v+1;f<.5&&(f=.5),f>a+.5&&(f=a+.5);const m=f,y=m+1;w=l-v,P=1-w,b=f-m,j=1-b,i[d(g,p)]=P*(j*e[d(v,m)]+b*e[d(v,y)])+w*(j*e[d(r,m)]+b*e[d(r,y)])}this.set_bnd(a,t,i)}step(t){this.grid.forEachChangedChunkPass(i=>{i.forEach(e=>{e.haveChanges()&&e.forEachDirty(n=>{n.step(t)},{alternateRowDirections:!0,resetChanges:!0})})},!1)}}function N(){const o=E.create(256,192),t=M.useRef(null),i=M.useRef(void 0),[e,n]=M.useState(!1),[s,h]=G(void 0),[a,d]=G(E.create(0,0)),[l,f]=M.useState({debugDraw:e});M.useEffect(()=>{f(r=>({...r,debugDraw:e}))},[e]);function P(){const r=new H({gridOptions:{size:o}});return r.clear(),r}function j(r){r.preventDefault()}function w(){h("add")}function b(){h(void 0),i.current=void 0}function D(r){const m=r.target,{x:y,y:F,width:X,height:x}=m.getBoundingClientRect(),B=E.create(y,F),U=E.create(X,x);d(E.create(r.clientX,r.clientY).subtract(B).divide(U).multiply(o).floor())}function g({grid:r}){p(r)}function p(r){if(s.current===void 0)return;(i.current?r.getCellsInLine(i.current,a.current,{excludeStart:!0}):[r.getAtPosition(a.current)]).forEach(y=>{y&&s.current==="add"&&y.add(4)}),i.current=a.current}function v(){var r;(r=t.current)==null||r.clear()}return R.jsxs("div",{className:"route fluid",children:[R.jsxs("div",{style:{position:"absolute",top:0,width:"100%",display:"flex",justifyContent:"space-between",background:"black",color:"white",zIndex:100},children:[R.jsxs("button",{onClick:()=>v(),children:[R.jsx(V,{}),"reset"]}),R.jsx(Y,{id:"debugDraw",checked:e,onChange:n})]}),R.jsx(W,{ref:t,renderOptions:l,resetChanges:!1,initSimulation:P,onStep:g,onPointerDown:w,onPointerUp:b,onPointerMove:D,onContextMenu:j})]})}export{N as default};

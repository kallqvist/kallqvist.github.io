var v=Object.defineProperty;var P=(r,t,e)=>t in r?v(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var x=(r,t,e)=>(P(r,typeof t!="symbol"?t+"":t,e),e),W=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var w=(r,t,e)=>(W(r,t,"read from private field"),e?e.call(r):t.get(r)),S=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},A=(r,t,e,i)=>(W(r,t,"write to private field"),i?i.call(r,e):t.set(r,e),e);import{r as p,j as C}from"./index-qhoyzipu.js";function D(r){const[t,e]=p.useState(r),i=p.useRef(t);return[i,s=>{s instanceof Function?(i.current=s(i.current),e(s)):(i.current=s,e(s))}]}class k{constructor(t){x(this,"grid");x(this,"index");x(this,"position");x(this,"dir",{NW:()=>this.getNeighbourInDirection(h.NW),N:()=>this.getNeighbourInDirection(h.N),NE:()=>this.getNeighbourInDirection(h.NE),E:()=>this.getNeighbourInDirection(h.E),SE:()=>this.getNeighbourInDirection(h.SE),S:()=>this.getNeighbourInDirection(h.S),SW:()=>this.getNeighbourInDirection(h.SW),W:()=>this.getNeighbourInDirection(h.W)});this.grid=t,this.index=-1,this.position=new n(0,0)}getNeighbourInDirection(t){if(this.position)return this.grid.getAtPosition(this.position.add(t))}getNeighbourhood(){const t=[];return F.forEach(e=>{const i=this.getNeighbourInDirection(e);t.push(i)}),t}getLineTo(t,e){return this.grid.getPositionsInLine(this.position,t,e)}swapWith(t){this.grid.swap(this,t)}getRGBA(){return[0,0,0,0]}}var m,E;class L{constructor(t){x(this,"width");x(this,"height");x(this,"alternateRows");x(this,"createEmpty");S(this,m,void 0);S(this,E,void 0);const{width:e,height:i,alternateRows:a,createEmpty:s}={alternateRows:!1,...t};A(this,m,[]),A(this,E,new Set([])),this.width=e,this.height=i,this.alternateRows=a,this.createEmpty=s,this.clear()}clear(){for(let t=0;t<this.width*this.height;t++)this.setAtIndex(t,this.createEmpty(this))}indexOf(t){return t?t.index:-1}positionOf(t){if(t)return t.position}forEach(t,e){const{alternateRows:i}=e||{},a=new Set,s=w(this,m);let f=(d,u)=>{const o=this.position2index(new n(d,u)),g=s[o];if(!g||a.has(g))return;if(t(g,o)===!1)return!1;a.add(g)};for(let d=0;d<this.height;d++){let u;if(i&&d%2===0&&Math.random()<.5){for(let o=this.width-1;o>=0&&(u=f(o,d),u!==!1);o--);if(u===!1)break;continue}for(let o=0;o<this.width&&(u=f(o,d),u!==!1);o++);if(u===!1)break}}map(t){return w(this,m).map(t)}forEachChanged(t,e=!0){w(this,E).forEach(i=>t(i)),e&&w(this,E).clear()}position2index(t){const{x:e,y:i}=t;return e<0||e>=this.width||i<0||i>=this.height?-1:e+i*this.width}index2position(t){let e=Math.floor(t/this.width),i=t-e*this.width;return new n(i,e)}get(t){return this.getAtPosition(t)}set(t,e){this.setAtPosition(t,e)}getPositionsInLine(t,e,i){const{excludeStart:a,excludeEnd:s}=i||{},f=e.x-t.x,d=e.y-t.y;if(f===0&&d===0)return[t];const u=f<0?-1:1,o=d<0?-1:1,g=Math.abs(f),N=Math.abs(d),I=g>=N,b=Math.min(g,N),c=Math.max(g,N),l=b/c,y=[];for(let R=a?1:0;R<(s?c:c+1);R++){const M=Math.round(R*l);I?y.push(new n(t.x+R*u,t.y+M*o)):y.push(new n(t.x+M*u,t.y+R*o))}return y}getAtPosition(t){const e=this.position2index(t);if(e!==-1)return this.getAtIndex(e)}setAtPosition(t,e){const i=this.position2index(t);this.setAtIndex(i,e)}getAtIndex(t){return w(this,m)[t]}registerChanged(t){w(this,E).add(t)}swap(t,e){const i=this.indexOf(t),a=this.indexOf(e),s=w(this,m)[i];this.setAtIndex(i,w(this,m)[a]),this.setAtIndex(a,s)}setAtIndex(t,e){e.index=t,e.position=this.index2position(t),w(this,m)[t]=e,this.registerChanged(e)}}m=new WeakMap,E=new WeakMap;class n{constructor(t,e){x(this,"x");x(this,"y");this.x=t,this.y=e}clone(){return new n(this.x,this.y)}add(t){return new n(this.x+t.x,this.y+t.y)}multiply(t){return new n(this.x*t.x,this.y*t.y)}multiplyScalar(t){return new n(this.x*t,this.y*t)}divide(t){return new n(this.x/t.x,this.y/t.y)}divideScalar(t){return new n(this.x/t,this.y/t)}round(){return new n(Math.round(this.x),Math.round(this.y))}floor(){return new n(Math.floor(this.x),Math.floor(this.y))}ceil(){return new n(Math.ceil(this.x),Math.ceil(this.y))}static zero(){return new n(0,0)}static one(){return new n(1,1)}static up(){return new n(0,-1)}static down(){return new n(0,1)}static left(){return new n(-1,0)}static right(){return new n(-1,0)}static random(){return new n(Math.random(),Math.random())}}const h={NW:new n(-1,-1),N:new n(0,-1),NE:new n(1,-1),E:new n(1,0),SE:new n(1,1),S:new n(0,1),SW:new n(-1,1),W:new n(-1,0)},F=[h.NW,h.N,h.NE,h.W,h.E,h.SW,h.S,h.SE];function O(r){const{grid:t,pickColor:e,...i}=r,a=p.useRef(),s=p.useRef(null),f=p.useRef(),[d,u]=D(!0);p.useEffect(()=>(a.current=requestAnimationFrame(I),()=>{a.current!==void 0&&cancelAnimationFrame(a.current)}),[]),p.useEffect(()=>{t&&(u(!0),N(),I())},[t]);function o(){return s.current?s.current.getContext("2d"):null}function g(){if(f.current)return f.current;if(!t)return;const c=o();if(c)return f.current=c.createImageData(t.width,t.height),f.current}function N(){const c=g();c&&(c.data.fill(0),u(!0))}function I(){if(!t)return;const c=o();if(!c)return;const l=g();l&&(d.current===!0?t.forEach(y=>b(l,y)):t.forEachChanged(y=>b(l,y)),c.putImageData(l,0,0),u(!1),a.current=requestAnimationFrame(I))}function b(c,l){l.index!==-1&&t&&c.data.set(e?e(l):l.getRGBA(),l.index*4)}return t?C.jsx("div",{className:"grid canvas",children:C.jsx("canvas",{ref:s,width:t.width,height:t.height,...i})}):null}export{k as G,n as V,L as a,O as b,F as n,D as u};

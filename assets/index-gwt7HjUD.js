var O=Object.defineProperty;var j=(n,t,e)=>t in n?O(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var u=(n,t,e)=>(j(n,typeof t!="symbol"?t+"":t,e),e),W=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var d=(n,t,e)=>(W(n,t,"read from private field"),e?e.call(n):t.get(n)),A=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},R=(n,t,e,i)=>(W(n,t,"write to private field"),i?i.call(n,e):t.set(n,e),e);import{r as N,j as M}from"./index-Tp3dEnl-.js";function P(n){const[t,e]=N.useState(n),i=N.useRef(t);return[i,r=>{r instanceof Function?(i.current=r(i.current),e(r)):(i.current=r,e(r))}]}var I;class k{constructor(t,e){u(this,"empty",!1);u(this,"grid");A(this,I,!1);u(this,"index");u(this,"position");u(this,"color");u(this,"dir",{NW:()=>this.getNeighbourInDirection(o.NW),N:()=>this.getNeighbourInDirection(o.N),NE:()=>this.getNeighbourInDirection(o.NE),E:()=>this.getNeighbourInDirection(o.E),SE:()=>this.getNeighbourInDirection(o.SE),S:()=>this.getNeighbourInDirection(o.S),SW:()=>this.getNeighbourInDirection(o.SW),W:()=>this.getNeighbourInDirection(o.W)});const{isEmpty:i}={...e};this.grid=t,this.empty=i||!1,this.index=-1,this.color=this.getRGBA()}isSleeping(){return d(this,I)}sleep(){R(this,I,!0),this.grid.registerChanged(this)}awake(){R(this,I,!1),this.grid.registerChanged(this)}getPosition(){return this.grid.positionOf(this)}getNeighbourInDirection(t){if(this.position)return this.grid.getAtPosition(this.position.add(t))}getNeighbourhood(){const t=[];return G.forEach(e=>{const i=this.getNeighbourInDirection(e);i&&t.push(i)}),t}swapWith(t){this.grid.swap(this,t)}getRGBA(){return this.color?this.color:this.empty?[0,0,0,0]:[255,255,255,255]}}I=new WeakMap;var x,y;class z{constructor(t){u(this,"width");u(this,"height");u(this,"alternateRows");u(this,"createEmpty");A(this,x,void 0);A(this,y,void 0);const{width:e,height:i,alternateRows:f,createEmpty:r}={alternateRows:!1,...t};R(this,x,[]),R(this,y,new Set([])),this.width=e,this.height=i,this.alternateRows=f,this.createEmpty=r,this.clear()}clear(){for(let t=0;t<this.width*this.height;t++)this.setAtIndex(t,this.createEmpty(this))}indexOf(t){return t?t.index:-1}positionOf(t){if(t)return t.position}forEach(t,e){const{alternateRows:i,freeze:f}=e||{},r=new Set,w=f?d(this,x).map(s=>Object.assign(Object.create(Object.getPrototypeOf(s)),s)):d(this,x);let m=(s,h)=>{const p=this.position2index(new c(s,h)),g=w[p];!g||r.has(g)||t(g,p)===!1||r.add(g)};for(let s=0;s<this.height;s++){if(i&&s%2===0&&Math.random()<.5){for(let h=this.width-1;h>=0;h--)m(h,s);continue}for(let h=0;h<this.width;h++)m(h,s)}}map(t){return d(this,x).map(t)}forEachChanged(t,e=!0){d(this,y).forEach(i=>t(i)),e&&d(this,y).clear()}position2index(t){const{x:e,y:i}=t;return e<0||e>=this.width||i<0||i>=this.height?-1:e+i*this.width}index2position(t){let e=Math.floor(t/this.width),i=t-e*this.width;return new c(i,e)}get(t){return this.getAtPosition(t)}set(t,e){this.setAtPosition(t,e)}getPositionsInLine(t,e,i){const{excludeStart:f,excludeEnd:r}=i||{},w=e.x-t.x,m=e.y-t.y;if(w===0&&m===0)return[t];const s=w<0?-1:1,h=m<0?-1:1,p=Math.abs(w),g=Math.abs(m),D=p>=g,S=Math.min(p,g),a=Math.max(p,g),l=S/a,E=[];for(let b=f?1:0;b<(r?a:a+1);b++){const C=Math.round(b*l);D?E.push(new c(t.x+b*s,t.y+C*h)):E.push(new c(t.x+C*s,t.y+b*h))}return E}getAtPosition(t){const e=this.position2index(t);if(e!==-1)return this.getAtIndex(e)}setAtPosition(t,e){const i=this.position2index(t);this.setAtIndex(i,e)}getAtIndex(t){return d(this,x)[t]}registerChanged(t){d(this,y).add(t)}swap(t,e){const i=this.indexOf(t),f=this.indexOf(e),r=d(this,x)[i];this.setAtIndex(i,d(this,x)[f]),this.setAtIndex(f,r)}setAtIndex(t,e){e.index=t,e.position=this.index2position(t),d(this,x)[t]=e,e.awake(),this.registerChanged(e)}}x=new WeakMap,y=new WeakMap;class c{constructor(t,e){u(this,"x");u(this,"y");this.x=t,this.y=e}add(t){return new c(this.x+t.x,this.y+t.y)}}const o={NW:new c(-1,-1),N:new c(0,-1),NE:new c(1,-1),E:new c(1,0),SE:new c(1,1),S:new c(0,1),SW:new c(-1,1),W:new c(-1,0)},G=[o.NW,o.N,o.NE,o.W,o.E,o.SW,o.S,o.SE],B=N.forwardRef((n,t)=>{const{grid:e,debugDraw:i,...f}=n,r=N.useRef(null),w=N.useRef(),[m,s]=P(!0);N.useImperativeHandle(t,()=>({clear:g,render:D})),N.useEffect(()=>{e&&(s(!0),g(),D())},[e]);function h(){return r.current?r.current.getContext("2d"):null}function p(){if(w.current)return w.current;if(!e)return;const a=h();if(a)return w.current=a.createImageData(e.width,e.height),w.current}function g(){const a=p();a&&(a.data.fill(255),s(!0))}function D(){if(!e)return;const a=h();if(!a)return;const l=p();l&&(m.current===!0?e.forEach(E=>S(l,E)):e.forEachChanged(E=>S(l,E)),a.putImageData(l,0,0),s(!1))}function S(a,l){l.index!==-1&&e&&a.data.set(i&&!l.isSleeping()?[255,255,255,255]:l.color,l.index*4)}return e?M.jsx("div",{className:"grid canvas",children:M.jsx("canvas",{ref:r,width:e.width,height:e.height,...f})}):null});export{k as G,c as V,z as a,B as b,G as n,P as u};

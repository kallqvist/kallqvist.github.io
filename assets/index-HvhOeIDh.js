var Rt=Object.defineProperty;var Et=(s,t,e)=>t in s?Rt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var y=(s,t,e)=>(Et(s,typeof t!="symbol"?t+"":t,e),e),ft=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var r=(s,t,e)=>(ft(s,t,"read from private field"),e?e.call(s):t.get(s)),m=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},d=(s,t,e,i)=>(ft(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e);var yt=(s,t,e,i)=>({set _(n){d(s,t,n,e)},get _(){return r(s,t,i)}}),V=(s,t,e)=>(ft(s,t,"access private method"),e);import{i as Ct,r as S,j as x,p as zt,q as At,s as Mt,t as kt,l as Nt,_ as jt}from"./index-J3dNsBoJ.js";import"./react-spring_web.modern-75KWeOyp.js";function Vt(s){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 22c4.636 0 8-3.468 8-8.246C20 7.522 12.882 2.4 12.579 2.185a1 1 0 0 0-1.156-.001C11.12 2.397 4 7.503 4 13.75 4 18.53 7.364 22 12 22zm-.001-17.74C13.604 5.55 18 9.474 18 13.754 18 17.432 15.532 20 12 20s-6-2.57-6-6.25c0-4.29 4.394-8.203 5.999-9.49z"},child:[]}]})(s)}function Dt(s){return Ct({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M5.122 21c.378.378.88.586 1.414.586S7.572 21.378 7.95 21l4.336-4.336a7.495 7.495 0 0 0 2.217.333 7.446 7.446 0 0 0 5.302-2.195 7.484 7.484 0 0 0 1.632-8.158l-.57-1.388-4.244 4.243-2.121-2.122 4.243-4.243-1.389-.571A7.478 7.478 0 0 0 14.499 2c-2.003 0-3.886.78-5.301 2.196a7.479 7.479 0 0 0-1.862 7.518L3 16.05a2.001 2.001 0 0 0 0 2.828L5.122 21zm4.548-8.791-.254-.616a5.486 5.486 0 0 1 1.196-5.983 5.46 5.46 0 0 1 4.413-1.585l-3.353 3.353 4.949 4.95 3.355-3.355a5.49 5.49 0 0 1-1.587 4.416c-1.55 1.55-3.964 2.027-5.984 1.196l-.615-.255-5.254 5.256h.001l-.001 1v-1l-2.122-2.122 5.256-5.255z"},child:[]}]})(s)}function Ft(s){const[t,e]=S.useState(s),i=S.useRef(t);return[i,h=>{h instanceof Function?(i.current=h(i.current),e(h)):(i.current=h,e(h))}]}function Pt({id:s,label:t,checked:e,onChange:i}){function n(h){i&&i(h.target.checked)}return x.jsxs("div",{children:[x.jsx("input",{id:s,type:"checkbox",checked:e,onChange:n}),t||s?x.jsx("label",{htmlFor:s,children:t||s}):void 0]})}class wt{constructor(t){y(this,"grid");y(this,"index");y(this,"position");y(this,"dir",{NW:()=>this.getNeighbourInDirection(E.NW),N:()=>this.getNeighbourInDirection(E.N),NE:()=>this.getNeighbourInDirection(E.NE),E:()=>this.getNeighbourInDirection(E.E),SE:()=>this.getNeighbourInDirection(E.SE),S:()=>this.getNeighbourInDirection(E.S),SW:()=>this.getNeighbourInDirection(E.SW),W:()=>this.getNeighbourInDirection(E.W)});this.grid=t,this.index=-1,this.position=o.create(0,0)}getNeighbourInDirection(t){if(this.position)return this.grid.getAtXY(this.position.x+t.x,this.position.y+t.y)}getNeighbourhood(){const t=[];return Tt.forEach(e=>{const i=this.getNeighbourInDirection(e);t.push(i)}),t}getLineTo(t,e){return this.grid.getCellsInLine(this.position,t,e)}swapWith(t){this.grid.swap(this,t)}getRGBA(){return[0,0,0,0]}}var Ot=function(){function s(t){this._value=NaN,typeof t=="string"?this._seed=this.hashCode(t):typeof t=="number"?this._seed=this.getSafeSeed(t):this._seed=this.getSafeSeed(s.MIN+Math.floor((s.MAX-s.MIN)*Math.random())),this.reset()}return s.prototype.next=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=1),this.recalculate(),this.map(this._value,s.MIN,s.MAX,t,e)},s.prototype.nextInt=function(t,e){return t===void 0&&(t=10),e===void 0&&(e=100),this.recalculate(),Math.floor(this.map(this._value,s.MIN,s.MAX,t,e+1))},s.prototype.nextString=function(t,e){t===void 0&&(t=16),e===void 0&&(e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");for(var i="";i.length<t;)i+=this.nextChar(e);return i},s.prototype.nextChar=function(t){return t===void 0&&(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"),t.substr(this.nextInt(0,t.length-1),1)},s.prototype.nextArrayItem=function(t){return t[this.nextInt(0,t.length-1)]},s.prototype.nextBoolean=function(){return this.recalculate(),this._value>.5},s.prototype.skip=function(t){for(t===void 0&&(t=1);t-- >0;)this.recalculate()},s.prototype.reset=function(){this._value=this._seed},s.prototype.recalculate=function(){this._value=this.xorshift(this._value)},s.prototype.xorshift=function(t){return t^=t<<13,t^=t>>17,t^=t<<5,t},s.prototype.map=function(t,e,i,n,h){return(t-e)/(i-e)*(h-n)+n},s.prototype.hashCode=function(t){var e=0;if(t)for(var i=t.length,n=0;n<i;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0,e=this.xorshift(e);return this.getSafeSeed(e)},s.prototype.getSafeSeed=function(t){return t===0?1:t},s.MIN=-2147483648,s.MAX=2147483647,s}();const Wt=new Ot,gt=()=>Wt.next();var $,T;class Gt{constructor(t,e){m(this,$,void 0);m(this,T,void 0);d(this,$,t),d(this,T,e)}set(t,e){t&&d(this,$,t),e&&d(this,T,e)}get position(){return r(this,$)}get size(){return r(this,T)}get area(){return r(this,T).x*r(this,T).y}toArray(){return[...r(this,$).toArray(),...r(this,T).toArray()]}}$=new WeakMap,T=new WeakMap;const a=class a{constructor(t=0,e=0){y(this,"x");y(this,"y");this.x=t,this.y=e}clone(){return new a(this.x,this.y)}setXY(t,e){this.x=t,this.y=e}set(t){this.x=t.x,this.y=t.y}add(t){return this.x=this.x+t.x,this.y=this.y+t.y,this}addScalar(t){return this.x=this.x+t,this.y=this.y+t,this}subtract(t=a.zero){return this.x=this.x-t.x,this.y=this.y-t.y,this}subtractScalar(t){return this.x=this.x-t,this.y=this.y-t,this}multiply(t){return this.x=this.x*t.x,this.y=this.y*t.y,this}multiplyScalar(t){return this.x=this.x*t,this.y=this.y*t,this}divide(t){return this.x=this.x/t.x,this.y=this.y/t.y,this}divideScalar(t){return this.x=this.x/t,this.y=this.y/t,this}mod(t){return this.x=this.x%t.x,this.y=this.y%t.y,this}modScalar(t){return this.x=this.x%t,this.y=this.y%t,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}frac(){return this.subtract(this.clone().floor())}normalize(){const t=this.length();return t===0?this:this.multiplyScalar(1/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}dot(t){const e=a.multiply(this,t);return e.x+e.y}isEqual(t){return this.x===t.x&&this.y===t.y}isNear(t,e=.001){const i=a.subtract(this,t).abs();return i.x<=e&&i.y<=e}isLessThan(t){return a.isLessThan(this,t)}isGreaterThan(t){return a.isGreaterThan(this,t)}toArray(){return[this.x,this.y]}join(t){return this.toArray().join(t)}static create(t=0,e=0){return new a(t,e)}static add(t,e){return new a(t.x+e.x,t.y+e.y)}static addScalar(t,e){return new a(t.x+e,t.y+e)}static subtract(t,e=a.zero){return new a(t.x-e.x,t.y-e.y)}static subtractScalar(t,e){return new a(t.x-e,t.y-e)}static multiply(t,e){return new a(t.x*e.x,t.y*e.y)}static multiplyScalar(t,e){return new a(t.x*e,t.y*e)}static divide(t,e){return new a(t.x/e.x,t.y/e.y)}static divideScalar(t,e){return new a(t.x/e,t.y/e)}static mod(t,e){return new a(t.x%e.x,t.y%e.y)}static modScalar(t,e){return new a(t.x%e,t.y%e)}static abs(t){return new a(Math.abs(t.x),Math.abs(t.y))}static round(t){return new a(Math.round(t.x),Math.round(t.y))}static floor(t){return new a(Math.floor(t.x),Math.floor(t.y))}static ceil(t){return new a(Math.ceil(t.x),Math.ceil(t.y))}static frac(t){return a.subtract(t,a.floor(t))}static isLessThan(t,e){return t.x<e.x||t.y<e.y}static isGreaterThan(t,e){return t.x>e.x||t.y>e.y}static length(t){return Math.sqrt(t.x*t.x+t.y*t.y)}static normalize(t){const e=t.length();return e===0?t:a.multiplyScalar(t,1/e)}static dot(t,e){const i=a.multiply(t,e);return i.x+i.y}static isEqual(t,e){return t.x===e.x&&t.y===e.y}static isNear(t,e,i=.001){const n=a.subtract(t,e).abs();return n.x<=i&&n.y<=i}static min(...t){return new a(Math.min(...t.map(e=>e.x)),Math.min(...t.map(e=>e.y)))}static max(...t){return new a(Math.max(...t.map(e=>e.x)),Math.max(...t.map(e=>e.y)))}static from(t){return new a(t.x,t.y)}static fromArray([t,e]){return new a(t,e)}static random(){return new a(gt(),gt())}};y(a,"zero",Object.freeze(new a)),y(a,"one",Object.freeze(new a(1,1))),y(a,"up",Object.freeze(new a(0,-1))),y(a,"down",Object.freeze(new a(0,1))),y(a,"left",Object.freeze(new a(-1,0))),y(a,"right",Object.freeze(new a(1,0))),y(a,"negativeInfinity",Object.freeze(new a(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY))),y(a,"positiveInfinity",Object.freeze(new a(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)));let o=a;const E=Object.freeze({NW:o.create(-1,-1),N:o.up,NE:o.create(1,-1),E:o.right,SE:o.one,S:o.down,SW:o.create(-1,1),W:o.left}),Tt=[E.NW,E.N,E.NE,E.W,E.E,E.SW,E.S,E.SE];var J,K;class St extends Gt{constructor(){super(o.positiveInfinity.clone(),o.negativeInfinity.clone());m(this,J,!1);m(this,K,void 0);d(this,K,o.negativeInfinity.clone())}get area(){return r(this,J)?super.area:0}haveChanges(){return r(this,J)}reset(){this.position.set(o.positiveInfinity),this.size.set(o.negativeInfinity),r(this,K).set(o.negativeInfinity),d(this,J,!1)}registerPoint(e){this.position.min(e),r(this,K).max(e),this.size.set(o.subtract(r(this,K),this.position).addScalar(1)),d(this,J,!0)}}J=new WeakMap,K=new WeakMap;var P,st,rt,xt;class pt{constructor(t){m(this,rt);y(this,"size");y(this,"alternateRows");y(this,"createEmpty");y(this,"grid");m(this,P,void 0);m(this,st,0);const{size:e,alternateRows:i,createEmpty:n}={alternateRows:!1,...t};if(!o.frac(e).isEqual(o.zero))throw new Error(`Grid size must be integers (${e.toArray().join(", ")})`);this.grid=[],d(this,P,new St),this.size=e,this.alternateRows=i,this.createEmpty=n?()=>n(this):()=>new wt(this),V(this,rt,xt).call(this)}clear(){V(this,rt,xt).call(this),this.resetChanges()}indexOf(t){return t?t.index:-1}positionOf(t){if(t)return t.position}forEach(t,e){const{alternateRowDirections:i,evenRows:n,oddRows:h,evenCols:c,oddCols:l,startRow:f,endRow:k,startCol:b,endCol:N}={evenRows:!0,oddRows:!0,evenCols:!0,oddCols:!0,...e},z=new Set,I=(R,v)=>{const w=this.xy2index(R,v),u=this.grid[w];u&&(z.has(u)||(t(u,w),z.add(u)))};for(let R=f||0;R<(k||this.size.y);R++){const v=R%2;if(!(v===0&&!n)&&!(v===1&&!h)){if(i&&R%2===0){for(let w=(N||this.size.x)-1;w>=(b||0);w--){const u=w%2;u===0&&!c||u===1&&!l||I(w,R)}continue}for(let w=b||0;w<(N||this.size.x);w++){const u=w%2;u===0&&!c||u===1&&!l||I(w,R)}}}}map(t){return this.grid.map(t)}mapChanged(t){return this.getAllChanges().map(t)}getAllChanges(t=!1){const e=[];return this.forEachChanged(i=>e.push(i),t),e}countChanges(){return r(this,P).area}forEachChanged(t,e=!1){if(!r(this,P).haveChanges())return;const i=r(this,P).position.clone(),n=r(this,P).position.clone().add(r(this,P).size);this.forEach(t,{startRow:i.y,endRow:n.y,startCol:i.x,endCol:n.x}),e&&this.resetChanges()}registerChanged(t){t&&r(this,P).registerPoint(t.position)}resetChanges(){r(this,P).reset()}xy2index(t,e){return t<0||t>=this.size.x||e<0||e>=this.size.y?-1:t+e*this.size.x}position2index(t){const{x:e,y:i}=t;return this.xy2index(e,i)}index2position(t){const e=Math.floor(t/this.size.x),i=t-e*this.size.x;return o.create(i,e)}get(t){return this.getAtPosition(t)}set(t,e){this.setAtPosition(t,e)}getCellsInLine(t,e,i){const{excludeStart:n,excludeEnd:h,maxSteps:c}={maxSteps:r(this,st),...i},l=e.x-t.x,f=e.y-t.y;if(l===0&&f===0){const g=this.getAtPosition(t);return g?[g]:[]}const k=l<0?-1:1,b=f<0?-1:1,N=Math.abs(l),z=Math.abs(f),I=N>=z,R=Math.min(N,z),v=Math.max(N,z),w=R/v,u=[],L=n?1:0,F=h?v:v+1,W=F-L,Z=c!==void 0&&W>c?Math.floor(W/c):1;for(let g=L;g<F;g+=Z){const X=Math.round(g*w);if(I){const p=this.getAtXY(t.x+g*k,t.y+X*b);p&&u.push(p)}else{const p=this.getAtXY(t.x+X*k,t.y+g*b);p&&u.push(p)}}return u}getAtXY(t,e){const i=this.xy2index(t,e);if(i!==-1)return this.getAtIndex(i)}getAtPosition(t){const e=this.position2index(t);if(e!==-1)return this.getAtIndex(e)}setAtPosition(t,e){if(t.x<0||t.x>=this.size.x||t.y<0||t.y>=this.size.y)return;const i=this.position2index(t);this.setAtIndex(i,e)}getAtIndex(t){if(t%1!==0)throw new Error(`not int: ${t}`);return this.grid[t]}swap(t,e){const i=this.indexOf(t),n=this.indexOf(e);if(i===-1||n===-1)throw new Error("Can't swap unless both cells exists in the grid");const h=this.grid[i];this.setAtIndex(i,this.grid[n]),this.setAtIndex(n,h)}setAtIndex(t,e){if(t<0)throw new Error(`invalid index: ${t}`);e.index=t,e.position=this.index2position(t),this.grid[t]=e,this.registerChanged(e)}}P=new WeakMap,st=new WeakMap,rt=new WeakSet,xt=function(){const t=this.size.x*this.size.y;this.grid.length=t;for(let e=0;e<t;e++)this.setAtIndex(e,this.createEmpty());d(this,st,this.size.length())};var M;class Bt extends wt{constructor(e,i){super(e);y(this,"parent");m(this,M,void 0);this.parent=i,d(this,M,new St)}get dirtyRect(){return r(this,M)}forEachDirty(e,i){if(!r(this,M).haveChanges())return;const{resetChanges:n,...h}={resetChanges:!1,...i},c=r(this,M).position.clone(),l=r(this,M).position.clone().add(r(this,M).size);n&&this.resetChanges(),this.parent.forEach(e,{startRow:c.y,endRow:l.y,startCol:c.x,endCol:l.x,...h})}forEach(e,i){const n=this.parent.chunkSize,h=o.multiply(this.position,n),c=o.multiply(this.position,n).add(n);this.parent.forEach(e,{startRow:h.y,endRow:c.y,startCol:h.x,endCol:c.x,...i})}haveChanges(){return r(this,M).haveChanges()}countChanges(){return r(this,M).haveChanges()?r(this,M).area:0}registerChange(e){r(this,M).registerPoint(e.position)}resetChanges(){r(this,M).reset()}}M=new WeakMap;function Lt(s){return new Worker("/assets/worker-G1OrwRg-.js",{name:s==null?void 0:s.name})}var j,_,Q,nt,ht,bt,ut,It,ct,vt;class qt extends pt{constructor(e){const{chunkSize:i,workerize:n,...h}=e;super(h);m(this,ht);m(this,ut);m(this,ct);y(this,"chunkSize",o.create(64,64));m(this,j,void 0);m(this,_,void 0);m(this,Q,void 0);m(this,nt,[]);this.chunkSize=i||o.create(64,64);try{d(this,j,new pt({size:o.divide(this.size,this.chunkSize),createEmpty:c=>new Bt(c,this)}))}catch{throw new Error(`Grid must be evenly divisible by chunk size: ${o.divide(this.size,this.chunkSize).toArray().join(", ")}`)}d(this,_,n||!1),r(this,_)&&(d(this,Q,new Lt),r(this,Q).onmessage=this.handleWorkerResponse),V(this,ht,bt).call(this)}registerChanged(e){if(!e||e.index<0||e.index>=this.grid.length)return;const i=this.chunkOf(e);i&&i.registerChange(e)}resetChanges(){super.resetChanges(),this.forEachChunk(e=>e.resetChanges())}countChanges(){return this.mapChunks(e=>e.countChanges()).reduce((e,i)=>e+i)}getAllChanges(){const e=[];return this.forEachChanged(i=>e.push(i)),e}forEachChanged(e,i){this.forEachChunk(n=>{n.haveChanges()&&n.forEachDirty(e,{resetChanges:i})})}chunkOf(e){if(!e||!this.chunkSize)return;const i=o.divide(e.position,this.chunkSize).floor();return r(this,j).get(i)}getChunk(e){return r(this,j).get(e)}forEachChunk(e,i){r(this,j).forEach(e,i)}mapChunks(e){return r(this,j).map(e)}forEachChangedChunkPass(e,i=!0){this.forEachChunkPass(n=>{const h=n.filter(c=>c.haveChanges());h.length!==0&&(e(h),i&&h.forEach(c=>c.resetChanges()))})}forEachChunkPass(e){r(this,nt).forEach((i,n)=>{r(this,_)?V(this,ct,vt).call(this,()=>e(i,n)):e(i,n)})}handleWorkerResponse(e){console.log("worker says:",this,e.data)}}j=new WeakMap,_=new WeakMap,Q=new WeakMap,nt=new WeakMap,ht=new WeakSet,bt=function(){for(let e=0;e<r(this,j).size.x*r(this,j).size.y;e++)r(this,j).setAtIndex(e,r(this,j).createEmpty());V(this,ut,It).call(this)},ut=new WeakSet,It=function(){const e=[[!1,!1],[!1,!0],[!0,!1],[!0,!0]],i=[];e.forEach(([n,h])=>{const c=[];this.forEachChunk(l=>{c.push(l)},{evenRows:!n,oddRows:n,evenCols:!h,oddCols:h}),i.push(c)}),d(this,nt,i)},ct=new WeakSet,vt=function(e){r(this,Q)&&r(this,Q).postMessage({f:e})};class _t{constructor(t){y(this,"grid");const{gridOptions:e}=t;this.grid=this.createGrid(e)}clear(){this.grid.clear()}}class Xt{}var tt,lt;const dt=class dt extends Xt{constructor(e){super();m(this,tt,0);m(this,lt,100);y(this,"gravity");y(this,"sideStep");y(this,"bounce");const{gravity:i,sideStep:n,bounce:h}={gravity:dt.defaultGravity,sideStep:!0,bounce:!0,...e};this.gravity=i,this.sideStep=n,this.bounce=h}step({cell:e,deltaTime:i}){let n=!1;const h=[-1,1];gt()>=.5&&h.reverse();const c=e.getNeighbourInDirection(this.gravity.y<0?o.up:o.down);e.isSleeping()?c!=null&&c.empty&&(e.acceleration.add(o.multiplyScalar(this.gravity,i)),n=!0):this.sideStep&&(c!=null&&c.empty?(e.acceleration.add(o.multiplyScalar(this.gravity,i)),n=!0):h.every(l=>{const f=e.getNeighbourInDirection(o.create(l,this.gravity.y<0?-1:1));return f!=null&&f.empty?(e.acceleration.add(o.subtract(f.position,e.position)),n=!0,!1):!0})),n?(d(this,tt,0),h.forEach(l=>{const f=e.getNeighbourInDirection(o.create(l,0));f!=null&&f.empty||f==null||f.awake()})):(yt(this,tt)._++,r(this,tt)>=r(this,lt)&&e.sleep())}};tt=new WeakMap,lt=new WeakMap,y(dt,"defaultGravity",o.create(0,9.81));let mt=dt;function Yt(s,t){const{children:e,grid:i,renderOptions:n,pickColor:h,...c}=s,l=S.useRef(null),f=S.useRef(null),k=S.useRef(),[b,N]=Ft(!0);S.useImperativeHandle(t,()=>({clear:R,render:v})),S.useEffect(()=>{i&&(R(),v(i,n))},[i]);function z(){return f.current||(f.current=l.current?l.current.getContext("2d"):null,f.current&&(f.current.imageSmoothingEnabled=!1,f.current.translate(.5,.5))),f.current}function I(){if(k.current)return k.current;if(!i)return;const u=z();if(u)return k.current=u.createImageData(...i.size.toArray()),k.current}function R(){const u=I();u&&(u.data.fill(0),N(!0))}function v(u,L){const F={debugDraw:!1,resetChanges:!1,pixelScale:1,...L},{debugDraw:W,resetChanges:Z,pixelScale:g,onDebugDraw:X}=F;if(!u)return;if(l.current){const C=u.size.x,A=u.size.y;(l.current.width!==C||l.current.height!==A)&&(l.current.width=C*g,l.current.height=A*g,f.current=null)}const p=z();if(!p)return;const Y=I();if(Y){if(b.current===!0?u.forEach(C=>w({grid:u,imageData:Y,cell:C})):u.forEachChanged(C=>w({grid:u,imageData:Y,cell:C}),Z),g!==1){const C=document.createElement("canvas");C.width=u.size.x,C.height=u.size.y;const A=C.getContext("2d");A==null||A.putImageData(Y,0,0),p.drawImage(C,0,0,u.size.x*g,u.size.y*g)}else p.putImageData(Y,0,0);W&&(u instanceof qt&&u.forEachChunkPass((C,A)=>{C.forEach(G=>{p.strokeStyle=G.haveChanges()?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.2)",p.fillStyle=p.strokeStyle,p.lineWidth=1;const H=o.multiply(G.position,u.chunkSize),ot=o.multiplyScalar(u.chunkSize,g);g!==1&&H.multiplyScalar(g),p.strokeRect(...H.toArray(),...ot.toArray()),p.textAlign="right",p.fillText(G.position.toArray().toString(),...o.add(H,ot).subtractScalar(2).toArray()),p.textAlign="left",p.fillText(A.toString(),...o.add(H,o.multiply(ot,o.down).add(o.fromArray([2,-2]))).toArray(),ot.x),G.dirtyRect.haveChanges()&&(p.strokeStyle="red",p.fillStyle="red",p.textAlign="left",p.fillText(G.countChanges().toString(),...o.add(H,o.create(2,10)).toArray()),p.strokeRect(...o.multiplyScalar(G.dirtyRect.position,g).toArray(),...o.multiplyScalar(G.dirtyRect.size,g).toArray()))})}),X&&X(p)),N(!1)}}function w(u){const{imageData:L,cell:F}=u;if(F.index===-1)return;const W=h?h({cell:F,renderOptions:n}):F.getRGBA();W&&L.data.set(W,F.index*4)}if(i)return x.jsxs("div",{className:"grid canvas",style:n!=null&&n.debugDraw?{backgroundColor:"rgb(80, 80, 80)"}:void 0,children:[x.jsx("canvas",{ref:l,...c}),e]})}const Ht=S.forwardRef(Yt);var q,et,D,at,it,O,U,B;class $t{constructor(t){m(this,q,void 0);m(this,et,void 0);m(this,D,void 0);y(this,"limitFps");m(this,at,void 0);m(this,it,void 0);m(this,O,!0);m(this,U,void 0);m(this,B,void 0);const{gridRenderer:e,renderOptions:i,simulation:n,limitFps:h,resetChanges:c,onStep:l}={resetChanges:!0,...t};d(this,q,e),d(this,et,i),d(this,D,n),this.limitFps=h,d(this,at,c),d(this,it,l),this._stepInternal=this._stepInternal.bind(this),d(this,U,requestAnimationFrame(this._stepInternal))}_stepInternal(t){if(r(this,O)&&r(this,B)===void 0)d(this,B,t);else{const e=r(this,B)===void 0?0:(t-r(this,B))/1e3;if((this.limitFps===void 0||e>1/this.limitFps)&&r(this,D)){const i=r(this,D).grid;if(!i)throw new Error("simulation or grid must be provided");r(this,O)&&this.step(e),r(this,it)&&r(this,it).call(this,{grid:i,deltaTime:e}),r(this,q)&&r(this,q).render(i,{resetChanges:!1,...r(this,et)}),r(this,O)&&r(this,at)&&i.resetChanges()}}r(this,O)&&d(this,B,t),d(this,U,requestAnimationFrame(this._stepInternal))}get simulation(){return r(this,D)}destroy(){this.stop(),this.clear(),r(this,U)!==void 0&&cancelAnimationFrame(r(this,U))}start(){r(this,O)||(d(this,O,!0),this._stepInternal(Date.now()))}stop(){d(this,O,!1),d(this,B,void 0)}clear(){var t,e;(t=r(this,D))==null||t.clear(),(e=r(this,q))==null||e.clear()}isRunning(){return r(this,O)}registerSimulation(t){r(this,D)&&(console.error("already have one"),this.destroy()),d(this,D,t)}registerGridRenderer(t,e){d(this,q,t),e&&d(this,et,e)}step(t){r(this,D)&&r(this,D).step(t)}}q=new WeakMap,et=new WeakMap,D=new WeakMap,at=new WeakMap,it=new WeakMap,O=new WeakMap,U=new WeakMap,B=new WeakMap;function Jt(s){const{simulationRunnerRef:t,fps:e,children:i,configExtra:n,isPlaying:h,setIsPlaying:c,renderOptions:l,setRenderOptions:f}=s;function k(){var b;(b=t.current)==null||b.clear()}return x.jsxs("div",{className:"controls",children:[x.jsxs("div",{className:"panel controls",children:[x.jsx("button",{onClick:()=>c(b=>!b),children:h?x.jsxs(x.Fragment,{children:[x.jsx(zt,{}),"stop"]}):x.jsxs(x.Fragment,{children:[x.jsx(At,{}),"start"]})}),x.jsxs("button",{onClick:()=>{var b;(b=t.current)==null||b.step(.1)},children:[x.jsx(Mt,{}),"step"]}),x.jsxs("button",{onClick:()=>k(),children:[x.jsx(kt,{}),"reset"]})]}),i,x.jsxs("div",{className:"panel config",children:[x.jsxs(Nt,{trigger:x.jsxs("div",{className:"item trigger",children:[x.jsx(Dt,{}),"config"]}),children:[x.jsx(Pt,{id:"debugDraw",checked:(l==null?void 0:l.debugDraw)||!1,onChange:b=>f(N=>({...N,debugDraw:b}))}),n]}),x.jsx("div",{className:"separator"}),x.jsxs("div",{style:{width:"60px",whiteSpace:"nowrap",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:"1em"},children:["fps: ",e]})]})]})}function Kt(s,t){const{limitFps:e,resetChanges:i,background:n,children:h,defaultRenderOptions:c,toolBarPanel:l,toolBarConfigExtra:f,initSimulation:k,onStep:b,...N}={isRunning:!0,resetChanges:!0,...s},z=S.useRef(null),I=S.useRef(null),R=S.useRef(null),v=S.useRef([0]),[w,u]=S.useState(!0),[L,F]=S.useState(-1),[W,Z]=S.useState(void 0),[g,X]=S.useState({debugDraw:!1});S.useImperativeHandle(t,()=>I.current),S.useEffect(()=>{var C;if(z.current&&!I.current)return I.current=new $t({gridRenderer:z.current,simulation:k(),limitFps:e,resetChanges:i,renderOptions:g,onStep:p}),Z((C=I.current.simulation)==null?void 0:C.grid),()=>{var A;(A=I.current)==null||A.destroy(),I.current=null,Z(void 0)}},[]),S.useEffect(()=>{I.current&&(w?I.current.start():I.current.stop())},[w]),S.useEffect(()=>{var C;z.current&&(jt.isEqual(g,R.current)||(R.current=g,(C=I.current)==null||C.registerGridRenderer(z.current,g)))},[g]);function p(C){const{deltaTime:A}=C;v.current=[...v.current.slice(v.current.length-100),A===0?-1:1/A],F(Math.round(v.current.reduce((G,H)=>G+H)/v.current.length||1)),b&&b(C)}function Y(C){C.preventDefault()}return x.jsxs("div",{className:"simulation-runner",children:[x.jsx(Jt,{simulationRunnerRef:I,fps:L,children:l,configExtra:f,isPlaying:w,setIsPlaying:u,renderOptions:g,setRenderOptions:X}),g.debugDraw?void 0:n,x.jsx(Ht,{ref:z,renderOptions:g,grid:W,children:h,onContextMenu:Y,...N})]})}const te=S.forwardRef(Kt);export{Xt as B,qt as C,wt as G,_t as S,o as V,mt as a,te as b,Pt as c,Vt as d,pt as e,Tt as n,gt as r,Ft as u};

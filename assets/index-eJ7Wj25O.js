var C=Object.defineProperty;var N=(n,t,e)=>t in n?C(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var m=(n,t,e)=>(N(n,typeof t!="symbol"?t+"":t,e),e),I=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var a=(n,t,e)=>(I(n,t,"read from private field"),e?e.call(n):t.get(n)),A=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},S=(n,t,e,i)=>(I(n,t,"write to private field"),i?i.call(n,e):t.set(n,e),e);import{r as l,_ as E,j as x}from"./index-_rHQVuLF.js";function P(n,t){const[e,i,s]=n;if(t===void 0)return`hsl(${e}, ${i}%, ${s}%)`;const[r,d,u]=X(n,t);return`hsl(${r}, ${d}%, ${u}%)`}function X(n,t=[Math.round(Math.random()*10),Math.round(Math.random()*10),Math.round(Math.random()*10)]){const[e,i,s]=n,[r=0,d=0,u=0]=t||[];return[Math.min(Math.max(e+Math.round(Math.random()*(r*2))-r,0),360),Math.min(Math.max(i+Math.round(Math.random()*(d*2))-d,0),100),Math.min(Math.max(s+Math.round(Math.random()*(u*2))-u,0),100)]}var p;class Y{constructor(t,e){A(this,p,void 0);m(this,"color");m(this,"isEmpty",!1);m(this,"dir",{TL:()=>this.neighbourInDirection(-1,-1),T:()=>this.neighbourInDirection(0,-1),TR:()=>this.neighbourInDirection(1,-1),R:()=>this.neighbourInDirection(1,0),DR:()=>this.neighbourInDirection(1,1),D:()=>this.neighbourInDirection(0,1),DL:()=>this.neighbourInDirection(-1,1),L:()=>this.neighbourInDirection(-1,0)});const{isEmpty:i}=e||{};S(this,p,t),this.isEmpty=i||!1,this.color=P(this.getHSL())}neighbourInDirection(t,e){const i=a(this,p),[s,r]=i.XYOf(this);return i.getAtXY(s+t,r+e)}swap(t){a(this,p).swapAB(this,t)}}p=new WeakMap;class b extends Y{constructor(t){super(t,{isEmpty:!0})}getHSL(){return[50,0,50]}update(){}}class T extends Y{}class j extends T{update(){const t=this.dir.D();if(t!=null&&t.isEmpty)return this.swap(t);const e=this.dir.DL();if(e!=null&&e.isEmpty)return this.swap(e);const i=this.dir.DR();if(i!=null&&i.isEmpty)return this.swap(i)}}class W extends j{getHSL(){return X([27.8,31.8,58.6])}}class q extends Y{update(){const t=this.dir.T();if(t instanceof j)return this.swap(t);const e=this.dir.D();if(e!=null&&e.isEmpty)return this.swap(e);const i=this.dir.L();if(i!=null&&i.isEmpty)return this.swap(i);const s=this.dir.R();if(s!=null&&s.isEmpty)return this.swap(s)}}class B extends q{getHSL(){return X([216,100,60],[5,5,3])}}var h;class G{constructor(t,e){m(this,"width");m(this,"height");A(this,h,void 0);this.width=t,this.height=e,S(this,h,[]),this.clear()}clear(){for(let t=0;t<this.width*this.height;t++)a(this,h)[t]=new b(this)}indexOf(t,e){return t?a(this,h).indexOf(t,e):-1}XYOf(t,e){const i=this.indexOf(t,e);return this.index2XY(i)}forEach(t){for(let e=a(this,h).length-1;e>=0&&t(a(this,h)[e],e)!==!1;e--);}XY2index(t,e){return t<0||t>=this.width||e<0||e>=this.height?-1:t+e*this.width}index2XY(t){let e=Math.floor(t/this.width);return[t-e*this.width,e]}get(t,e){return this.getAtXY(t,e)}set(t,e,i){this.setAtXY(t,e,i)}getAtXY(t,e){const i=this.XY2index(t,e);if(i!==-1)return this.getAtIndex(i)}setAtXY(t,e,i){const s=this.XY2index(t,e);this.setAtIndex(s,i)}getAtIndex(t){return a(this,h)[t]}setAtIndex(t,e){a(this,h)[t]=e}swapAB(t,e){const i=this.indexOf(t),s=this.indexOf(e),r=a(this,h)[i];this.setAtIndex(i,a(this,h)[s]),this.setAtIndex(s,r)}}h=new WeakMap;var g;class _{constructor(t){A(this,g,void 0);m(this,"materialPalette");const{width:e,height:i}=t,s=new G(e,i);S(this,g,s),this.materialPalette={empty:()=>new b(s),sand:()=>new W(s),water:()=>new B(s)}}getGrid(){return a(this,g)}step(){a(this,g).forEach(e=>e.update(-1))}}g=new WeakMap;function V(){const i=l.useRef(null),s=l.useRef(null),r=l.useRef(),d=l.useRef(),u=l.useRef(!1),R=l.useRef([0,0]),v=l.useRef("sand"),[H,L]=l.useState([]);l.useEffect(()=>(r.current=new _({width:75,height:75}),L(E.keys(r.current.materialPalette)),d.current=requestAnimationFrame(D),()=>{d.current!==void 0&&cancelAnimationFrame(d.current)}),[]);function O(o){if(!s.current)return;const{x:c,y:f,width:M,height:w}=s.current.getBoundingClientRect();R.current=[(o.clientX-c)/M,(o.clientY-f)/w]}function D(o){const c=r.current;if(!c)return;const f=c.getGrid();F(f),c.step(),$(f),d.current=requestAnimationFrame(D)}function $(o){const c=s.current?s.current.getContext("2d"):null;c&&o.forEach((f,M)=>{const[w,y]=o.index2XY(M);c.fillStyle=f.color,c.fillRect(w*5,y*5,5,5)})}function F(o){var y;if(!u.current||!v.current)return;const[c,f]=R.current,M=Math.floor(c*75),w=Math.floor(f*75);o.setAtXY(M,w,E.invoke((y=r.current)==null?void 0:y.materialPalette,v.current))}return x.jsxs("div",{className:"route sand",ref:i,children:[x.jsx("div",{className:"materials",children:E.map(H,o=>x.jsx("div",{children:o,onClick:()=>v.current=o,style:v.current===o?{border:"1px solid white"}:void 0},o))}),x.jsx("canvas",{ref:s,width:`${75*5}px`,height:`${75*5}px`,onMouseDown:()=>u.current=!0,onMouseUp:()=>u.current=!1,onMouseLeave:()=>u.current=!1,onMouseMove:O}),x.jsxs("div",{className:"console",children:[x.jsxs("div",{children:["isDrawing: ",u.current?"yes":"no"]}),x.jsxs("div",{children:["mouse: ",R.current[0].toFixed(2),", ",R.current[1].toFixed(2)]})]})]})}export{V as default};

var j=Object.defineProperty;var v=(r,t,e)=>t in r?j(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var g=(r,t,e)=>(v(r,typeof t!="symbol"?t+"":t,e),e),W=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var l=(r,t,e)=>(W(r,t,"read from private field"),e?e.call(r):t.get(r)),S=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},A=(r,t,e,i)=>(W(r,t,"write to private field"),i?i.call(r,e):t.set(r,e),e);import{r as E,j as C}from"./index-FInyT7v3.js";function O(r){const[t,e]=E.useState(r),i=E.useRef(t);return[i,s=>{s instanceof Function?(i.current=s(i.current),e(s)):(i.current=s,e(s))}]}class G{constructor(t){g(this,"grid");g(this,"index");g(this,"position");g(this,"dir",{NW:()=>this.getNeighbourInDirection(a.NW),N:()=>this.getNeighbourInDirection(a.N),NE:()=>this.getNeighbourInDirection(a.NE),E:()=>this.getNeighbourInDirection(a.E),SE:()=>this.getNeighbourInDirection(a.SE),S:()=>this.getNeighbourInDirection(a.S),SW:()=>this.getNeighbourInDirection(a.SW),W:()=>this.getNeighbourInDirection(a.W)});this.grid=t,this.index=-1,this.position=new n(0,0)}getNeighbourInDirection(t){if(this.position)return this.grid.getAtPosition(this.position.add(t))}getNeighbourhood(){const t=[];return P.forEach(e=>{const i=this.getNeighbourInDirection(e);i&&t.push(i)}),t}getLineTo(t,e){return this.grid.getPositionsInLine(this.position,t,e)}swapWith(t){this.grid.swap(this,t)}getRGBA(){return[0,0,0,0]}}var x,N;class k{constructor(t){g(this,"width");g(this,"height");g(this,"alternateRows");g(this,"createEmpty");S(this,x,void 0);S(this,N,void 0);const{width:e,height:i,alternateRows:u,createEmpty:s}={alternateRows:!1,...t};A(this,x,[]),A(this,N,new Set([])),this.width=e,this.height=i,this.alternateRows=u,this.createEmpty=s,this.clear()}clear(){for(let t=0;t<this.width*this.height;t++)this.setAtIndex(t,this.createEmpty(this))}indexOf(t){return t?t.index:-1}positionOf(t){if(t)return t.position}forEach(t,e){const{alternateRows:i,freeze:u}=e||{},s=new Set,w=u?l(this,x).map(o=>Object.assign(Object.create(Object.getPrototypeOf(o)),o)):l(this,x);let p=(o,c)=>{const h=this.position2index(new n(o,c)),m=w[h];if(!m||s.has(m))return;if(t(m,h)===!1)return!1;s.add(m)};for(let o=0;o<this.height;o++){let c;if(i&&o%2===0&&Math.random()<.5){for(let h=this.width-1;h>=0&&(c=p(h,o),c!==!1);h--);if(c===!1)break;continue}for(let h=0;h<this.width&&(c=p(h,o),c!==!1);h++);if(c===!1)break}}map(t){return l(this,x).map(t)}forEachChanged(t,e=!0){l(this,N).forEach(i=>t(i)),e&&l(this,N).clear()}position2index(t){const{x:e,y:i}=t;return e<0||e>=this.width||i<0||i>=this.height?-1:e+i*this.width}index2position(t){let e=Math.floor(t/this.width),i=t-e*this.width;return new n(i,e)}get(t){return this.getAtPosition(t)}set(t,e){this.setAtPosition(t,e)}getPositionsInLine(t,e,i){const{excludeStart:u,excludeEnd:s}=i||{},w=e.x-t.x,p=e.y-t.y;if(w===0&&p===0)return[t];const o=w<0?-1:1,c=p<0?-1:1,h=Math.abs(w),m=Math.abs(p),b=h>=m,R=Math.min(h,m),f=Math.max(h,m),d=R/f,y=[];for(let I=u?1:0;I<(s?f:f+1);I++){const M=Math.round(I*d);b?y.push(new n(t.x+I*o,t.y+M*c)):y.push(new n(t.x+M*o,t.y+I*c))}return y}getAtPosition(t){const e=this.position2index(t);if(e!==-1)return this.getAtIndex(e)}setAtPosition(t,e){const i=this.position2index(t);this.setAtIndex(i,e)}getAtIndex(t){return l(this,x)[t]}registerChanged(t){l(this,N).add(t)}swap(t,e){const i=this.indexOf(t),u=this.indexOf(e),s=l(this,x)[i];this.setAtIndex(i,l(this,x)[u]),this.setAtIndex(u,s)}setAtIndex(t,e){e.index=t,e.position=this.index2position(t),l(this,x)[t]=e,this.registerChanged(e)}}x=new WeakMap,N=new WeakMap;class n{constructor(t,e){g(this,"x");g(this,"y");this.x=t,this.y=e}clone(){return new n(this.x,this.y)}add(t){return new n(this.x+t.x,this.y+t.y)}multiply(t){return new n(this.x*t.x,this.y*t.y)}multiplyScalar(t){return new n(this.x*t,this.y*t)}divide(t){return new n(this.x/t.x,this.y/t.y)}divideScalar(t){return new n(this.x/t,this.y/t)}round(){return new n(Math.round(this.x),Math.round(this.y))}floor(){return new n(Math.floor(this.x),Math.floor(this.y))}ceil(){return new n(Math.ceil(this.x),Math.ceil(this.y))}static zero(){return new n(0,0)}static one(){return new n(1,1)}static up(){return new n(0,-1)}static down(){return new n(0,1)}static left(){return new n(-1,0)}static right(){return new n(-1,0)}static random(){return new n(Math.random(),Math.random())}}const a={NW:new n(-1,-1),N:new n(0,-1),NE:new n(1,-1),E:new n(1,0),SE:new n(1,1),S:new n(0,1),SW:new n(-1,1),W:new n(-1,0)},P=[a.NW,a.N,a.NE,a.W,a.E,a.SW,a.S,a.SE];function L(r){const{grid:t,pickColor:e,...i}=r,u=E.useRef(),s=E.useRef(null),w=E.useRef(),[p,o]=O(!0);E.useEffect(()=>(u.current=requestAnimationFrame(b),()=>{u.current!==void 0&&cancelAnimationFrame(u.current)}),[]),E.useEffect(()=>{t&&(o(!0),m(),b())},[t]);function c(){return s.current?s.current.getContext("2d"):null}function h(){if(w.current)return w.current;if(!t)return;const f=c();if(f)return w.current=f.createImageData(t.width,t.height),w.current}function m(){const f=h();f&&(f.data.fill(0),o(!0))}function b(){if(!t)return;const f=c();if(!f)return;const d=h();d&&(p.current===!0?t.forEach(y=>R(d,y)):t.forEachChanged(y=>R(d,y)),f.putImageData(d,0,0),o(!1),u.current=requestAnimationFrame(b))}function R(f,d){d.index!==-1&&t&&f.data.set(e?e(d):d.getRGBA(),d.index*4)}return t?C.jsx("div",{className:"grid canvas",children:C.jsx("canvas",{ref:s,width:t.width,height:t.height,...i})}):null}export{G,n as V,k as a,L as b,P as n,O as u};

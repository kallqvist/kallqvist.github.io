var wt=Object.defineProperty;var St=(r,t,e)=>t in r?wt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var d=(r,t,e)=>(St(r,typeof t!="symbol"?t+"":t,e),e),ot=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var s=(r,t,e)=>(ot(r,t,"read from private field"),e?e.call(r):t.get(r)),y=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},c=(r,t,e,i)=>(ot(r,t,"write to private field"),i?i.call(r,e):t.set(r,e),e);var lt=(r,t,e,i)=>({set _(n){c(r,t,n,e)},get _(){return s(r,t,i)}}),J=(r,t,e)=>(ot(r,t,"access private method"),e);import{r as b,j as ut,_ as It}from"./index-geFiCFdi.js";import"./react-spring_web.modern-Oj6xHqW5.js";function bt(r){const[t,e]=b.useState(r),i=b.useRef(t);return[i,o=>{o instanceof Function?(i.current=o(i.current),e(o)):(i.current=o,e(o))}]}class yt{constructor(t){d(this,"grid");d(this,"index");d(this,"position");d(this,"dir",{NW:()=>this.getNeighbourInDirection(S.NW),N:()=>this.getNeighbourInDirection(S.N),NE:()=>this.getNeighbourInDirection(S.NE),E:()=>this.getNeighbourInDirection(S.E),SE:()=>this.getNeighbourInDirection(S.SE),S:()=>this.getNeighbourInDirection(S.S),SW:()=>this.getNeighbourInDirection(S.SW),W:()=>this.getNeighbourInDirection(S.W)});this.grid=t,this.index=-1,this.position=a.create(0,0)}getNeighbourInDirection(t){if(this.position)return this.grid.getAtPosition(a.add(this.position,t))}getNeighbourhood(){const t=[];return vt.forEach(e=>{const i=this.getNeighbourInDirection(e);t.push(i)}),t}getLineTo(t,e){return this.grid.getCellsInLine(this.position,t,e)}swapWith(t){this.grid.swap(this,t)}getRGBA(){return[0,0,0,0]}}var Et=function(){function r(t){this._value=NaN,typeof t=="string"?this._seed=this.hashCode(t):typeof t=="number"?this._seed=this.getSafeSeed(t):this._seed=this.getSafeSeed(r.MIN+Math.floor((r.MAX-r.MIN)*Math.random())),this.reset()}return r.prototype.next=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=1),this.recalculate(),this.map(this._value,r.MIN,r.MAX,t,e)},r.prototype.nextInt=function(t,e){return t===void 0&&(t=10),e===void 0&&(e=100),this.recalculate(),Math.floor(this.map(this._value,r.MIN,r.MAX,t,e+1))},r.prototype.nextString=function(t,e){t===void 0&&(t=16),e===void 0&&(e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");for(var i="";i.length<t;)i+=this.nextChar(e);return i},r.prototype.nextChar=function(t){return t===void 0&&(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"),t.substr(this.nextInt(0,t.length-1),1)},r.prototype.nextArrayItem=function(t){return t[this.nextInt(0,t.length-1)]},r.prototype.nextBoolean=function(){return this.recalculate(),this._value>.5},r.prototype.skip=function(t){for(t===void 0&&(t=1);t-- >0;)this.recalculate()},r.prototype.reset=function(){this._value=this._seed},r.prototype.recalculate=function(){this._value=this.xorshift(this._value)},r.prototype.xorshift=function(t){return t^=t<<13,t^=t>>17,t^=t<<5,t},r.prototype.map=function(t,e,i,n,o){return(t-e)/(i-e)*(o-n)+n},r.prototype.hashCode=function(t){var e=0;if(t)for(var i=t.length,n=0;n<i;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0,e=this.xorshift(e);return this.getSafeSeed(e)},r.prototype.getSafeSeed=function(t){return t===0?1:t},r.MIN=-2147483648,r.MAX=2147483647,r}();const Rt=new Et,ct=()=>Rt.next();var q,P;class zt{constructor(t,e){y(this,q,void 0);y(this,P,void 0);c(this,q,t),c(this,P,e)}set(t,e){t&&c(this,q,t),e&&c(this,P,e)}get position(){return s(this,q)}get size(){return s(this,P)}get area(){return s(this,P).x*s(this,P).y}toArray(){return[...s(this,q).toArray(),...s(this,P).toArray()]}}q=new WeakMap,P=new WeakMap;const h=class h{constructor(t=0,e=0){d(this,"x");d(this,"y");this.x=t,this.y=e}clone(){return new h(this.x,this.y)}setXY(t,e){this.x=t,this.y=e}set(t){this.x=t.x,this.y=t.y}add(t){return this.x=this.x+t.x,this.y=this.y+t.y,this}addScalar(t){return this.x=this.x+t,this.y=this.y+t,this}subtract(t=h.zero){return this.x=this.x-t.x,this.y=this.y-t.y,this}subtractScalar(t){return this.x=this.x-t,this.y=this.y-t,this}multiply(t){return this.x=this.x*t.x,this.y=this.y*t.y,this}multiplyScalar(t){return this.x=this.x*t,this.y=this.y*t,this}divide(t){return this.x=this.x/t.x,this.y=this.y/t.y,this}divideScalar(t){return this.x=this.x/t,this.y=this.y/t,this}mod(t){return this.x=this.x%t.x,this.y=this.y%t.y,this}modScalar(t){return this.x=this.x%t,this.y=this.y%t,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}frac(){return this.subtract(this.clone().floor())}normalize(){const t=this.length();return t===0?this:this.multiplyScalar(1/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}dot(t){const e=h.multiply(this,t);return e.x+e.y}isEqual(t){return this.x===t.x&&this.y===t.y}isNear(t,e=.001){const i=h.subtract(this,t).abs();return i.x<=e&&i.y<=e}isLessThan(t){return h.isLessThan(this,t)}isGreaterThan(t){return h.isGreaterThan(this,t)}toArray(){return[this.x,this.y]}join(t){return this.toArray().join(t)}static create(t=0,e=0){return new h(t,e)}static add(t,e){return new h(t.x+e.x,t.y+e.y)}static addScalar(t,e){return new h(t.x+e,t.y+e)}static subtract(t,e=h.zero){return new h(t.x-e.x,t.y-e.y)}static subtractScalar(t,e){return new h(t.x-e,t.y-e)}static multiply(t,e){return new h(t.x*e.x,t.y*e.y)}static multiplyScalar(t,e){return new h(t.x*e,t.y*e)}static divide(t,e){return new h(t.x/e.x,t.y/e.y)}static divideScalar(t,e){return new h(t.x/e,t.y/e)}static mod(t,e){return new h(t.x%e.x,t.y%e.y)}static modScalar(t,e){return new h(t.x%e,t.y%e)}static abs(t){return new h(Math.abs(t.x),Math.abs(t.y))}static round(t){return new h(Math.round(t.x),Math.round(t.y))}static floor(t){return new h(Math.floor(t.x),Math.floor(t.y))}static ceil(t){return new h(Math.ceil(t.x),Math.ceil(t.y))}static frac(t){return h.subtract(t,h.floor(t))}static isLessThan(t,e){return t.x<e.x||t.y<e.y}static isGreaterThan(t,e){return t.x>e.x||t.y>e.y}static length(t){return Math.sqrt(t.x*t.x+t.y*t.y)}static normalize(t){const e=t.length();return e===0?t:h.multiplyScalar(t,1/e)}static dot(t,e){const i=h.multiply(t,e);return i.x+i.y}static isEqual(t,e){return t.x===e.x&&t.y===e.y}static isNear(t,e,i=.001){const n=h.subtract(t,e).abs();return n.x<=i&&n.y<=i}static min(...t){return new h(Math.min(...t.map(e=>e.x)),Math.min(...t.map(e=>e.y)))}static max(...t){return new h(Math.max(...t.map(e=>e.x)),Math.max(...t.map(e=>e.y)))}static from(t){return new h(t.x,t.y)}static fromArray([t,e]){return new h(t,e)}static random(){return new h(ct(),ct())}};d(h,"zero",Object.freeze(new h)),d(h,"one",Object.freeze(new h(1,1))),d(h,"up",Object.freeze(new h(0,-1))),d(h,"down",Object.freeze(new h(0,1))),d(h,"left",Object.freeze(new h(-1,0))),d(h,"right",Object.freeze(new h(1,0))),d(h,"negativeInfinity",Object.freeze(new h(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY))),d(h,"positiveInfinity",Object.freeze(new h(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)));let a=h;const S=Object.freeze({NW:a.create(-1,-1),N:a.up,NE:a.create(1,-1),E:a.right,SE:a.one,S:a.down,SW:a.create(-1,1),W:a.left}),vt=[S.NW,S.N,S.NE,S.W,S.E,S.SW,S.S,S.SE];var L,X;class xt extends zt{constructor(){super(a.positiveInfinity.clone(),a.negativeInfinity.clone());y(this,L,!1);y(this,X,void 0);c(this,X,a.negativeInfinity.clone())}get area(){return s(this,L)?super.area:0}haveChanges(){return s(this,L)}reset(){this.position.set(a.positiveInfinity),this.size.set(a.negativeInfinity),s(this,X).set(a.negativeInfinity),c(this,L,!1)}registerPoint(e){this.position.min(e),s(this,X).max(e),this.size.set(a.subtract(s(this,X),this.position).addScalar(1)),c(this,L,!0)}}L=new WeakMap,X=new WeakMap;var k,V,_,ft;class dt{constructor(t){y(this,_);d(this,"size");d(this,"alternateRows");d(this,"createEmpty");d(this,"grid");y(this,k,void 0);y(this,V,0);const{size:e,alternateRows:i,createEmpty:n}={alternateRows:!1,...t};if(!a.frac(e).isEqual(a.zero))throw new Error(`Grid size must be integers (${e.toArray().join(", ")})`);this.grid=[],c(this,k,new xt),this.size=e,this.alternateRows=i,this.createEmpty=n?()=>n(this):()=>new yt(this),J(this,_,ft).call(this)}clear(){J(this,_,ft).call(this),this.resetChanges()}indexOf(t){return t?t.index:-1}positionOf(t){if(t)return t.position}forEach(t,e){const{alternateRowDirections:i,evenRows:n,oddRows:o,evenCols:f,oddCols:g,startRow:x,endRow:l,startCol:I,endCol:z}={evenRows:!0,oddRows:!0,evenCols:!0,oddCols:!0,...e},M=new Set,D=(w,p)=>{const C=this.xy2index(w,p),u=this.grid[C];u&&(M.has(u)||(t(u,C),M.add(u)))};for(let w=x||0;w<(l||this.size.y);w++){const p=w%2;if(!(p===0&&!n)&&!(p===1&&!o)){if(i&&w%2===0){for(let C=(z||this.size.x)-1;C>=(I||0);C--){const u=C%2;u===0&&!f||u===1&&!g||D(C,w)}continue}for(let C=I||0;C<(z||this.size.x);C++){const u=C%2;u===0&&!f||u===1&&!g||D(C,w)}}}}map(t){return this.grid.map(t)}mapChanged(t){return this.getAllChanges().map(t)}getAllChanges(t=!1){const e=[];return this.forEachChanged(i=>e.push(i),t),e}countChanges(){return s(this,k).area}forEachChanged(t,e=!1){if(!s(this,k).haveChanges())return;const i=s(this,k).position.clone(),n=s(this,k).position.clone().add(s(this,k).size);this.forEach(t,{startRow:i.y,endRow:n.y,startCol:i.x,endCol:n.x}),e&&this.resetChanges()}registerChanged(t){s(this,k).registerPoint(t.position)}resetChanges(){s(this,k).reset()}xy2index(t,e){return t<0||t>=this.size.x||e<0||e>=this.size.y?-1:t+e*this.size.x}position2index(t){const{x:e,y:i}=t;return this.xy2index(e,i)}index2position(t){const e=Math.floor(t/this.size.x),i=t-e*this.size.x;return a.create(i,e)}get(t){return this.getAtPosition(t)}set(t,e){this.setAtPosition(t,e)}getCellsInLine(t,e,i){const{excludeStart:n,excludeEnd:o,maxSteps:f}={maxSteps:s(this,V),...i},g=e.x-t.x,x=e.y-t.y;if(g===0&&x===0){const R=this.getAtPosition(t);return R?[R]:[]}const l=g<0?-1:1,I=x<0?-1:1,z=Math.abs(g),M=Math.abs(x),D=z>=M,w=Math.min(z,M),p=Math.max(z,M),C=w/p,u=[],H=n?1:0,O=o?p:p+1,T=O-H,m=f!==void 0&&T>f?Math.floor(T/f):1;for(let R=H;R<O;R+=m){const F=Math.round(R*C);if(D){const G=this.getAtXY(t.x+R*l,t.y+F*I);G&&u.push(G)}else{const G=this.getAtXY(t.x+F*l,t.y+R*I);G&&u.push(G)}}return u}getAtXY(t,e){const i=this.xy2index(t,e);if(i!==-1)return this.getAtIndex(i)}getAtPosition(t){const e=this.position2index(t);if(e!==-1)return this.getAtIndex(e)}setAtPosition(t,e){if(t.x<0||t.x>=this.size.x||t.y<0||t.y>=this.size.y)return;const i=this.position2index(t);this.setAtIndex(i,e)}getAtIndex(t){if(t%1!==0)throw new Error(`not int: ${t}`);return this.grid[t]}swap(t,e){const i=this.indexOf(t),n=this.indexOf(e);if(i===-1||n===-1)throw new Error("Can't swap unless both cells exists in the grid");const o=this.grid[i];this.setAtIndex(i,this.grid[n]),this.setAtIndex(n,o)}setAtIndex(t,e){if(t<0)throw new Error(`invalid index: ${t}`);e.index=t,e.position=this.index2position(t),this.grid[t]=e,this.registerChanged(e)}}k=new WeakMap,V=new WeakMap,_=new WeakSet,ft=function(){const t=this.size.x*this.size.y;this.grid.length=t;for(let e=0;e<t;e++)this.setAtIndex(e,this.createEmpty());c(this,V,this.size.length())};var E;class At extends yt{constructor(e,i){super(e);d(this,"parent");y(this,E,void 0);this.parent=i,c(this,E,new xt)}get dirtyRect(){return s(this,E)}forEachDirty(e,i){if(!s(this,E).haveChanges())return;const{resetChanges:n,...o}={resetChanges:!1,...i},f=s(this,E).position.clone(),g=s(this,E).position.clone().add(s(this,E).size);n&&this.resetChanges(),this.parent.forEach(e,{startRow:f.y,endRow:g.y,startCol:f.x,endCol:g.x,...o})}forEach(e,i){const n=this.parent.chunkSize,o=a.multiply(this.position,n),f=a.multiply(this.position,n).add(n);this.parent.forEach(e,{startRow:o.y,endRow:f.y,startCol:o.x,endCol:f.x,...i})}haveChanges(){return s(this,E).haveChanges()}countChanges(){return s(this,E).haveChanges()?s(this,E).area:0}registerChange(e){s(this,E).registerPoint(e.position)}resetChanges(){s(this,E).reset()}}E=new WeakMap;function Mt(r){return new Worker("/assets/worker-G1OrwRg-.js",{name:r==null?void 0:r.name})}var v,K,Y,tt,st,pt,rt,mt,nt,Ct;class kt extends dt{constructor(e){const{chunkSize:i,workerize:n,...o}=e;super(o);y(this,st);y(this,rt);y(this,nt);d(this,"chunkSize",a.create(64,64));y(this,v,void 0);y(this,K,void 0);y(this,Y,void 0);y(this,tt,[]);this.chunkSize=i||a.create(64,64),c(this,v,new dt({size:a.divide(this.size,this.chunkSize),createEmpty:f=>new At(f,this)})),c(this,K,n||!1),s(this,K)&&(c(this,Y,new Mt),s(this,Y).onmessage=this.handleWorkerResponse),J(this,st,pt).call(this)}registerChanged(e){if(e.index<0||e.index>=this.grid.length)return;const i=this.chunkOf(e);i&&i.registerChange(e)}resetChanges(){super.resetChanges(),this.forEachChunk(e=>e.resetChanges())}countChanges(){return this.mapChunks(e=>e.countChanges()).reduce((e,i)=>e+i)}getAllChanges(){const e=[];return this.forEachChanged(i=>e.push(i)),e}forEachChanged(e,i){this.forEachChunk(n=>{n.haveChanges()&&n.forEachDirty(e,{resetChanges:i})})}chunkOf(e){if(!e||!this.chunkSize)return;const i=a.divide(e.position,this.chunkSize).floor();return s(this,v).get(i)}getChunk(e){return s(this,v).get(e)}forEachChunk(e,i){s(this,v).forEach(e,i)}mapChunks(e){return s(this,v).map(e)}forEachChangedChunkPass(e,i=!1){this.forEachChunkPass(n=>{const o=n.filter(f=>f.haveChanges());o.length!==0&&(e(o),i&&o.forEach(f=>f.resetChanges()))})}forEachChunkPass(e){s(this,tt).forEach((i,n)=>{s(this,K)?J(this,nt,Ct).call(this,()=>e(i,n)):e(i,n)})}handleWorkerResponse(e){console.log("worker says:",this,e.data)}}v=new WeakMap,K=new WeakMap,Y=new WeakMap,tt=new WeakMap,st=new WeakSet,pt=function(){for(let e=0;e<s(this,v).size.x*s(this,v).size.y;e++)s(this,v).setAtIndex(e,s(this,v).createEmpty());J(this,rt,mt).call(this)},rt=new WeakSet,mt=function(){const e=[[!1,!1],[!1,!0],[!0,!1],[!0,!0]],i=[];e.forEach(([n,o])=>{const f=[];this.forEachChunk(g=>{f.push(g)},{evenRows:!n,oddRows:n,evenCols:!o,oddCols:o}),i.push(f)}),c(this,tt,i)},nt=new WeakSet,Ct=function(e){s(this,Y)&&s(this,Y).postMessage({f:e})};class Gt{constructor(t){d(this,"grid");const{gridOptions:e}=t;this.grid=this.createGrid(e)}clear(){this.grid.clear()}}class Nt{}var Q,ht;const at=class at extends Nt{constructor(e){super();y(this,Q,0);y(this,ht,100);d(this,"gravity");d(this,"sideStep");d(this,"bounce");const{gravity:i,sideStep:n,bounce:o}={gravity:at.defaultGravity,sideStep:!0,bounce:!0,...e};this.gravity=i,this.sideStep=n,this.bounce=o}step({grid:e,cell:i,deltaTime:n}){let o=!1;const f=[-1,1];ct()>=.5&&f.reverse();const g=i.getNeighbourInDirection(this.gravity.y<0?a.up:a.down);i.isSleeping()?g!=null&&g.empty&&(i.acceleration.add(a.multiplyScalar(this.gravity,n)),o=!0):this.sideStep&&(g!=null&&g.empty?(i.acceleration.add(a.multiplyScalar(this.gravity,n)),o=!0):f.every(x=>{const l=i.getNeighbourInDirection(a.create(x,this.gravity.y<0?-1:1));return l!=null&&l.empty?(i.acceleration.set(a.subtract(l.position,i.position)),o=!0,!1):!0})),o?(c(this,Q,0),f.forEach(x=>{const l=i.getNeighbourInDirection(a.create(x,0));l!=null&&l.empty||l==null||l.awake()})):(lt(this,Q)._++,s(this,Q)>=s(this,ht)?i.sleep():e.registerChanged(i))}};Q=new WeakMap,ht=new WeakMap,d(at,"defaultGravity",a.create(0,9.81));let gt=at;function Dt(r,t){const{children:e,grid:i,debugDraw:n,pickColor:o,...f}={debugDraw:!1,...r},g=b.useRef(null),x=b.useRef(null),l=b.useRef(),[I,z]=bt(!0);b.useImperativeHandle(t,()=>({clear:w,render:p})),b.useEffect(()=>{i&&(w(),p(i))},[i]);function M(){return x.current||(x.current=g.current?g.current.getContext("2d"):null,x.current&&(x.current.imageSmoothingEnabled=!1,x.current.translate(.5,.5))),x.current}function D(){if(l.current)return l.current;if(!i)return;const u=M();if(u)return l.current=u.createImageData(...i.size.toArray()),l.current}function w(){const u=D();u&&(u.data.fill(0),z(!0))}function p(u,H={debugDraw:n}){const{debugDraw:O,resetChanges:T}={debugDraw:!1,resetChanges:!1,...H};if(!u)return;const m=M();if(!m)return;const R=D();R&&(I.current===!0?u.forEach(F=>C({imageData:R,cell:F})):u.forEachChanged(F=>C({imageData:R,cell:F}),T),m.putImageData(R,0,0),O&&u instanceof kt&&u.forEachChunkPass((F,G)=>{F.forEach($=>{m.strokeStyle=$.haveChanges()?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.2)",m.fillStyle=m.strokeStyle,m.lineWidth=1;const it=a.multiply($.position,u.chunkSize);m.strokeRect(...it.toArray(),...u.chunkSize.toArray()),m.textAlign="right",m.fillText($.position.toArray().toString(),...a.add(it,u.chunkSize).subtractScalar(2).toArray()),m.textAlign="left",m.fillText(G.toString(),...a.add(it,a.multiply(u.chunkSize,a.down).add(a.fromArray([2,-2]))).toArray(),u.chunkSize.x),$.dirtyRect.haveChanges()&&(m.strokeStyle="red",m.fillStyle="red",m.textAlign="left",m.fillText($.countChanges().toString(),...a.add(it,a.create(2,10)).toArray()),m.strokeRect(...$.dirtyRect.toArray()))})}),z(!1))}function C(u){const{imageData:H,cell:O}=u;if(O.index===-1)return;const T=o?o({cell:O}):O.getRGBA();T&&H.data.set(T,O.index*4)}if(i)return ut.jsxs("div",{className:"grid canvas",children:[ut.jsx("canvas",{ref:g,width:i.size.x||1,height:i.size.y||1,...f}),e]})}const Ot=b.forwardRef(Dt);var j,U,A,et,Z,N,B,W;class Pt{constructor(t){y(this,j,void 0);y(this,U,void 0);y(this,A,void 0);d(this,"limitFps");y(this,et,void 0);y(this,Z,void 0);y(this,N,!0);y(this,B,void 0);y(this,W,void 0);const{gridRenderer:e,renderOptions:i,simulation:n,limitFps:o,resetChanges:f,onStep:g}={resetChanges:!0,...t};c(this,j,e),c(this,U,i),c(this,A,n),this.limitFps=o,c(this,et,f),c(this,Z,g),this._stepInternal=this._stepInternal.bind(this),c(this,B,requestAnimationFrame(this._stepInternal))}_stepInternal(t){if(s(this,N)&&s(this,W)===void 0)c(this,W,t);else{const e=s(this,W)===void 0?0:(t-s(this,W))/1e3;if((this.limitFps===void 0||e>1/this.limitFps)&&s(this,A)){const i=s(this,A).grid;if(!i)throw new Error("simulation or grid must be provided");s(this,N)&&this.step(e),s(this,Z)&&s(this,Z).call(this,{grid:i,deltaTime:e}),s(this,j)&&s(this,j).render(i,{resetChanges:!1,...s(this,U)}),s(this,N)&&s(this,et)&&i.resetChanges()}}s(this,N)&&c(this,W,t),c(this,B,requestAnimationFrame(this._stepInternal))}get simulation(){return s(this,A)}destroy(){this.stop(),this.clear(),s(this,B)!==void 0&&cancelAnimationFrame(s(this,B))}start(){s(this,N)||(c(this,N,!0),this._stepInternal(Date.now()))}stop(){c(this,N,!1),c(this,W,void 0)}clear(){var t,e;(t=s(this,A))==null||t.clear(),(e=s(this,j))==null||e.clear()}isRunning(){return s(this,N)}registerSimulation(t){s(this,A)&&(console.error("already have one"),this.destroy()),c(this,A,t)}registerGridRenderer(t,e){c(this,j,t),e&&c(this,U,e)}step(t){s(this,A)&&s(this,A).step(t)}}j=new WeakMap,U=new WeakMap,A=new WeakMap,et=new WeakMap,Z=new WeakMap,N=new WeakMap,B=new WeakMap,W=new WeakMap;function Wt(r,t){var D,w;const{limitFps:e,resetChanges:i,renderOptions:n,children:o,initSimulation:f,onStep:g,...x}={resetChanges:!0,...r},l=b.useRef(null),I=b.useRef(null),z=b.useRef();b.useImperativeHandle(t,()=>I.current),b.useEffect(()=>{if(l.current&&!I.current)return I.current=new Pt({gridRenderer:l.current,simulation:f(),limitFps:e,resetChanges:i,renderOptions:n,onStep:g}),()=>{var p;(p=I.current)==null||p.destroy(),I.current=null}},[]),b.useEffect(()=>{var p;l.current&&(It.isEqual(n,z.current)||(z.current=n,(p=I.current)==null||p.registerGridRenderer(l.current,n)))},[n]);function M(p){p.preventDefault()}return ut.jsx(Ot,{ref:l,grid:(w=(D=I.current)==null?void 0:D.simulation)==null?void 0:w.grid,children:o,onContextMenu:M,...x})}const qt=b.forwardRef(Wt);export{Nt as B,kt as C,yt as G,Gt as S,a as V,gt as a,qt as b,dt as c,vt as n,ct as r,bt as u};

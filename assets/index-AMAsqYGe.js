var F=Object.defineProperty;var X=(s,t,e)=>t in s?F(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var E=(s,t,e)=>(X(s,typeof t!="symbol"?t+"":t,e),e),C=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var P=(s,t,e)=>(C(s,t,"read from private field"),e?e.call(s):t.get(s)),S=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},R=(s,t,e,i)=>(C(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e);var M=(s,t,e)=>(C(s,t,"access private method"),e);import{r as A,j as O}from"./index-LFpIyl9S.js";import{S as B,C as U,G as V,V as f,u as j,b as _}from"./index-vpIMA6AJ.js";import"./react-spring_web.modern-0VAbX3aJ.js";var h,m,w;class k extends V{constructor(e,i){super(e);S(this,m);S(this,h,void 0);E(this,"density");this.density=i.density,R(this,h,this.density)}add(e){this.density+=e,this.grid.registerChanged(this)}step(e){M(this,m,w).call(this,20,e),this.density*=.99,this.density<1e-5?this.density=0:(this.grid.registerChanged(this.dir.NW()),this.grid.registerChanged(this.dir.SE())),R(this,h,this.density)}getRGBA(){return[255,0,100,Math.min(this.density,1)*255]}}h=new WeakMap,m=new WeakSet,w=function(e,i){const n=i*e*this.grid.size.x*this.grid.size.y,r=this.dir.N(),c=this.dir.E(),u=this.dir.S(),l=this.dir.W();this.density=(P(this,h)+n*(((l==null?void 0:l.density)||0)+((c==null?void 0:c.density)||0)+((r==null?void 0:r.density)||0)+((u==null?void 0:u.density)||0)))/(1+4*n)};class L extends B{createGrid(t){return new U({...t,createEmpty:e=>new k(e,{density:0})})}set_bnd(t,e,i){const n=this.grid.xy2index;for(let r=1;r<=t;r++)i[n(0,r)]=e==1?-i[n(1,r)]:i[n(1,r)],i[n(t+1,r)]=e==1?-i[n(t,r)]:i[n(t,r)],i[n(r,0)]=e==2?-i[n(r,1)]:i[n(r,1)],i[n(r,t+1)]=e==2?-i[n(r,t)]:i[n(r,t)];i[n(0,0)]=.5*(i[n(1,0)]+i[n(0,1)]),i[n(0,t+1)]=.5*(i[n(1,t+1)]+i[n(0,t)]),i[n(t+1,0)]=.5*(i[n(t,0)]+i[n(t+1,1)]),i[n(t+1,t+1)]=.5*(i[n(t,t+1)]+i[n(t+1,t)])}diffuse(t,e,i,n,r,c,u){const l=e,a=this.grid.xy2index.bind(this.grid),g=u*c*t*e;for(let y=0;y<20;y++){for(let d=1;d<=t;d++)for(let o=1;o<=e;o++)n[a(d,o)]=(r[a(d,o)]+g*(n[a(d-1,o)]+n[a(d+1,o)]+n[a(d,o-1)]+n[a(d,o+1)]))/(1+4*g);this.set_bnd(l,i,n)}}step(t){this.grid.forEachChangedChunkPass(e=>{e.forEach(i=>{if(!i.haveChanges())return;const n=i.getAllChanges({resetChanges:!1});i.resetChanges(),n.forEach(r=>r.step(t))})},!1)}}function K(){const s=f.create(256,192),t=A.useRef(null),e=A.useRef(void 0),[i,n]=j(void 0),[r,c]=j(f.create(0,0));function u(){const o=new L({gridOptions:{size:s}});return o.clear(),o}function l(){n("add")}function a(){n(void 0),e.current=void 0}function g(o){const v=o.target,{x:p,y:z,width:G,height:b}=v.getBoundingClientRect(),D=f.create(p,z),I=f.create(G,b);c(f.create(o.clientX,o.clientY).subtract(D).divide(I).multiply(s).floor())}function y({grid:o}){d(o)}function d(o){if(i.current===void 0)return;(e.current?o.getCellsInLine(e.current,r.current,{excludeStart:!0}):[o.getAtPosition(r.current)]).forEach(p=>{p&&i.current==="add"&&p.add(4)}),e.current=r.current}return O.jsx("div",{className:"route fluid",children:O.jsx(_,{ref:t,resetChanges:!1,defaultRenderOptions:{pixelScale:2},initSimulation:u,onStep:y,onPointerDown:l,onPointerUp:a,onPointerMove:g})})}export{K as default};

var T=Object.defineProperty;var B=(s,t,e)=>t in s?T(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var S=(s,t,e)=>(B(s,typeof t!="symbol"?t+"":t,e),e),P=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var r=(s,t,e)=>(P(s,t,"read from private field"),e?e.call(s):t.get(s)),R=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},N=(s,t,e,i)=>(P(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e);var F=(s,t,e)=>(P(s,t,"access private method"),e);import{r as I,j}from"./index-9Jq22hKg.js";function D(s){const[t,e]=I.useState(s),i=I.useRef(t);return[i,h=>{h instanceof Function?(i.current=h(i.current),e(h)):(i.current=h,e(h))}]}class H{constructor(t){S(this,"grid");S(this,"index");S(this,"position");S(this,"dir",{NW:()=>this.getNeighbourInDirection(f.NW),N:()=>this.getNeighbourInDirection(f.N),NE:()=>this.getNeighbourInDirection(f.NE),E:()=>this.getNeighbourInDirection(f.E),SE:()=>this.getNeighbourInDirection(f.SE),S:()=>this.getNeighbourInDirection(f.S),SW:()=>this.getNeighbourInDirection(f.SW),W:()=>this.getNeighbourInDirection(f.W)});this.grid=t,this.index=-1,this.position=new n(0,0)}getNeighbourInDirection(t){if(this.position)return this.grid.getAtPosition(this.position.add(t))}getNeighbourhood(){const t=[];return U.forEach(e=>{const i=this.getNeighbourInDirection(e);t.push(i)}),t}getLineTo(t,e){return this.grid.getPositionsInLine(this.position,t,e)}swapWith(t){this.grid.swap(this,t)}getRGBA(){return[0,0,0,0]}}var E,b;class O{constructor(t){S(this,"size");S(this,"alternateRows");S(this,"createEmpty");R(this,E,void 0);R(this,b,void 0);const{size:e,alternateRows:i,createEmpty:u}={alternateRows:!1,...t};N(this,E,[]),N(this,b,new Set([])),this.size=e,this.alternateRows=i,this.createEmpty=u,this.clear()}clear(){for(let t=0;t<this.size.x*this.size.y;t++)this.setAtIndex(t,this.createEmpty(this))}indexOf(t){return t?t.index:-1}positionOf(t){if(t)return t.position}forEach(t,e){const{alternateRowDirections:i,evenRows:u,oddRows:h,evenCols:c,oddCols:l}={evenRows:!0,oddRows:!0,evenCols:!0,oddCols:!0,...e},y=new Set,A=r(this,E);let k=(d,z)=>{const x=this.position2index(new n(d,z)),o=A[x];if(!o||y.has(o))return;if(t(o,x)===!1)return!1;y.add(o)};for(let d=0;d<this.size.y;d++){const z=d%2;if(z===0&&!u)continue;if(z===1&&!h)continue;let x;if(i&&d%2===0&&Math.random()<.5){for(let o=this.size.x-1;o>=0;o--){const p=o%2;if(!(p===0&&!c)&&!(p===1&&!l)&&(x=k(o,d),x===!1))break}if(x===!1)break;continue}for(let o=0;o<this.size.x;o++){const p=o%2;if(!(p===0&&!c)&&!(p===1&&!l)&&(x=k(o,d),x===!1))break}if(x===!1)break}}map(t){return r(this,E).map(t)}forEachChanged(t,e=!0){r(this,b).forEach(i=>t(i)),e&&r(this,b).clear()}position2index(t){const{x:e,y:i}=t;return e<0||e>=this.size.x||i<0||i>=this.size.y?-1:e+i*this.size.x}index2position(t){let e=Math.floor(t/this.size.x),i=t-e*this.size.x;return new n(i,e)}get(t){return this.getAtPosition(t)}set(t,e){this.setAtPosition(t,e)}getPositionsInLine(t,e,i){const{excludeStart:u,excludeEnd:h}=i||{},c=e.x-t.x,l=e.y-t.y;if(c===0&&l===0)return[t];const y=c<0?-1:1,A=l<0?-1:1,k=Math.abs(c),d=Math.abs(l),z=k>=d,x=Math.min(k,d),o=Math.max(k,d),p=x/o,a=[];for(let w=u?1:0;w<(h?o:o+1);w++){const g=Math.round(w*p);z?a.push(new n(t.x+w*y,t.y+g*A)):a.push(new n(t.x+g*y,t.y+w*A))}return a}getAtPosition(t){const e=this.position2index(t);if(e!==-1)return this.getAtIndex(e)}setAtPosition(t,e){const i=this.position2index(t);this.setAtIndex(i,e)}getAtIndex(t){return r(this,E)[t]}registerChanged(t){r(this,b).add(t)}swap(t,e){const i=this.indexOf(t),u=this.indexOf(e),h=r(this,E)[i];this.setAtIndex(i,r(this,E)[u]),this.setAtIndex(u,h)}setAtIndex(t,e){e.index=t,e.position=this.index2position(t),r(this,E)[t]=e,this.registerChanged(e)}}E=new WeakMap,b=new WeakMap;class J extends H{constructor(t){super(t)}doChunkStuff(){}}function K(s){return new Worker("/assets/worker-G1OrwRg-.js",{name:s==null?void 0:s.name})}var m,M,C,W,q;class Q extends O{constructor(e){const{chunkSize:i,workerize:u,...h}={chunkSize:new n(64,64),...e};super(h);R(this,W);S(this,"chunkSize");R(this,m,void 0);R(this,M,void 0);R(this,C,void 0);this.chunkSize=i,N(this,m,new O({size:this.size.divide(i),createEmpty:c=>new J(c)})),N(this,M,u||!1),r(this,M)&&(N(this,C,new K),r(this,C).onmessage=this.handleWorkerResponse),this.clearChunks()}handleWorkerResponse(e){console.log("worker says:",this,e.data)}clearChunks(){for(let e=0;e<r(this,m).size.x*r(this,m).size.y;e++)r(this,m).setAtIndex(e,r(this,m).createEmpty(r(this,m)))}chunkOf(e){if(!e)return;const i=e.position.divide(this.chunkSize).floor();return r(this,m).get(i)}forEachChunk(e,i){r(this,m).forEach(e,i)}mapChunks(e){return r(this,m).map(e)}forEachChunkPass(e){[[!1,!1],[!1,!0],[!0,!1],[!0,!0]].forEach(([u,h],c)=>{const l=[];this.forEachChunk(y=>{l.push(y)},{evenRows:!u,oddRows:u,evenCols:!h,oddCols:h}),r(this,M)?F(this,W,q).call(this,()=>e(l,c)):e(l,c)})}}m=new WeakMap,M=new WeakMap,C=new WeakMap,W=new WeakSet,q=function(e){r(this,C)&&r(this,C).postMessage({f:e})};class n{constructor(t=0,e=0){S(this,"x");S(this,"y");this.x=t,this.y=e}clone(){return new n(this.x,this.y)}add(t){return new n(this.x+t.x,this.y+t.y)}addScalar(t){return new n(this.x+t,this.y+t)}subtract(t){return new n(this.x-t.x,this.y-t.y)}subtractScalar(t){return new n(this.x-t,this.y-t)}multiply(t){return new n(this.x*t.x,this.y*t.y)}multiplyScalar(t){return new n(this.x*t,this.y*t)}divide(t){return new n(this.x/t.x,this.y/t.y)}divideScalar(t){return new n(this.x/t,this.y/t)}mod(t){return new n(this.x%t.x,this.y%t.y)}modScalar(t){return new n(this.x%t,this.y%t)}abs(){return new n(Math.abs(this.x),Math.abs(this.y))}round(){return new n(Math.round(this.x),Math.round(this.y))}floor(){return new n(Math.floor(this.x),Math.floor(this.y))}ceil(){return new n(Math.ceil(this.x),Math.ceil(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.length();return t===0?n.zero():this.multiplyScalar(1/t)}dot(t){const e=this.multiply(t);return e.x+e.y}isEqual(t){return this.x===t.x&&this.y===t.y}isNear(t,e=.001){const i=this.subtract(t).abs();return i.x<=e&&i.y<=e}toArray(){return[this.x,this.y]}static fromArray([t,e]){return new n(t,e)}static zero(){return new n}static one(){return new n(1,1)}static up(){return new n(0,-1)}static down(){return new n(0,1)}static left(){return new n(-1,0)}static right(){return new n(-1,0)}static random(){return new n(Math.random(),Math.random())}}const f={NW:new n(-1,-1),N:new n(0,-1),NE:new n(1,-1),E:new n(1,0),SE:new n(1,1),S:new n(0,1),SW:new n(-1,1),W:new n(-1,0)},U=[f.NW,f.N,f.NE,f.W,f.E,f.SW,f.S,f.SE];function Z(s){const{children:t,grid:e,debugDraw:i,pickColor:u,...h}={debugDraw:!1,...s},c=I.useRef(),l=I.useRef(null),y=I.useRef(),[A,k]=D(!0);I.useEffect(()=>{if(e)return k(!0),x(),o(),c.current=requestAnimationFrame(o),()=>{c.current!==void 0&&cancelAnimationFrame(c.current)}},[i,e]);function d(){return l.current?l.current.getContext("2d"):null}function z(){if(y.current)return y.current;if(!e)return;const a=d();if(a)return y.current=a.createImageData(...e.size.toArray()),y.current}function x(){const a=z();a&&(a.data.fill(0),k(!0))}function o(){if(!e)return;const a=d();if(!a)return;const w=z();w&&(A.current===!0?e.forEach(g=>p({imageData:w,cell:g})):e.forEachChanged(g=>p({imageData:w,cell:g})),a.putImageData(w,0,0),i&&e instanceof Q&&(a.strokeStyle="white",a.fillStyle="white",a.lineWidth=.25,a.textAlign="right",e.forEachChunkPass((g,L)=>{g.forEach(G=>{const v=G.position.multiply(e.chunkSize);a.strokeRect(...v.toArray(),...e.chunkSize.toArray()),a.fillText(G.position.toArray().toString(),...v.add(e.chunkSize).subtractScalar(2).toArray()),a.fillText(L.toString(),...v.add(e.chunkSize.divideScalar(2)).toArray())})})),k(!1),c.current=requestAnimationFrame(o))}function p(a){const{imageData:w,cell:g}=a;g.index!==-1&&e&&w.data.set(u?u({cell:g}):g.getRGBA(),g.index*4)}return e?j.jsxs("div",{className:"grid canvas",children:[j.jsx("canvas",{ref:l,width:e.size.x,height:e.size.y,...h}),t]}):null}export{Q as C,H as G,n as V,Z as a,O as b,U as n,D as u};

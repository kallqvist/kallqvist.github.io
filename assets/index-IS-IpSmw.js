var M=Object.defineProperty;var O=(n,t,e)=>t in n?M(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var d=(n,t,e)=>(O(n,typeof t!="symbol"?t+"":t,e),e),W=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var g=(n,t,e)=>(W(n,t,"read from private field"),e?e.call(n):t.get(n)),y=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},A=(n,t,e,i)=>(W(n,t,"write to private field"),i?i.call(n,e):t.set(n,e),e);import{r as N,j as C}from"./index-O0Fl2C7K.js";function j(n){const[t,e]=N.useState(n),i=N.useRef(t);return[i,r=>{r instanceof Function?(i.current=r(i.current),e(r)):(i.current=r,e(r))}]}class G{constructor(t){d(this,"grid");d(this,"index");d(this,"position");d(this,"dir",{NW:()=>this.getNeighbourInDirection(o.NW),N:()=>this.getNeighbourInDirection(o.N),NE:()=>this.getNeighbourInDirection(o.NE),E:()=>this.getNeighbourInDirection(o.E),SE:()=>this.getNeighbourInDirection(o.SE),S:()=>this.getNeighbourInDirection(o.S),SW:()=>this.getNeighbourInDirection(o.SW),W:()=>this.getNeighbourInDirection(o.W)});this.grid=t,this.index=-1,this.position=new a(0,0)}getPosition(){return this.grid.positionOf(this)}getNeighbourInDirection(t){if(this.position)return this.grid.getAtPosition(this.position.add(t))}getNeighbourhood(){const t=[];return P.forEach(e=>{const i=this.getNeighbourInDirection(e);i&&t.push(i)}),t}swapWith(t){this.grid.swap(this,t)}getRGBA(){return[0,0,0,0]}}var x,I;class q{constructor(t){d(this,"width");d(this,"height");d(this,"alternateRows");d(this,"createEmpty");y(this,x,void 0);y(this,I,void 0);const{width:e,height:i,alternateRows:c,createEmpty:r}={alternateRows:!1,...t};A(this,x,[]),A(this,I,new Set([])),this.width=e,this.height=i,this.alternateRows=c,this.createEmpty=r,this.clear()}clear(){for(let t=0;t<this.width*this.height;t++)this.setAtIndex(t,this.createEmpty(this))}indexOf(t){return t?t.index:-1}positionOf(t){if(t)return t.position}forEach(t,e){const{alternateRows:i,freeze:c}=e||{},r=new Set,l=c?g(this,x).map(s=>Object.assign(Object.create(Object.getPrototypeOf(s)),s)):g(this,x);let p=(s,h)=>{const m=this.position2index(new a(s,h)),w=l[m];!w||r.has(w)||t(w,m)===!1||r.add(w)};for(let s=0;s<this.height;s++){if(i&&s%2===0&&Math.random()<.5){for(let h=this.width-1;h>=0;h--)p(h,s);continue}for(let h=0;h<this.width;h++)p(h,s)}}map(t){return g(this,x).map(t)}forEachChanged(t,e=!0){g(this,I).forEach(i=>t(i)),e&&g(this,I).clear()}position2index(t){const{x:e,y:i}=t;return e<0||e>=this.width||i<0||i>=this.height?-1:e+i*this.width}index2position(t){let e=Math.floor(t/this.width),i=t-e*this.width;return new a(i,e)}get(t){return this.getAtPosition(t)}set(t,e){this.setAtPosition(t,e)}getPositionsInLine(t,e,i){const{excludeStart:c,excludeEnd:r}=i||{},l=e.x-t.x,p=e.y-t.y;if(l===0&&p===0)return[t];const s=l<0?-1:1,h=p<0?-1:1,m=Math.abs(l),w=Math.abs(p),D=m>=w,b=Math.min(m,w),u=Math.max(m,w),f=b/u,E=[];for(let R=c?1:0;R<(r?u:u+1);R++){const S=Math.round(R*f);D?E.push(new a(t.x+R*s,t.y+S*h)):E.push(new a(t.x+S*s,t.y+R*h))}return E}getAtPosition(t){const e=this.position2index(t);if(e!==-1)return this.getAtIndex(e)}setAtPosition(t,e){const i=this.position2index(t);this.setAtIndex(i,e)}getAtIndex(t){return g(this,x)[t]}registerChanged(t){g(this,I).add(t)}swap(t,e){const i=this.indexOf(t),c=this.indexOf(e),r=g(this,x)[i];this.setAtIndex(i,g(this,x)[c]),this.setAtIndex(c,r)}setAtIndex(t,e){e.index=t,e.position=this.index2position(t),g(this,x)[t]=e,this.registerChanged(e)}}x=new WeakMap,I=new WeakMap;class a{constructor(t,e){d(this,"x");d(this,"y");this.x=t,this.y=e}add(t){return new a(this.x+t.x,this.y+t.y)}}const o={NW:new a(-1,-1),N:new a(0,-1),NE:new a(1,-1),E:new a(1,0),SE:new a(1,1),S:new a(0,1),SW:new a(-1,1),W:new a(-1,0)},P=[o.NW,o.N,o.NE,o.W,o.E,o.SW,o.S,o.SE];function L(n){const{grid:t,pickColor:e,...i}=n,c=N.useRef(),r=N.useRef(null),l=N.useRef(),[p,s]=j(!0);N.useEffect(()=>(c.current=requestAnimationFrame(D),()=>{c.current!==void 0&&cancelAnimationFrame(c.current)}),[]),N.useEffect(()=>{t&&(s(!0),w(),D())},[t]);function h(){return r.current?r.current.getContext("2d"):null}function m(){if(l.current)return l.current;if(!t)return;const u=h();if(u)return l.current=u.createImageData(t.width,t.height),l.current}function w(){const u=m();u&&(u.data.fill(0),s(!0))}function D(){if(!t)return;const u=h();if(!u)return;const f=m();f&&(p.current===!0?t.forEach(E=>b(f,E)):t.forEachChanged(E=>b(f,E)),u.putImageData(f,0,0),s(!1),c.current=requestAnimationFrame(D))}function b(u,f){f.index!==-1&&t&&u.data.set(e?e(f):f.getRGBA(),f.index*4)}return t?C.jsx("div",{className:"grid canvas",children:C.jsx("canvas",{ref:r,width:t.width,height:t.height,...i})}):null}export{G,a as V,q as a,L as b,P as n,j as u};

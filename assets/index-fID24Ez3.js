var fe=Object.defineProperty;var pe=(s,e,t)=>e in s?fe(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var a=(s,e,t)=>(pe(s,typeof e!="symbol"?e+"":e,t),t),B=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var h=(s,e,t)=>(B(s,e,"read from private field"),t?t.call(s):e.get(s)),R=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},v=(s,e,t,i)=>(B(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t);var ee=(s,e,t,i)=>({set _(r){v(s,e,r,t)},get _(){return h(s,e,i)}}),te=(s,e,t)=>(B(s,e,"access private method"),t);import{r as m,_ as se,j as l}from"./index-5hPm0rjp.js";import{G as ge,V as f,a as we,u as I,b as Me}from"./index-AWYMqqOQ.js";class O extends ge{constructor(t,i){super(t,i);a(this,"shouldTryAwakeNeighbours");a(this,"index",-1);a(this,"position",new f(0,0));a(this,"brushSize",4);a(this,"brushFillRate",.05);a(this,"maxSpeed",8);a(this,"acceleration",.4);a(this,"velocity",0);const{shouldTryAwakeNeighbours:r}={shouldTryAwakeNeighbours:!0,...i};this.shouldTryAwakeNeighbours=r,this.maxSpeed=8,this.acceleration=.4,this.velocity=0}die(){this.grid.set(this.position,new k(this.grid))}}class k extends O{constructor(t){super(t,{isEmpty:!0});a(this,"brushSize",2);a(this,"brushFillRate",1);this.sleep()}getRGBA(){return[50,50,50,255]}awake(){}step(){}}class z extends O{}class b extends O{constructor(t,i){super(t,i);a(this,"numFramesOfHorizontalMovement",0);a(this,"maxFramesOfHorizontalMovement",100+Math.random()*25);a(this,"dispersionRate");a(this,"fallDirection");a(this,"erosionFactor");const{dispersionRate:r,fallDirection:c,erosionFactor:n}=i||{};this.dispersionRate=r||8,this.fallDirection=c||1,this.erosionFactor=n||.03}step(){var n,w;let t=!1;const i=[-this.dispersionRate,this.dispersionRate];Math.random()>.5&&i.reverse(),this.shouldTryAwakeNeighbours&&!this.isSleeping()&&i.every(S=>{const u=this.getNeighbourInDirection(new f(S,0));u!=null&&u.empty||u==null||u.awake(),this.erosionFactor>0&&u instanceof T&&Math.random()<this.erosionFactor&&this.swapWith(u)});const r=this.getNeighbourInDirection(new f(0,this.fallDirection)),c=this.getNeighbourInDirection(new f(0,-this.fallDirection));r!=null&&r.empty?(this.swapWith(r),t=!0,this.numFramesOfHorizontalMovement=0):this.numFramesOfHorizontalMovement<=this.maxFramesOfHorizontalMovement&&(c instanceof b&&Math.random()<1e-4?this.swapWith(c):i.every(S=>{const u=this.grid;return u.getPositionsInLine(this.position,this.position.add(new f(S,0)),{excludeStart:!0}).every(W=>{const d=u.getAtPosition(W);return d!=null&&d.empty?(this.swapWith(d),t=!0,this.numFramesOfHorizontalMovement++,!1):!(d instanceof z)}),!t})),t||((n=this.dir.W())!=null&&n.empty||(w=this.dir.E())!=null&&w.empty?this.die():this.sleep())}}var y,G;class T extends z{constructor(){super(...arguments);R(this,y,0);R(this,G,100)}step(){let t=!1;const i=[-1,1];Math.random()>=.5&&i.reverse();const r=this.dir.S();r!=null&&r.empty||r instanceof b?(this.swapWith(r),t=!0):this.isSleeping()||i.every(c=>{const n=this.getNeighbourInDirection(new f(c,1));return n!=null&&n.empty||n instanceof b?(this.swapWith(n),t=!0,!1):!0}),t?(i.every(c=>{const n=this.getNeighbourInDirection(new f(c,0));return n!=null&&n.empty||n==null||n.awake(),!0}),v(this,y,0)):(ee(this,y)._++,h(this,y)>=h(this,G)&&this.sleep())}}y=new WeakMap,G=new WeakMap;class xe extends T{getRGBA(){const e=Math.random()*20;return[191-e,155-e,123-e,255]}}class C extends b{}class E extends C{constructor(e,t){super(e,{...t,dispersionRate:3})}getRGBA(){return[46,137,255,Math.round(Math.random()*100)+155]}die(){this.grid.set(this.position,new re(this.grid))}}class Re extends z{constructor(t,i){super(t,{shouldTryAwakeNeighbours:!1,...i});a(this,"brushSize",2);a(this,"brushFillRate",1);this.sleep()}awake(){}step(){}}class ve extends Re{getRGBA(){return[100,100,100,255]}}class ie extends b{constructor(e,t){super(e,{fallDirection:-1,dispersionRate:3,erosionFactor:0,shouldTryAwakeNeighbours:!1,...t})}step(){const e=this.dir.N();if(e instanceof C){this.swapWith(e),this.numFramesOfHorizontalMovement=0;return}super.step()}}class ye extends ie{getRGBA(){return[90,90,90,Math.round(Math.random()*185)+70]}}class re extends ie{getRGBA(){return[255,255,255,Math.round(Math.random()*100)+55]}die(){this.grid.set(this.position,Math.random()<.05?new E(this.grid):new k(this.grid))}}class q extends T{step(){this.getNeighbourhood().map(i=>i.empty?.5:i instanceof q?-1:i instanceof z?2:i instanceof C?1:0).reduce((i,r)=>i+r)>0&&Math.random()<.005?this.grid.set(this.position,new E(this.grid)):super.step()}getRGBA(){const e=Math.random()*20;return[220-e,220-e,255,255]}}var g,x,N,ne;class be{constructor(e){R(this,N);R(this,g,void 0);R(this,x,!0);a(this,"materialPalette");v(this,g,new we({...e,createEmpty:t=>new k(t)})),this.materialPalette=te(this,N,ne).call(this,h(this,g))}isRunning(){return h(this,x)}start(){v(this,x,!0)}stop(){v(this,x,!1)}restart(){this.stop(),h(this,g).clear(),this.start()}getGrid(){return h(this,g)}step(){if(!h(this,x))return;h(this,g).forEach(t=>{t.empty||t.step(-1)},{alternateRows:!0})}}g=new WeakMap,x=new WeakMap,N=new WeakSet,ne=function(e){return{empty:()=>new k(e),sand:()=>new xe(e),water:()=>new E(e),stone:()=>new ve(e),smoke:()=>new ye(e),steam:()=>new re(e),snow:()=>new q(e)}};function ke(){var J;const t=m.useRef(null),i=m.useRef(null),r=m.useRef(),c=m.useRef(),n=m.useRef(),w=m.useRef(void 0),[S,u]=I(!1),[L,W]=I([0,0]),[d,oe]=I("sand"),[V,ae]=m.useState(!1),[ue,ce]=m.useState([]);m.useEffect(()=>(r.current=new be({width:320,height:180}),c.current=r.current.getGrid(),ce(se.keys(r.current.materialPalette)),U(),n.current=requestAnimationFrame(X),()=>{n.current!==void 0&&cancelAnimationFrame(n.current)}),[]);function he(o){o.preventDefault()}function le(o){const M=o.target,{x:F,y:p,width:D,height:K}=M.getBoundingClientRect();W([(o.clientX-F)/D,(o.clientY-p)/K])}function X(o){var p;const M=r.current;if(!M)return;const F=M.getGrid();me(F),M.step(),(p=t.current)==null||p.render(),n.current=requestAnimationFrame(X)}function de(){u(!0)}function Y(){u(!1),w.current=void 0}function me(o){if(!S.current||!d.current)return;const[M,F]=L.current,p=new f(Math.floor(M*320),Math.floor(F*180)),D=r.current;if(!D)return;const j=D.materialPalette[d.current];if(!j)return;const A=j(),Q=Math.floor(A.brushSize);(w.current?o.getPositionsInLine(w.current,p):[p]).every(Z=>{for(let P=-Q;P<A.brushSize;P++)for(let H=-Q;H<A.brushSize;H++){if(Math.random()>A.brushFillRate)continue;const _=Z.x+H;if(_<0)continue;const $=Z.y+P;$<0||o.setAtPosition(new f(_,$),j())}return!0}),w.current=p}function U(){const o=r.current;o&&o.restart()}return l.jsxs("div",{className:"route sand",ref:i,children:[l.jsxs("div",{className:"materials",children:[l.jsx("div",{className:"material",children:"reset",onClick:U}),l.jsx("div",{className:"separator"}),se.map(ue,o=>l.jsx("div",{className:"material",children:o,onClick:()=>oe(o),style:d.current===o?{border:"1px solid white"}:void 0},o)),l.jsx("div",{className:"separator"}),l.jsxs("div",{children:[l.jsx("input",{id:"debugDraw",type:"checkbox",checked:V,onChange:o=>ae(o.target.checked)}),l.jsx("label",{htmlFor:"debugDraw",children:"debugDraw"})]})]}),l.jsx(Me,{ref:t,grid:(J=r.current)==null?void 0:J.getGrid(),debugDraw:V,onMouseDown:de,onMouseUp:Y,onMouseLeave:Y,onMouseMove:le,onContextMenu:he})]})}export{ke as default};

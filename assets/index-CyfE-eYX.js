var O=Object.defineProperty;var q=(s,t,e)=>t in s?O(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var p=(s,t,e)=>(q(s,typeof t!="symbol"?t+"":t,e),e),v=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var r=(s,t,e)=>(v(s,t,"read from private field"),e?e.call(s):t.get(s)),R=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},I=(s,t,e,i)=>(v(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e);var P=(s,t,e)=>(v(s,t,"access private method"),e);import{r as A,j as G}from"./index-Kqp9EvPw.js";function L(s){const[t,e]=A.useState(s),i=A.useRef(t);return[i,a=>{a instanceof Function?(i.current=a(i.current),e(a)):(i.current=a,e(a))}]}class B{constructor(t){p(this,"grid");p(this,"index");p(this,"position");p(this,"dir",{NW:()=>this.getNeighbourInDirection(f.NW),N:()=>this.getNeighbourInDirection(f.N),NE:()=>this.getNeighbourInDirection(f.NE),E:()=>this.getNeighbourInDirection(f.E),SE:()=>this.getNeighbourInDirection(f.SE),S:()=>this.getNeighbourInDirection(f.S),SW:()=>this.getNeighbourInDirection(f.SW),W:()=>this.getNeighbourInDirection(f.W)});this.grid=t,this.index=-1,this.position=new n(0,0)}getNeighbourInDirection(t){if(this.position)return this.grid.getAtPosition(this.position.add(t))}getNeighbourhood(){const t=[];return J.forEach(e=>{const i=this.getNeighbourInDirection(e);t.push(i)}),t}getLineTo(t,e){return this.grid.getPositionsInLine(this.position,t,e)}swapWith(t){this.grid.swap(this,t)}getRGBA(){return[0,0,0,0]}}var z,C;class F{constructor(t){p(this,"size");p(this,"alternateRows");p(this,"createEmpty");R(this,z,void 0);R(this,C,void 0);const{size:e,alternateRows:i,createEmpty:h}={alternateRows:!1,...t};I(this,z,[]),I(this,C,new Set([])),this.size=e,this.alternateRows=i,this.createEmpty=h,this.clear()}clear(){for(let t=0;t<this.size.x*this.size.y;t++)this.setAtIndex(t,this.createEmpty(this))}indexOf(t){return t?t.index:-1}positionOf(t){if(t)return t.position}forEach(t,e){const{alternateRowDirections:i,evenRows:h,oddRows:a,evenCols:u,oddCols:g}={evenRows:!0,oddRows:!0,evenCols:!0,oddCols:!0,...e},k=new Set,N=r(this,z);let E=(d,S)=>{const l=this.position2index(new n(d,S)),o=N[l];if(!o||k.has(o))return;if(t(o,l)===!1)return!1;k.add(o)};for(let d=0;d<this.size.y;d++){const S=d%2;if(S===0&&!h)continue;if(S===1&&!a)continue;let l;if(i&&d%2===0&&Math.random()<.5){for(let o=this.size.x-1;o>=0;o--){const m=o%2;if(!(m===0&&!u)&&!(m===1&&!g)&&(l=E(o,d),l===!1))break}if(l===!1)break;continue}for(let o=0;o<this.size.x;o++){const m=o%2;if(!(m===0&&!u)&&!(m===1&&!g)&&(l=E(o,d),l===!1))break}if(l===!1)break}}map(t){return r(this,z).map(t)}forEachChanged(t,e=!0){r(this,C).forEach(i=>t(i)),e&&r(this,C).clear()}position2index(t){const{x:e,y:i}=t;return e<0||e>=this.size.x||i<0||i>=this.size.y?-1:e+i*this.size.x}index2position(t){let e=Math.floor(t/this.size.x),i=t-e*this.size.x;return new n(i,e)}get(t){return this.getAtPosition(t)}set(t,e){this.setAtPosition(t,e)}getPositionsInLine(t,e,i){const{excludeStart:h,excludeEnd:a}=i||{},u=e.x-t.x,g=e.y-t.y;if(u===0&&g===0)return[t];const k=u<0?-1:1,N=g<0?-1:1,E=Math.abs(u),d=Math.abs(g),S=E>=d,l=Math.min(E,d),o=Math.max(E,d),m=l/o,c=[];for(let w=h?1:0;w<(a?o:o+1);w++){const x=Math.round(w*m);S?c.push(new n(t.x+w*k,t.y+x*N)):c.push(new n(t.x+x*k,t.y+w*N))}return c}getAtPosition(t){const e=this.position2index(t);if(e!==-1)return this.getAtIndex(e)}setAtPosition(t,e){const i=this.position2index(t);this.setAtIndex(i,e)}getAtIndex(t){return r(this,z)[t]}registerChanged(t){r(this,C).add(t)}swap(t,e){const i=this.indexOf(t),h=this.indexOf(e),a=r(this,z)[i];this.setAtIndex(i,r(this,z)[h]),this.setAtIndex(h,a)}setAtIndex(t,e){e.index=t,e.position=this.index2position(t),r(this,z)[t]=e,this.registerChanged(e)}}z=new WeakMap,C=new WeakMap;class D extends B{constructor(t){super(t)}doChunkStuff(){}}function H(s){return new Worker("/assets/worker-G1OrwRg-.js",{name:s==null?void 0:s.name})}var y,M,b,W,j;class T extends F{constructor(e){const{chunkSize:i,workerize:h,...a}={chunkSize:new n(64,64),...e};super(a);R(this,W);p(this,"chunkSize");R(this,y,void 0);R(this,M,void 0);R(this,b,void 0);this.chunkSize=i,I(this,y,new F({size:this.size.divide(i),createEmpty:u=>new D(u)})),I(this,M,h||!1),r(this,M)&&(I(this,b,new H),r(this,b).onmessage=this.handleWorkerResponse),this.clearChunks()}handleWorkerResponse(e){console.log("worker says:",this,e.data)}clearChunks(){for(let e=0;e<r(this,y).size.x*r(this,y).size.y;e++)r(this,y).setAtIndex(e,r(this,y).createEmpty(r(this,y)))}chunkOf(e){if(!e)return;const i=e.position.divide(this.chunkSize).floor();return r(this,y).get(i)}forEachChunk(e,i){r(this,y).forEach(e,i)}mapChunks(e){return r(this,y).map(e)}forEachChunkPass(e){[[!1,!1],[!1,!0],[!0,!1],[!0,!0]].forEach(([h,a])=>{const u=[];this.forEachChunk(g=>{u.push(g)},{evenRows:!h,oddRows:h,evenCols:!a,oddCols:a}),r(this,M)?P(this,W,j).call(this,()=>e(u)):e(u)})}}y=new WeakMap,M=new WeakMap,b=new WeakMap,W=new WeakSet,j=function(e){r(this,b)&&r(this,b).postMessage({f:e})};class n{constructor(t=0,e=0){p(this,"x");p(this,"y");this.x=t,this.y=e}clone(){return new n(this.x,this.y)}add(t){return new n(this.x+t.x,this.y+t.y)}addScalar(t){return new n(this.x+t,this.y+t)}subtract(t){return new n(this.x-t.x,this.y-t.y)}subtractScalar(t){return new n(this.x-t,this.y-t)}multiply(t){return new n(this.x*t.x,this.y*t.y)}multiplyScalar(t){return new n(this.x*t,this.y*t)}divide(t){return new n(this.x/t.x,this.y/t.y)}divideScalar(t){return new n(this.x/t,this.y/t)}mod(t){return new n(this.x%t.x,this.y%t.y)}modScalar(t){return new n(this.x%t,this.y%t)}abs(){return new n(Math.abs(this.x),Math.abs(this.y))}round(){return new n(Math.round(this.x),Math.round(this.y))}floor(){return new n(Math.floor(this.x),Math.floor(this.y))}ceil(){return new n(Math.ceil(this.x),Math.ceil(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.length();return t===0?n.zero():this.multiplyScalar(1/t)}dot(t){const e=this.multiply(t);return e.x+e.y}isEqual(t){return this.x===t.x&&this.y===t.y}isNear(t,e=.001){const i=this.subtract(t).abs();return i.x<=e&&i.y<=e}toArray(){return[this.x,this.y]}static fromArray([t,e]){return new n(t,e)}static zero(){return new n}static one(){return new n(1,1)}static up(){return new n(0,-1)}static down(){return new n(0,1)}static left(){return new n(-1,0)}static right(){return new n(-1,0)}static random(){return new n(Math.random(),Math.random())}}const f={NW:new n(-1,-1),N:new n(0,-1),NE:new n(1,-1),E:new n(1,0),SE:new n(1,1),S:new n(0,1),SW:new n(-1,1),W:new n(-1,0)},J=[f.NW,f.N,f.NE,f.W,f.E,f.SW,f.S,f.SE];function U(s){const{children:t,grid:e,debugDraw:i,pickColor:h,...a}={debugDraw:!1,...s},u=A.useRef(),g=A.useRef(null),k=A.useRef(),[N,E]=L(!0);A.useEffect(()=>{if(e)return E(!0),l(),o(),u.current=requestAnimationFrame(o),()=>{u.current!==void 0&&cancelAnimationFrame(u.current)}},[i,e]);function d(){return g.current?g.current.getContext("2d"):null}function S(){if(k.current)return k.current;if(!e)return;const c=d();if(c)return k.current=c.createImageData(...e.size.toArray()),k.current}function l(){const c=S();c&&(c.data.fill(0),E(!0))}function o(){if(!e)return;const c=d();if(!c)return;const w=S();w&&(N.current===!0?e.forEach(x=>m({imageData:w,cell:x})):e.forEachChanged(x=>m({imageData:w,cell:x})),c.putImageData(w,0,0),i&&e instanceof T&&(c.strokeStyle="white",c.lineWidth=.25,e.forEachChunk(x=>{c.strokeRect(...x.position.multiply(e.chunkSize).toArray(),...e.chunkSize.toArray())})),E(!1),u.current=requestAnimationFrame(o))}function m(c){const{imageData:w,cell:x}=c;x.index!==-1&&e&&w.data.set(h?h({cell:x}):x.getRGBA(),x.index*4)}return e?G.jsxs("div",{className:"grid canvas",children:[G.jsx("canvas",{ref:g,width:e.size.x,height:e.size.y,...a}),t]}):null}export{T as C,B as G,n as V,U as a,F as b,J as n,L as u};

var v=Object.defineProperty;var P=(r,t,e)=>t in r?v(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var g=(r,t,e)=>(P(r,typeof t!="symbol"?t+"":t,e),e),W=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var w=(r,t,e)=>(W(r,t,"read from private field"),e?e.call(r):t.get(r)),M=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},S=(r,t,e,i)=>(W(r,t,"write to private field"),i?i.call(r,e):t.set(r,e),e);import{r as E,j as C}from"./index-k5VurcMA.js";function F(r){const[t,e]=E.useState(r),i=E.useRef(t);return[i,s=>{s instanceof Function?(i.current=s(i.current),e(s)):(i.current=s,e(s))}]}class q{constructor(t){g(this,"grid");g(this,"index");g(this,"position");g(this,"dir",{NW:()=>this.getNeighbourInDirection(o.NW),N:()=>this.getNeighbourInDirection(o.N),NE:()=>this.getNeighbourInDirection(o.NE),E:()=>this.getNeighbourInDirection(o.E),SE:()=>this.getNeighbourInDirection(o.SE),S:()=>this.getNeighbourInDirection(o.S),SW:()=>this.getNeighbourInDirection(o.SW),W:()=>this.getNeighbourInDirection(o.W)});this.grid=t,this.index=-1,this.position=new n(0,0)}getNeighbourInDirection(t){if(this.position)return this.grid.getAtPosition(this.position.add(t))}getNeighbourhood(){const t=[];return G.forEach(e=>{const i=this.getNeighbourInDirection(e);t.push(i)}),t}getLineTo(t,e){return this.grid.getPositionsInLine(this.position,t,e)}swapWith(t){this.grid.swap(this,t)}getRGBA(){return[0,0,0,0]}}var y,b;class L{constructor(t){g(this,"width");g(this,"height");g(this,"alternateRows");g(this,"createEmpty");M(this,y,void 0);M(this,b,void 0);const{width:e,height:i,alternateRows:d,createEmpty:s}={alternateRows:!1,...t};S(this,y,[]),S(this,b,new Set([])),this.width=e,this.height=i,this.alternateRows=d,this.createEmpty=s,this.clear()}clear(){for(let t=0;t<this.width*this.height;t++)this.setAtIndex(t,this.createEmpty(this))}indexOf(t){return t?t.index:-1}positionOf(t){if(t)return t.position}forEach(t,e){const{alternateRows:i}=e||{},d=new Set,s=w(this,y);let x=(a,u)=>{const h=this.position2index(new n(a,u)),l=s[h];if(!l||d.has(l))return;if(t(l,h)===!1)return!1;d.add(l)};for(let a=0;a<this.height;a++){let u;if(i&&a%2===0&&Math.random()<.5){for(let h=this.width-1;h>=0&&(u=x(h,a),u!==!1);h--);if(u===!1)break;continue}for(let h=0;h<this.width&&(u=x(h,a),u!==!1);h++);if(u===!1)break}}map(t){return w(this,y).map(t)}forEachChanged(t,e=!0){w(this,b).forEach(i=>t(i)),e&&w(this,b).clear()}position2index(t){const{x:e,y:i}=t;return e<0||e>=this.width||i<0||i>=this.height?-1:e+i*this.width}index2position(t){let e=Math.floor(t/this.width),i=t-e*this.width;return new n(i,e)}get(t){return this.getAtPosition(t)}set(t,e){this.setAtPosition(t,e)}getPositionsInLine(t,e,i){const{excludeStart:d,excludeEnd:s}=i||{},x=e.x-t.x,a=e.y-t.y;if(x===0&&a===0)return[t];const u=x<0?-1:1,h=a<0?-1:1,l=Math.abs(x),p=Math.abs(a),R=l>=p,I=Math.min(l,p),N=Math.max(l,p),f=I/N,c=[];for(let m=d?1:0;m<(s?N:N+1);m++){const A=Math.round(m*f);R?c.push(new n(t.x+m*u,t.y+A*h)):c.push(new n(t.x+A*u,t.y+m*h))}return c}getAtPosition(t){const e=this.position2index(t);if(e!==-1)return this.getAtIndex(e)}setAtPosition(t,e){const i=this.position2index(t);this.setAtIndex(i,e)}getAtIndex(t){return w(this,y)[t]}registerChanged(t){w(this,b).add(t)}swap(t,e){const i=this.indexOf(t),d=this.indexOf(e),s=w(this,y)[i];this.setAtIndex(i,w(this,y)[d]),this.setAtIndex(d,s)}setAtIndex(t,e){e.index=t,e.position=this.index2position(t),w(this,y)[t]=e,this.registerChanged(e)}}y=new WeakMap,b=new WeakMap;class n{constructor(t,e){g(this,"x");g(this,"y");this.x=t,this.y=e}clone(){return new n(this.x,this.y)}add(t){return new n(this.x+t.x,this.y+t.y)}subtract(t){return new n(this.x-t.x,this.y-t.y)}multiply(t){return new n(this.x*t.x,this.y*t.y)}multiplyScalar(t){return new n(this.x*t,this.y*t)}divide(t){return new n(this.x/t.x,this.y/t.y)}divideScalar(t){return new n(this.x/t,this.y/t)}abs(){return new n(Math.abs(this.x),Math.abs(this.y))}round(){return new n(Math.round(this.x),Math.round(this.y))}floor(){return new n(Math.floor(this.x),Math.floor(this.y))}ceil(){return new n(Math.ceil(this.x),Math.ceil(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.length();return t===0?n.zero():this.multiplyScalar(1/t)}dot(t){const e=this.multiply(t);return e.x+e.y}isEqual(t){return this.x===t.x&&this.y===t.y}isNear(t,e=.001){const i=this.subtract(t).abs();return i.x<=e&&i.y<=e}static zero(){return new n(0,0)}static one(){return new n(1,1)}static up(){return new n(0,-1)}static down(){return new n(0,1)}static left(){return new n(-1,0)}static right(){return new n(-1,0)}static random(){return new n(Math.random(),Math.random())}}const o={NW:new n(-1,-1),N:new n(0,-1),NE:new n(1,-1),E:new n(1,0),SE:new n(1,1),S:new n(0,1),SW:new n(-1,1),W:new n(-1,0)},G=[o.NW,o.N,o.NE,o.W,o.E,o.SW,o.S,o.SE];function z(r){const{children:t,grid:e,pickColor:i,...d}=r,s=E.useRef(),x=E.useRef(null),a=E.useRef(),[u,h]=F(!0);E.useEffect(()=>(s.current=requestAnimationFrame(I),()=>{s.current!==void 0&&cancelAnimationFrame(s.current)}),[]),E.useEffect(()=>{e&&(h(!0),R(),I())},[e]);function l(){return x.current?x.current.getContext("2d"):null}function p(){if(a.current)return a.current;if(!e)return;const f=l();if(f)return a.current=f.createImageData(e.width,e.height),a.current}function R(){const f=p();f&&(f.data.fill(0),h(!0))}function I(){if(!e)return;const f=l();if(!f)return;const c=p();c&&(u.current===!0?e.forEach(m=>N(c,m)):e.forEachChanged(m=>N(c,m)),f.putImageData(c,0,0),h(!1),s.current=requestAnimationFrame(I))}function N(f,c){c.index!==-1&&e&&f.data.set(i?i(c):c.getRGBA(),c.index*4)}return e?C.jsxs("div",{className:"grid canvas",children:[C.jsx("canvas",{ref:x,width:e.width,height:e.height,...d}),t]}):null}export{q as G,n as V,L as a,z as b,G as n,F as u};

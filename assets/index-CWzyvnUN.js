var L=Object.defineProperty;var U=(r,t,n)=>t in r?L(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n;var A=(r,t,n)=>(U(r,typeof t!="symbol"?t+"":t,n),n),y=(r,t,n)=>{if(!t.has(r))throw TypeError("Cannot "+n)};var m=(r,t,n)=>(y(r,t,"read from private field"),n?n.call(r):t.get(r)),j=(r,t,n)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,n)},R=(r,t,n,l)=>(y(r,t,"write to private field"),l?l.call(r,n):t.set(r,n),n);import{r as u,j as s,F as V,i as z,l as N,m as X}from"./index-5hPm0rjp.js";import{G as Y,a as J,u as h,b as K,V as b}from"./index-AWYMqqOQ.js";class E extends Y{constructor(n){super(n);A(this,"age",0);this.sleep(),this.color=this.getRGBA()}getRGBA(){return[255,0,100,255]}}var c,a;class Q{constructor(t){j(this,c,void 0);j(this,a,!1);R(this,c,new J({...t,createEmpty:n=>new E(n)}))}start(){R(this,a,!0)}stop(){R(this,a,!1)}isRunning(){return m(this,a)}getGrid(){return m(this,c)}restart(){this.stop(),m(this,c).clear()}step(t){m(this,c).forEach(n=>{n.age+=t,n.color})}}c=new WeakMap,a=new WeakMap;function tt(){const n=.08333333333333333,l=u.useRef(null),o=u.useRef(),[P,k]=h(void 0),p=u.useRef(),g=u.useRef(void 0),[S,T]=h(void 0),[F,q]=h(new b(0,0)),[x,B]=h(!0),[v,M]=h(-1);u.useEffect(()=>(o.current=new Q({width:160,height:90}),k(o.current.getGrid()),C(),p.current=requestAnimationFrame(w),()=>{p.current!==void 0&&cancelAnimationFrame(p.current)}),[]),u.useEffect(()=>{const e=o.current;e&&(x.current?e.start():e.stop())},[x]);function H(e){e.preventDefault()}function I(){T(void 0),g.current=void 0}function O(e){const d=e.target,{x:f,y:i,width:G,height:D}=d.getBoundingClientRect();q(new b(Math.floor((e.clientX-f)/G*160),Math.floor((e.clientY-i)/D*90)))}function w(e){var d;if(v.current===-1)M(e);else{const f=(e-v.current)/1e3;if(f>n){const i=o.current;if(!i)return;W(i.getGrid()),x.current&&i.step(f),(d=l.current)==null||d.render(),M(e)}}p.current=requestAnimationFrame(w)}function W(e){if(S.current===void 0||!o.current)return;(g.current?e.getPositionsInLine(g.current,F.current):[F.current]).forEach(i=>{e.get(i)&&e.set(i,new E(e))}),g.current=F.current}function C(){const e=o.current;e&&e.restart()}return s.jsxs("div",{className:"route fluid",children:[s.jsxs("div",{style:{position:"absolute",top:0,width:"100%",display:"flex",justifyContent:"center",background:"black",color:"white",zIndex:100},children:[s.jsx("button",{onClick:()=>B(e=>!e),children:x.current?s.jsxs(s.Fragment,{children:[s.jsx(V,{}),"stop"]}):s.jsxs(s.Fragment,{children:[s.jsx(z,{}),"start"]})}),s.jsxs("button",{onClick:()=>{var e;return(e=o.current)==null?void 0:e.step(1)},children:[s.jsx(N,{}),"step"]}),s.jsxs("button",{onClick:()=>C(),children:[s.jsx(X,{}),"reset"]})]}),s.jsx(K,{ref:l,grid:P.current,onMouseUp:I,onMouseMove:O,onContextMenu:H})]})}export{tt as default};

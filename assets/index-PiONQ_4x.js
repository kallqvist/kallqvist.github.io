var P=Object.defineProperty;var k=(n,t,e)=>t in n?P(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var m=(n,t,e)=>(k(n,typeof t!="symbol"?t+"":t,e),e),H=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var a=(n,t,e)=>(H(n,t,"read from private field"),e?e.call(n):t.get(n)),S=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},R=(n,t,e,i)=>(H(n,t,"write to private field"),i?i.call(n,e):t.set(n,e),e);import{r as u,_ as y,j as v}from"./index-f_HU91Jt.js";function q(n,t){const[e,i,s]=n;if(t===void 0)return`hsl(${e}, ${i}%, ${s}%)`;const[r,d,l]=E(n,t);return`hsl(${r}, ${d}%, ${l}%)`}function E(n,t=[Math.round(Math.random()*10),Math.round(Math.random()*10),Math.round(Math.random()*10)]){const[e,i,s]=n,[r=0,d=0,l=0]=t||[];return[Math.min(Math.max(e+Math.round(Math.random()*(r*2))-r,0),360),Math.min(Math.max(i+Math.round(Math.random()*(d*2))-d,0),100),Math.min(Math.max(s+Math.round(Math.random()*(l*2))-l,0),100)]}var x;class Y{constructor(t,e){S(this,x,void 0);m(this,"color");m(this,"isEmpty",!1);m(this,"isUpdated",!1);m(this,"dir",{NW:()=>this.neighbourInDirection(-1,-1),N:()=>this.neighbourInDirection(0,-1),NE:()=>this.neighbourInDirection(1,-1),E:()=>this.neighbourInDirection(1,0),SE:()=>this.neighbourInDirection(1,1),S:()=>this.neighbourInDirection(0,1),SW:()=>this.neighbourInDirection(-1,1),W:()=>this.neighbourInDirection(-1,0)});const{isEmpty:i}=e||{};R(this,x,t),this.isEmpty=i||!1,this.color=q(this.getHSL())}neighbourInDirection(t,e){const i=a(this,x),[s,r]=i.XYOf(this);return i.getAtXY(s+t,r+e)}swap(t){a(this,x).swapAB(this,t)}}x=new WeakMap;class L extends Y{constructor(t){super(t,{isEmpty:!0})}getHSL(){return[50,0,20]}step(){}}class X extends Y{step(){const t=this.dir.S();if(t!=null&&t.isEmpty)return this.swap(t);const e=[-1,1];Math.random()>=.5&&e.reverse(),e.every(i=>{const s=this.neighbourInDirection(i,0);if(s!=null&&s.isEmpty)return this.swap(s),!1})}}class j extends Y{}class B extends j{step(){}}class G extends j{step(){const t=this.dir.S();if(t!=null&&t.isEmpty||t instanceof X)return this.swap(t);const e=[-1,1];Math.random()>=.5&&e.reverse(),e.every(i=>{const s=this.neighbourInDirection(i,1);if(s!=null&&s.isEmpty||s instanceof X)return this.swap(s),!1})}}class _ extends G{getHSL(){return E([27.8,31.8,58.6])}}class U extends X{getHSL(){return E([216,100,60],[5,5,3])}}var c;class V{constructor(t,e){m(this,"width");m(this,"height");S(this,c,void 0);this.width=t,this.height=e,R(this,c,[]),this.clear()}clear(){for(let t=0;t<this.width*this.height;t++)a(this,c)[t]=new L(this)}indexOf(t,e){return t?a(this,c).indexOf(t,e):-1}XYOf(t,e){const i=this.indexOf(t,e);return this.index2XY(i)}forEach(t){for(let e=a(this,c).length-1;e>=0&&t(a(this,c)[e],e)!==!1;e--);}XY2index(t,e){return t<0||t>=this.width||e<0||e>=this.height?-1:t+e*this.width}index2XY(t){let e=Math.floor(t/this.width);return[t-e*this.width,e]}get(t,e){return this.getAtXY(t,e)}set(t,e,i){this.setAtXY(t,e,i)}getAtXY(t,e){const i=this.XY2index(t,e);if(i!==-1)return this.getAtIndex(i)}setAtXY(t,e,i){const s=this.XY2index(t,e);this.setAtIndex(s,i)}getAtIndex(t){return a(this,c)[t]}setAtIndex(t,e){a(this,c)[t]=e}swapAB(t,e){const i=this.indexOf(t),s=this.indexOf(e),r=a(this,c)[i];this.setAtIndex(i,a(this,c)[s]),this.setAtIndex(s,r)}}c=new WeakMap;class z extends B{getHSL(){return E([150,5,58.6],[5,0,5])}}var g;class J{constructor(t){S(this,g,void 0);m(this,"materialPalette");const{width:e,height:i}=t,s=new V(e,i);R(this,g,s),this.materialPalette={empty:()=>new L(s),sand:()=>new _(s),water:()=>new U(s),stone:()=>new z(s)}}getGrid(){return a(this,g)}step(){a(this,g).forEach(e=>{e.step(-1)})}}g=new WeakMap;function T(){const i=u.useRef(null),s=u.useRef(null),r=u.useRef(),d=u.useRef(),l=u.useRef(!1),b=u.useRef([0,0]),A=u.useRef("sand"),[O,W]=u.useState([]),[I,$]=u.useState("sand");u.useEffect(()=>(r.current=new J({width:75,height:75}),W(y.keys(r.current.materialPalette)),d.current=requestAnimationFrame(D),()=>{d.current!==void 0&&cancelAnimationFrame(d.current)}),[]),u.useEffect(()=>{A.current=I},[I]);function C(o){if(!s.current)return;const{x:h,y:f,width:p,height:M}=s.current.getBoundingClientRect();b.current=[(o.clientX-h)/p,(o.clientY-f)/M]}function D(o){const h=r.current;if(!h)return;const f=h.getGrid();N(f),h.step(),F(f),d.current=requestAnimationFrame(D)}function F(o){const h=s.current?s.current.getContext("2d"):null;h&&o.forEach((f,p)=>{const[M,w]=o.index2XY(p);h.fillStyle=f.color,h.fillRect(M*5,w*5,5,5)})}function N(o){var w;if(!l.current||!A.current)return;const[h,f]=b.current,p=Math.floor(h*75),M=Math.floor(f*75);o.setAtXY(p,M,y.invoke((w=r.current)==null?void 0:w.materialPalette,A.current))}return v.jsxs("div",{className:"route sand",ref:i,children:[v.jsx("div",{className:"materials",children:y.map(O,o=>v.jsx("div",{children:o,onClick:()=>$(o),style:I===o?{border:"1px solid white"}:void 0},o))}),v.jsx("canvas",{ref:s,width:`${75*5}px`,height:`${75*5}px`,onMouseDown:()=>l.current=!0,onMouseUp:()=>l.current=!1,onMouseLeave:()=>l.current=!1,onMouseMove:C})]})}export{T as default};

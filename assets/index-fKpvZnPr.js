var A=(r,t,i)=>{if(!t.has(r))throw TypeError("Cannot "+i)};var h=(r,t,i)=>(A(r,t,"read from private field"),i?i.call(r):t.get(r)),w=(r,t,i)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,i)},m=(r,t,i,e)=>(A(r,t,"write to private field"),e?e.call(r,i):t.set(r,i),i);var G=(r,t,i)=>(A(r,t,"access private method"),i);import{r as O,j as b}from"./index-J3dNsBoJ.js";import{S as X,C as B,G as U,V as P,u as I,b as V}from"./index-HvhOeIDh.js";import"./react-spring_web.modern-75KWeOyp.js";var p,u,z,F;class _ extends U{constructor(i,e){super(i);w(this,z);w(this,p,void 0);w(this,u,void 0);m(this,u,e.density),m(this,p,h(this,u))}get density(){return h(this,u)}add(i){m(this,u,h(this,u)+i),this.grid.registerChanged(this)}step(i){G(this,z,F).call(this,20,i),m(this,p,h(this,u))}getRGBA(){return[255,0,100,Math.min(h(this,u),1)*255]}}p=new WeakMap,u=new WeakMap,z=new WeakSet,F=function(i,e){const n=e*i*this.grid.size.x*this.grid.size.y,s=this.dir.N(),g=this.dir.E(),d=this.dir.S(),a=this.dir.W();m(this,u,(h(this,p)+n*(((a==null?void 0:a.density)||0)+((g==null?void 0:g.density)||0)+((s==null?void 0:s.density)||0)+((d==null?void 0:d.density)||0)))/(1+4*n)),m(this,u,h(this,u)*.99),h(this,u)<1e-6&&m(this,u,0),Math.abs(h(this,p)-h(this,u))>1e-6&&(this.grid.registerChanged(this),this.grid.registerChanged(s),this.grid.registerChanged(g),this.grid.registerChanged(d),this.grid.registerChanged(a))};class k extends X{createGrid(t){return new B({...t,createEmpty:i=>new _(i,{density:0})})}set_bnd(t,i,e){const n=this.grid.xy2index;for(let s=1;s<=t;s++)e[n(0,s)]=i==1?-e[n(1,s)]:e[n(1,s)],e[n(t+1,s)]=i==1?-e[n(t,s)]:e[n(t,s)],e[n(s,0)]=i==2?-e[n(s,1)]:e[n(s,1)],e[n(s,t+1)]=i==2?-e[n(s,t)]:e[n(s,t)];e[n(0,0)]=.5*(e[n(1,0)]+e[n(0,1)]),e[n(0,t+1)]=.5*(e[n(1,t+1)]+e[n(0,t)]),e[n(t+1,0)]=.5*(e[n(t,0)]+e[n(t+1,1)]),e[n(t+1,t+1)]=.5*(e[n(t,t+1)]+e[n(t+1,t)])}advect(t,i,e,n,s,g){const d=this.grid.size.y,a=this.grid.xy2index;let l,f,E,M,R,o,y;y=g*d;for(let c=1;c<=d;c++)for(let C=1;C<=d;C++){l=c-y*n[a(c,C)],f=C-y*s[a(c,C)],l<.5&&(l=.5),l>d+.5&&(l=d+.5);const v=l,j=v+1;f<.5&&(f=.5),f>d+.5&&(f=d+.5);const S=f,D=S+1;R=l-v,E=1-R,o=f-S,M=1-o,i[a(c,C)]=E*(M*e[a(v,S)]+o*e[a(v,D)])+R*(M*e[a(j,S)]+o*e[a(j,D)])}this.set_bnd(d,t,i)}step(t){this.grid.forEachChangedChunkPass(i=>{i.forEach(e=>{e.haveChanges()&&e.forEachDirty(n=>{n.step(t)},{alternateRowDirections:!0,resetChanges:!0})})},!1)}}function H(){const r=P.create(256,192),t=O.useRef(null),i=O.useRef(void 0),[e,n]=I(void 0),[s,g]=I(P.create(0,0));function d(){const o=new k({gridOptions:{size:r}});return o.clear(),o}function a(o){o.preventDefault()}function l(){n("add")}function f(){n(void 0),i.current=void 0}function E(o){const y=o.target,{x:c,y:C,width:v,height:j}=y.getBoundingClientRect(),S=P.create(c,C),D=P.create(v,j);g(P.create(o.clientX,o.clientY).subtract(S).divide(D).multiply(r).floor())}function M({grid:o}){R(o)}function R(o){if(e.current===void 0)return;(i.current?o.getCellsInLine(i.current,s.current,{excludeStart:!0}):[o.getAtPosition(s.current)]).forEach(c=>{c&&e.current==="add"&&c.add(4)}),i.current=s.current}return b.jsx("div",{className:"route fluid",children:b.jsx(V,{ref:t,resetChanges:!1,initSimulation:d,onStep:M,onPointerDown:l,onPointerUp:f,onPointerMove:E,onContextMenu:a})})}export{H as default};

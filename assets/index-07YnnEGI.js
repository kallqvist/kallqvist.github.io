var A=(r,t,i)=>{if(!t.has(r))throw TypeError("Cannot "+i)};var l=(r,t,i)=>(A(r,t,"read from private field"),i?i.call(r):t.get(r)),w=(r,t,i)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,i)},p=(r,t,i,e)=>(A(r,t,"write to private field"),e?e.call(r,i):t.set(r,i),i);var G=(r,t,i)=>(A(r,t,"access private method"),i);import{r as O,j as I}from"./index-Lmnj-Ws3.js";import{S as X,C as B,G as U,V as P,u as b,b as V}from"./index-kz889-NO.js";import"./react-spring_web.modern-P6pRlssA.js";var R,a,z,F;class W extends U{constructor(i,e){super(i);w(this,z);w(this,R,void 0);w(this,a,void 0);p(this,a,e.density),p(this,R,l(this,a))}get density(){return l(this,a)}add(i){p(this,a,l(this,a)+i),this.grid.registerChanged(this)}step(i){G(this,z,F).call(this,20,i),p(this,a,l(this,a)*.99),l(this,a)<1e-6?p(this,a,0):(this.grid.registerChanged(this.dir.NW()),this.grid.registerChanged(this.dir.SE())),p(this,R,l(this,a))}getRGBA(){return[255,0,100,Math.min(l(this,a),1)*255]}}R=new WeakMap,a=new WeakMap,z=new WeakSet,F=function(i,e){const n=e*i*this.grid.size.x*this.grid.size.y,s=this.dir.N(),y=this.dir.E(),d=this.dir.S(),c=this.dir.W();p(this,a,(l(this,R)+n*(((c==null?void 0:c.density)||0)+((y==null?void 0:y.density)||0)+((s==null?void 0:s.density)||0)+((d==null?void 0:d.density)||0)))/(1+4*n))};class _ extends X{createGrid(t){return new B({...t,createEmpty:i=>new W(i,{density:0})})}set_bnd(t,i,e){const n=this.grid.xy2index;for(let s=1;s<=t;s++)e[n(0,s)]=i==1?-e[n(1,s)]:e[n(1,s)],e[n(t+1,s)]=i==1?-e[n(t,s)]:e[n(t,s)],e[n(s,0)]=i==2?-e[n(s,1)]:e[n(s,1)],e[n(s,t+1)]=i==2?-e[n(s,t)]:e[n(s,t)];e[n(0,0)]=.5*(e[n(1,0)]+e[n(0,1)]),e[n(0,t+1)]=.5*(e[n(1,t+1)]+e[n(0,t)]),e[n(t+1,0)]=.5*(e[n(t,0)]+e[n(t+1,1)]),e[n(t+1,t+1)]=.5*(e[n(t,t+1)]+e[n(t+1,t)])}advect(t,i,e,n,s,y){const d=this.grid.size.y,c=this.grid.xy2index;let u,h,M,E,o,C,f;f=y*d;for(let g=1;g<=d;g++)for(let m=1;m<=d;m++){u=g-f*n[c(g,m)],h=m-f*s[c(g,m)],u<.5&&(u=.5),u>d+.5&&(u=d+.5);const S=u,j=S+1;h<.5&&(h=.5),h>d+.5&&(h=d+.5);const v=h,D=v+1;o=u-S,M=1-o,C=h-v,E=1-C,i[c(g,m)]=M*(E*e[c(S,v)]+C*e[c(S,D)])+o*(E*e[c(j,v)]+C*e[c(j,D)])}this.set_bnd(d,t,i)}step(t){this.grid.forEachChangedChunkPass(i=>{i.forEach(e=>{e.haveChanges()&&e.forEachDirty(n=>{n.step(t)},{alternateRowDirections:!0,resetChanges:!0})})},!1)}}function H(){const r=P.create(256,192),t=O.useRef(null),i=O.useRef(void 0),[e,n]=b(void 0),[s,y]=b(P.create(0,0));function d(){const o=new _({gridOptions:{size:r}});return o.clear(),o}function c(){n("add")}function u(){n(void 0),i.current=void 0}function h(o){const C=o.target,{x:f,y:g,width:m,height:S}=C.getBoundingClientRect(),j=P.create(f,g),v=P.create(m,S);y(P.create(o.clientX,o.clientY).subtract(j).divide(v).multiply(r).floor())}function M({grid:o}){E(o)}function E(o){if(e.current===void 0)return;(i.current?o.getCellsInLine(i.current,s.current,{excludeStart:!0}):[o.getAtPosition(s.current)]).forEach(f=>{f&&e.current==="add"&&f.add(4)}),i.current=s.current}return I.jsx("div",{className:"route fluid",children:I.jsx(V,{ref:t,resetChanges:!1,initSimulation:d,onStep:M,onPointerDown:c,onPointerUp:u,onPointerMove:h})})}export{H as default};
